/**
 * enchant.js v0.4.1
 *
 * Copyright (c) Ubiquitous Entertainment Inc.
 * Dual licensed under the MIT or GPL Version 3 licenses
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */
 
if(typeof Object.defineProperty!="function"){Object.defineProperty=function(a,c,b){if("value" in b){a[c]=b.value}if("get" in b){a.__defineGetter__(c,b.get)}if("set" in b){a.__defineSetter__(c,b.set)}return a}}if(typeof Object.defineProperties!="function"){Object.defineProperties=function(b,a){for(var c in a){if(a.hasOwnProperty(c)){Object.defineProperty(b,c,a[c])}}return b}}if(typeof Object.create!="function"){Object.create=function(a,c){function b(){}b.prototype=a;var d=new b();if(c!=null){Object.defineProperties(d,c)}return d}}if(typeof Object.getPrototypeOf!="function"){Object.getPrototypeOf=function(a){return a.__proto__}}var enchant=function(b){if(b!=null){if(!(b instanceof Array)){b=Array.prototype.slice.call(arguments)}b=b.filter(function(c){return[c].join()})}(function a(f,g){var d=[];for(var h in f){if(f.hasOwnProperty(h)){if(typeof f[h]=="function"){window[h]=f[h]}else{if(Object.getPrototypeOf(f[h])==Object.prototype){if(b==null){d.push(h)}else{e=b.indexOf(g+h);if(e!=-1){d.push(h);b.splice(e,1)}}}}}}for(var e=0,c=d.length;e<c;e++){a(f[d[e]],g+d[e]+".")}})(enchant,"");if(b!=null&&b.length){throw new Error("Cannot load module: "+b.join(", "))}};(function(){var e=(function(){var f=navigator.userAgent;if(f.indexOf("Opera")!=-1){return"O"}else{if(f.indexOf("MSIE")!=-1){return"ms"}else{if(f.indexOf("WebKit")!=-1){return"webkit"}else{if(navigator.product=="Gecko"){return"Moz"}else{return""}}}}})();var d=(function(){var f=document.createElement("div");f.setAttribute("ontouchstart","return");return typeof f.ontouchstart=="function"})();var b=(function(){if(navigator.userAgent.indexOf("iPhone")!=-1&&window.devicePixelRatio==2){var f=document.querySelector('meta[name="viewport"]');if(f==null){f=document.createElement("meta");document.head.appendChild(f)}f.setAttribute("content","width=640px");return true}else{return false}})();var c;enchant.Class=function(g,f){return enchant.Class.create(g,f)};enchant.Class.create=function(i,f){if(arguments.length==0){return enchant.Class.create(Object,f)}else{if(arguments.length==1&&typeof arguments[0]!="function"){return enchant.Class.create(Object,arguments[0])}}for(var h in f){if(f.hasOwnProperty(h)){if(Object.getPrototypeOf(f[h])==Object.prototype){if(!("enumerable" in f[h])){f[h].enumerable=true}}else{f[h]={value:f[h],enumerable:true,writable:true}}}}var g=function(){if(this instanceof g){g.prototype.initialize.apply(this,arguments)}else{return new g()}};g.prototype=Object.create(i.prototype,f);g.prototype.constructor=g;if(g.prototype.initialize==null){g.prototype.initialize=function(){i.apply(this,arguments)}}return g};enchant.Event=enchant.Class.create({initialize:function(f){this.type=f;this.target=null;this.x=0;this.y=0;this.localX=0;this.localY=0},_initPosition:function(g,f){this.x=this.localX=(g-c._pageX)/c.scale;this.y=this.localY=(f-c._pageY)/c.scale}});enchant.Event.LOAD="load";enchant.Event.PROGRESS="progress";enchant.Event.ENTER_FRAME="enterframe";enchant.Event.EXIT_FRAME="exitframe";enchant.Event.ENTER="enter";enchant.Event.EXIT="exit";enchant.Event.ADDED="added";enchant.Event.ADDED_TO_SCENE="addedtoscene";enchant.Event.REMOVED="removed";enchant.Event.REMOVED_FROM_SCENE="removedfromscene";enchant.Event.TOUCH_START="touchstart";enchant.Event.TOUCH_MOVE="touchmove";enchant.Event.TOUCH_END="touchend";enchant.Event.RENDER="render";enchant.Event.INPUT_START="inputstart";enchant.Event.INPUT_CHANGE="inputchange";enchant.Event.INPUT_END="inputend";enchant.Event.LEFT_BUTTON_DOWN="leftbuttondown";enchant.Event.LEFT_BUTTON_UP="leftbuttonup";enchant.Event.RIGHT_BUTTON_DOWN="rightbuttondown";enchant.Event.RIGHT_BUTTON_UP="rightbuttonup";enchant.Event.UP_BUTTON_DOWN="upbuttondown";enchant.Event.UP_BUTTON_UP="upbuttonup";enchant.Event.DOWN_BUTTON_DOWN="downbuttondown";enchant.Event.DOWN_BUTTON_UP="downbuttonup";enchant.Event.A_BUTTON_DOWN="abuttondown";enchant.Event.A_BUTTON_UP="abuttonup";enchant.Event.B_BUTTON_DOWN="bbuttondown";enchant.Event.B_BUTTON_UP="bbuttonup";enchant.EventTarget=enchant.Class.create({initialize:function(){this._listeners={}},addEventListener:function(g,h){var f=this._listeners[g];if(f==null){this._listeners[g]=[h]}else{if(f.indexOf(h)==-1){f.unshift(h)}}},removeEventListener:function(h,j){var g=this._listeners[h];if(g!=null){var f=g.indexOf(j);if(f!=-1){g.splice(f,1)}}},dispatchEvent:function(j){j.target=this;j.localX=j.x-this._offsetX;j.localY=j.y-this._offsetY;if(this["on"+j.type]!=null){this["on"+j.type]()}var h=this._listeners[j.type];if(h!=null){h=h.slice();for(var g=0,f=h.length;g<f;g++){h[g].call(this,j)}}}});enchant.Game=enchant.Class.create(enchant.EventTarget,{initialize:function(j,t){enchant.EventTarget.call(this);var p=true;if(c){p=false;c.stop()}c=enchant.Game.instance=this;this.width=j||320;this.height=t||320;this.scale=1;var q=document.getElementById("enchant-stage");if(!q){q=document.createElement("div");q.id="enchant-stage";q.style.width=window.innerWidth+"px";q.style.height=window.innerHeight+"px";q.style.position="absolute";if(document.body.firstChild){document.body.insertBefore(q,document.body.firstChild)}else{document.body.appendChild(q)}this.scale=Math.min(window.innerWidth/this.width,window.innerHeight/this.height);this._pageX=0;this._pageY=0}else{var h=window.getComputedStyle(q);j=parseInt(h.width);t=parseInt(h.height);if(j&&t){this.scale=Math.min(j/this.width,t/this.height)}else{q.style.width=this.width+"px";q.style.height=this.height+"px"}while(q.firstChild){q.removeChild(q.firstChild)}q.style.position="relative";var g=q.getBoundingClientRect();this._pageX=Math.round(window.scrollX+g.left);this._pageY=Math.round(window.scrollY+g.top)}if(!this.scale){this.scale=1}q.style.fontSize="12px";q.style.webkitTextSizeAdjust="none";this._element=q;this.fps=30;this.frame=0;this.ready=null;this.running=false;this.assets={};var n=this._assets=[];(function k(v){if(v.assets instanceof Array){[].push.apply(n,v.assets)}for(var w in v){if(v.hasOwnProperty(w)){if(Object.getPrototypeOf(v[w])==Object.prototype){k(v[w])}}}})(enchant);this._scenes=[];this.currentScene=null;this.rootScene=new enchant.Scene();this.pushScene(this.rootScene);this.loadingScene=new enchant.Scene();this.loadingScene.backgroundColor="#000";var u=this.width*0.9|0;var s=this.width*0.3|0;var m=u*0.05|0;var o=new enchant.Sprite(u,s);o.x=(this.width-u)/2;o.y=(this.height-s)/2;var l=new enchant.Surface(u,s);l.context.fillStyle="#fff";l.context.fillRect(0,0,u,s);l.context.fillStyle="#000";l.context.fillRect(m,m,u-m*2,s-m*2);o.image=l;var f=0,i=0;this.addEventListener("progress",function(v){f=v.loaded/v.total});o.addEventListener("enterframe",function(){i*=0.9;i+=f*0.1;l.context.fillStyle="#fff";l.context.fillRect(m,0,(u-m*2)*i,s)});this.loadingScene.addChild(o);this._mousedownID=0;this._surfaceID=0;this._soundID=0;this._intervalID=null;this.input={};this._keybind={};this.keybind(37,"left");this.keybind(38,"up");this.keybind(39,"right");this.keybind(40,"down");var r=0;["left","right","up","down","a","b"].forEach(function(v){this.addEventListener(v+"buttondown",function(w){if(!this.input[v]){this.input[v]=true;this.dispatchEvent(new enchant.Event((r++)?"inputchange":"inputstart"))}this.currentScene.dispatchEvent(w)});this.addEventListener(v+"buttonup",function(w){if(this.input[v]){this.input[v]=false;this.dispatchEvent(new enchant.Event((--r)?"inputchange":"inputend"))}this.currentScene.dispatchEvent(w)})},this);if(p){document.addEventListener("keydown",function(w){c.dispatchEvent(new enchant.Event("keydown"));if((37<=w.keyCode&&w.keyCode<=40)||w.keyCode==32){w.preventDefault();w.stopPropagation()}if(!c.running){return}var v=c._keybind[w.keyCode];if(v){var w=new enchant.Event(v+"buttondown");c.dispatchEvent(w)}},true);document.addEventListener("keyup",function(w){if(!c.running){return}var v=c._keybind[w.keyCode];if(v){var w=new enchant.Event(v+"buttonup");c.dispatchEvent(w)}},true);if(d){document.addEventListener("touchstart",function(v){v.preventDefault()},true);document.addEventListener("touchmove",function(v){v.preventDefault();if(!c.running){v.stopPropagation()}},true);document.addEventListener("touchend",function(v){v.preventDefault();if(!c.running){v.stopPropagation()}},true)}else{document.addEventListener("mousedown",function(v){v.preventDefault();c._mousedownID++;if(!c.running){v.stopPropagation()}},true);document.addEventListener("mousemove",function(v){v.preventDefault();if(!c.running){v.stopPropagation()}},true);document.addEventListener("mouseup",function(v){v.preventDefault();if(!c.running){v.stopPropagation()}},true)}}},preload:function(f){if(!(f instanceof Array)){f=Array.prototype.slice.call(arguments)}[].push.apply(this._assets,f)},load:function(h,i){if(i==null){i=function(){}}var f=h.match(/\.\w+$/)[0];if(f){f=f.slice(1).toLowerCase()}switch(f){case"jpg":case"gif":case"png":c.assets[h]=enchant.Surface.load(h);c.assets[h].addEventListener("load",i);break;case"mp3":case"aac":case"m4a":case"wav":case"ogg":c.assets[h]=enchant.Sound.load(h,"audio/"+f);c.assets[h].addEventListener("load",i);break;default:var g=new XMLHttpRequest();g.open("GET",h,true);g.onreadystatechange=function(k){if(g.readyState==4){if(g.status!=200){throw new Error("Cannot load an asset: "+h)}var j=g.getResponseHeader("Content-Type")||"";if(j.match(/^image/)){c.assets[h]=enchant.Surface.load(h);c.assets[h].addEventListener("load",i)}else{if(j.match(/^audio/)){c.assets[h]=enchant.Sound.load(h,j);c.assets[h].addEventListener("load",i)}else{c.assets[asset]=g.responseText;i()}}}};g.send(null)}},start:function(){if(this._intervalID){window.clearInterval(this._intervalID)}else{if(this._assets.length){if(enchant.Sound.enabledInMobileSafari&&!c._touched&&e=="webkit"&&d){var l=new Scene();l.backgroundColor="#000";var p=Math.round(c.width/10);var n=new Sprite(c.width,p);n.y=(c.height-p)/2;n.image=new Surface(c.width,p);n.image.context.fillStyle="#fff";n.image.context.font=(p-1)+"px bold Helvetica,Arial,sans-serif";var f=n.image.context.measureText("Touch to Start").width;n.image.context.fillText("Touch to Start",(c.width-f)/2,p-1);l.addChild(n);document.addEventListener("touchstart",function(){c._touched=true;c.removeScene(l);c.start()},true);c.pushScene(l);return}var g={};var h=this._assets.filter(function(i){return i in g?false:g[i]=true});var k=0;for(var j=0,m=h.length;j<m;j++){this.load(h[j],function(){var i=new enchant.Event("progress");i.loaded=++k;i.total=m;c.dispatchEvent(i);if(k==m){c.removeScene(c.loadingScene);c.dispatchEvent(new enchant.Event("load"))}})}this.pushScene(this.loadingScene)}else{this.dispatchEvent(new enchant.Event("load"))}}this.currentTime=Date.now();this._intervalID=window.setInterval(function(){c._tick()},1000/this.fps);this.running=true},_tick:function(){var h=Date.now();var j=new enchant.Event("enterframe");j.elapsed=h-this.currentTime;this.currentTime=h;var f=this.currentScene.childNodes.slice();var g=Array.prototype.push;while(f.length){var i=f.pop();i.dispatchEvent(j);if(i.childNodes){g.apply(f,i.childNodes)}}this.currentScene.dispatchEvent(j);this.dispatchEvent(j);this.dispatchEvent(new enchant.Event("exitframe"));this.frame++},stop:function(){if(this._intervalID){window.clearInterval(this._intervalID);this._intervalID=null}this.running=false},pause:function(){if(this._intervalID){window.clearInterval(this._intervalID);this._intervalID=null}},pushScene:function(f){this._element.appendChild(f._element);if(this.currentScene){this.currentScene.dispatchEvent(new enchant.Event("exit"))}this.currentScene=f;this.currentScene.dispatchEvent(new enchant.Event("enter"));return this._scenes.push(f)},popScene:function(){if(this.currentScene==this.rootScene){return}this._element.removeChild(this.currentScene._element);this.currentScene.dispatchEvent(new enchant.Event("exit"));this.currentScene=this._scenes[this._scenes.length-2];this.currentScene.dispatchEvent(new enchant.Event("enter"));return this._scenes.pop()},replaceScene:function(f){this.popScene();return this.pushScene(f)},removeScene:function(g){if(this.currentScene==g){return this.popScene()}else{var f=this._scenes.indexOf(g);if(f!=-1){this._scenes.splice(f,1);this._element.removeChild(g._element);return g}}},keybind:function(g,f){this._keybind[g]=f}});enchant.Game.instance=null;enchant.Node=enchant.Class.create(enchant.EventTarget,{initialize:function(){enchant.EventTarget.call(this);this._x=0;this._y=0;this._offsetX=0;this._offsetY=0;this.parentNode=null;this.scene=null;this.addEventListener("touchstart",function(f){if(this.parentNode&&this.parentNode!=this.scene){this.parentNode.dispatchEvent(f)}});this.addEventListener("touchmove",function(f){if(this.parentNode&&this.parentNode!=this.scene){this.parentNode.dispatchEvent(f)}});this.addEventListener("touchend",function(f){if(this.parentNode&&this.parentNode!=this.scene){this.parentNode.dispatchEvent(f)}})},moveTo:function(f,g){this._x=f;this._y=g;this._updateCoordinate()},moveBy:function(f,g){this._x+=f;this._y+=g;this._updateCoordinate()},x:{get:function(){return this._x},set:function(f){this._x=f;this._updateCoordinate()}},y:{get:function(){return this._y},set:function(f){this._y=f;this._updateCoordinate()}},_updateCoordinate:function(){if(this.parentNode){this._offsetX=this.parentNode._offsetX+this._x;this._offsetY=this.parentNode._offsetY+this._y}else{this._offsetX=this._x;this._offsetY=this._y}}});enchant.Entity=enchant.Class.create(enchant.Node,{initialize:function(){enchant.Node.call(this);this._element=document.createElement("div");this._style=this._element.style;this._style.position="absolute";this._width=0;this._height=0;this._backgroundColor=null;this._opacity=1;this._visible=true;this._buttonMode=null;this.buttonMode=null;this.buttonPressed=false;this.addEventListener("touchstart",function(){if(!this.buttonMode){return}this.buttonPressed=true;var h=new Event(button+"buttondown");this.dispatchEvent(h);c.dispatchEvent(h)});this.addEventListener("touchend",function(){if(!this.buttonMode){return}this.buttonPressed=false;var h=new Event(button+"buttonup");this.dispatchEvent(h);c.dispatchEvent(h)});var g=this;var f=function(){g.dispatchEvent(new enchant.Event("render"))};this.addEventListener("addedtoscene",function(){f();c.addEventListener("exitframe",f)});this.addEventListener("removedfromscene",function(){c.removeEventListener("exitframe",f)});this.addEventListener("render",function(){if(this._offsetX!=this._previousOffsetX){this._style.left=this._offsetX+"px"}if(this._offsetY!=this._previousOffsetY){this._style.top=this._offsetY+"px"}this._previousOffsetX=this._offsetX;this._previousOffsetY=this._offsetY});var g=this;if(d){this._element.addEventListener("touchstart",function(l){var k=l.touches;for(var j=0,h=k.length;j<h;j++){l=new enchant.Event("touchstart");l.identifier=k[j].identifier;l._initPosition(k[j].pageX,k[j].pageY);g.dispatchEvent(l)}},false);this._element.addEventListener("touchmove",function(l){var k=l.touches;for(var j=0,h=k.length;j<h;j++){l=new enchant.Event("touchmove");l.identifier=k[j].identifier;l._initPosition(k[j].pageX,k[j].pageY);g.dispatchEvent(l)}},false);this._element.addEventListener("touchend",function(l){var k=l.changedTouches;for(var j=0,h=k.length;j<h;j++){l=new enchant.Event("touchend");l.identifier=k[j].identifier;l._initPosition(k[j].pageX,k[j].pageY);g.dispatchEvent(l)}},false)}else{this._element.addEventListener("mousedown",function(i){var h=i.pageX;var j=i.pageY;i=new enchant.Event("touchstart");i.identifier=c._mousedownID;i._initPosition(h,j);g.dispatchEvent(i);g._mousedown=true},false);c._element.addEventListener("mousemove",function(i){if(!g._mousedown){return}var h=i.pageX;var j=i.pageY;i=new enchant.Event("touchmove");i.identifier=c._mousedownID;i._initPosition(h,j);g.dispatchEvent(i)},false);c._element.addEventListener("mouseup",function(i){if(!g._mousedown){return}var h=i.pageX;var j=i.pageY;i=new enchant.Event("touchend");i.identifier=c._mousedownID;i._initPosition(h,j);g.dispatchEvent(i);g._mousedown=false},false)}},id:{get:function(){return this._element.id},set:function(f){this._element.id=f}},className:{get:function(){return this._element.className},set:function(f){this._element.className=f}},width:{get:function(){return this._width},set:function(f){this._style.width=(this._width=f)+"px"}},height:{get:function(){return this._height},set:function(f){this._style.height=(this._height=f)+"px"}},backgroundColor:{get:function(){return this._backgroundColor},set:function(f){this._element.style.backgroundColor=this._backgroundColor=f}},opacity:{get:function(){return this._opacity},set:function(f){this._style.opacity=this._opacity=f}},visible:{get:function(){return this._visible},set:function(f){if(this._visible=f){this._style.display="block"}else{this._style.display="none"}}},touchEnabled:{get:function(){return this._touchEnabled},set:function(f){if(this._touchEnabled=f){this._style.pointerEvents="all"}else{this._style.pointerEvents="none"}}},intersect:function(f){return this.x<f.x+f.width&&f.x<this.x+this.width&&this.y<f.y+f.height&&f.y<this.y+this.height},within:function(f,h){if(h==null){h=(this.width+this.height+f.width+f.height)/4}var g;return(g=this.x-f.x+(this.width-f.width)/2)*g+(g=this.y-f.y+(this.height-f.height)/2)*g<h*h}});enchant.Sprite=enchant.Class.create(enchant.Entity,{initialize:function(g,f){enchant.Entity.call(this);this.width=g;this.height=f;this._scaleX=1;this._scaleY=1;this._rotation=0;this._dirty=false;this._image=null;this._frame=0;this._style.overflow="hidden";this.addEventListener("render",function(){if(this._dirty){this._style[e+"Transform"]=["rotate(",this._rotation,"deg)","scale(",this._scaleX,",",this._scaleY,")"].join("");this._dirty=false}})},image:{get:function(){return this._image},set:function(h){if(h==this._image){return}if(this._image!=null){if(this._image.css){this._style.backgroundImage=""}else{if(this._element.firstChild){this._element.removeChild(this._element.firstChild);if(this._dirtyListener){this.removeEventListener("render",this._dirtyListener);this._dirtyListener=null}else{this._image._parent=null}}}}if(h!=null){if(h._css){this._style.backgroundImage=h._css}else{if(h._parent){var f=document.createElement("canvas");var g=f.getContext("2d");f.width=h.width;f.height=h.height;g.drawImage(h._element,0,0);this._dirtyListener=function(){if(h._dirty){g.drawImage(h._element);h._dirty=false}};this.addEventListener("render",this._dirtyListener);this._element.appendChild(f)}else{h._parent=this;this._element.appendChild(h._element)}}}this._image=h}},frame:{get:function(){return this._frame},set:function(h){this._frame=h;var g=this._image.width/this._width|0;if(this._image._css){this._style.backgroundPosition=[-(h%g)*this._width,"px ",-(h/g|0)*this._height,"px"].join("")}else{if(this._element.firstChild){var f=this._element.firstChild.style;f.left=-(h%g)*this._width+"px";f.top=-(h/g|0)*this._height+"px"}}}},scale:function(f,g){if(g==null){g=f}this._scaleX*=f;this._scaleY*=g;this._dirty=true},rotate:function(f){this._rotation+=f;this._dirty=true},scaleX:{get:function(){return this._scaleX},set:function(f){this._scaleX=f;this._dirty=true}},scaleY:{get:function(){return this._scaleY},set:function(f){this._scaleY=f;this._dirty=true}},rotation:{get:function(){return this._rotation},set:function(f){this._rotation=f;this._dirty=true}}});enchant.Label=enchant.Class.create(enchant.Entity,{initialize:function(f){enchant.Entity.call(this);this.width=300;this.text=f},text:{get:function(){return this._element.innerHTML},set:function(f){this._element.innerHTML=f}},font:{get:function(){return this._style.font},set:function(f){this._style.font=f}},color:{get:function(){return this._style.color},set:function(f){this._style.color=f}}});enchant.Map=enchant.Class.create(enchant.Entity,{initialize:function(h,f){enchant.Entity.call(this);var g=document.createElement("canvas");if(b&&c.scale==2){g.width=c.width*2;g.height=c.height*2;this._style.webkitTransformOrigin="0 0";this._style.webkitTransform="scale(0.5)"}else{g.width=c.width;g.height=c.height}this._element.appendChild(g);this._context=g.getContext("2d");this._tileWidth=h||0;this._tileHeight=f||0;this._image=null;this._data=[[[]]];this._dirty=false;this._tight=false;this.touchEnabled=false;this.collisionData=null;this._listeners.render=null;this.addEventListener("render",function(){if(this._dirty||this._previousOffsetX==null){this._dirty=false;this.redraw(0,0,c.width,c.height)}else{if(this._offsetX!=this._previousOffsetX||this._offsetY!=this._previousOffsetY){if(this._tight){var s=-this._offsetX;var p=-this._offsetY;var u=-this._previousOffsetX;var r=-this._previousOffsetY;var l=s-u+c.width;var j=u-s+c.width;var n=p-r+c.height;var m=r-p+c.height;if(l>this._tileWidth&&j>this._tileWidth&&n>this._tileHeight&&m>this._tileHeight){var q,o,w,v,t,k;if(l<j){q=0;w=u-s;t=l}else{q=s-u;w=0;t=j}if(n<m){o=0;v=r-p;k=n}else{o=p-r;v=0;k=m}if(c._buffer==null){c._buffer=document.createElement("canvas");c._buffer.width=this._context.canvas.width;c._buffer.height=this._context.canvas.height}var i=c._buffer.getContext("2d");if(this._doubledImage){i.clearRect(0,0,t*2,k*2);i.drawImage(this._context.canvas,q*2,o*2,t*2,k*2,0,0,t*2,k*2);i=this._context;i.clearRect(w*2,v*2,t*2,k*2);i.drawImage(c._buffer,0,0,t*2,k*2,w*2,v*2,t*2,k*2)}else{i.clearRect(0,0,t,k);i.drawImage(this._context.canvas,q,o,t,k,0,0,t,k);i=this._context;i.clearRect(w,v,t,k);i.drawImage(c._buffer,0,0,t,k,w,v,t,k)}if(w==0){this.redraw(t,0,c.width-t,c.height)}else{this.redraw(0,0,c.width-t,c.height)}if(v==0){this.redraw(0,k,c.width,c.height-k)}else{this.redraw(0,0,c.width,c.height-k)}}else{this.redraw(0,0,c.width,c.height)}}else{this.redraw(0,0,c.width,c.height)}}}this._previousOffsetX=this._offsetX;this._previousOffsetY=this._offsetY})},loadData:function(k){this._data=Array.prototype.slice.apply(arguments);this._dirty=true;this._tight=false;for(var j=0,g=this._data.length;j<g;j++){var o=0;var k=this._data[j];for(var n=0,h=k.length;n<h;n++){for(var f=0,m=k[n].length;f<m;f++){if(k[n][f]>=0){o++}}}if(o/(k.length*k[0].length)>0.2){this._tight=true;break}}},hitTest:function(p,m){if(p<0||this.width<=p||m<0||this.height<=m){return false}var f=this._image.width;var q=this._image.height;var o=this._tileWidth||f;var k=this._tileHeight||q;p=p/o|0;m=m/k|0;if(this.collisionData!=null){return this.collisionData[m]&&!!this.collisionData[m][p]}else{for(var j=0,l=this._data.length;j<l;j++){var h=this._data[j];var g;if(h[m]!=null&&(g=h[m][p])!=null&&0<=g&&g<(f/o|0)*(q/k|0)){return true}}return false}},image:{get:function(){return this._image},set:function(j){this._image=j;if(b&&c.scale==2){var h=new Surface(j.width*2,j.height*2);var m=this._tileWidth||j.width;var g=this._tileHeight||j.height;var k=j.width/m|0;var i=j.height/g|0;for(var l=0;l<i;l++){for(var f=0;f<k;f++){h.draw(j,f*m,l*g,m,g,f*m*2,l*g*2,m*2,g*2)}}this._doubledImage=h}this._dirty=true}},tileWidth:{get:function(){return this._tileWidth},set:function(f){this._tileWidth=f;this._dirty=true}},tileHeight:{get:function(){return this._tileHeight},set:function(f){this._tileHeight=f;this._dirty=true}},width:{get:function(){return this._tileWidth*this._data[0][0].length}},height:{get:function(){return this._tileHeight*this._data[0].length}},redraw:function(q,p,D,A){if(this._image==null){return}var B,f,o,t,s;if(this._doubledImage){B=this._doubledImage;f=this._tileWidth*2;o=this._tileHeight*2;t=-this._offsetX*2;s=-this._offsetY*2;q*=2;p*=2;D*=2;A*=2}else{B=this._image;f=this._tileWidth;o=this._tileHeight;t=-this._offsetX;s=-this._offsetY}var l=B.width/f|0;var k=B.height/o|0;var j=Math.max((q+t)/f|0,0);var w=Math.max((p+s)/o|0,0);var H=Math.ceil((q+t+D)/f);var m=Math.ceil((p+s+A)/o);var E=B._element;var g=this._context;var h=g.canvas;g.clearRect(q,p,D,A);for(var F=0,G=this._data.length;F<G;F++){var J=this._data[F];var v=Math.min(H,J[0].length);var I=Math.min(m,J.length);for(p=w;p<I;p++){for(q=j;q<v;q++){var C=J[p][q];if(0<=C&&C<l*k){var z=(C%l)*f;var u=(C/l|0)*o;g.drawImage(E,z,u,f,o,q*f-t,p*o-s,f,o)}}}}}});enchant.Group=enchant.Class.create(enchant.Node,{initialize:function(){enchant.Node.call(this);this.childNodes=[];this._x=0;this._y=0},addChild:function(j){this.childNodes.push(j);j.parentNode=this;j.dispatchEvent(new enchant.Event("added"));if(this.scene){var l=new enchant.Event("addedtoscene");j.scene=this.scene;j.dispatchEvent(l);j._updateCoordinate();var h=document.createDocumentFragment();var f;var g=Array.prototype.push;if(j._element){h.appendChild(j._element)}else{if(j.childNodes){f=j.childNodes.slice().reverse();while(f.length){j=f.pop();j.scene=this.scene;j.dispatchEvent(l);if(j._element){h.appendChild(j._element)}else{if(j.childNodes){g.apply(f,j.childNodes.reverse())}}}}}if(!h.childNodes.length){return}var k,i=this;while(i.parentNode){f=i.parentNode.childNodes;f=f.slice(f.indexOf(i)+1).reverse();while(f.length){j=f.pop();if(j._element){k=j._element;break}else{if(j.childNodes){g.apply(f,j.childNodes.slice().reverse())}}}i=i.parentNode}if(k){this.scene._element.insertBefore(h,k)}else{this.scene._element.appendChild(h)}}},insertBefore:function(g,h){var l=this.childNodes.indexOf(h);if(l!=-1){this.childNodes.splice(l,0,g);g.parentNode=this;g.dispatchEvent(new enchant.Event("added"));if(this.scene){var m=new enchant.Event("addedtoscene");g.scene=this.scene;g.dispatchEvent(m);g._updateCoordinate();var n=document.createDocumentFragment();var f;var o=Array.prototype.push;if(g._element){n.appendChild(g._element)}else{if(g.childNodes){f=g.childNodes.slice().reverse();while(f.length){g=f.pop();g.scene=this.scene;g.dispatchEvent(m);if(g._element){n.appendChild(g._element)}else{if(g.childNodes){o.apply(f,g.childNodes.reverse())}}}}}if(!n.childNodes.length){return}var k,j=h;while(j.parentNode){if(l!=null){f=this.childNodes.slice(l+1).reverse();l=null}else{f=j.parentNode.childNodes;f=f.slice(f.indexOf(j)+1).reverse()}while(f.length){g=f.pop();if(g._element){k=g._element;break}else{if(g.childNodes){o.apply(f,g.childNodes.slice().reverse())}}}j=j.parentNode}if(k){this.scene._element.insertBefore(n,k)}else{this.scene._element.appendChild(n)}}}else{this.addChild(g)}},removeChild:function(j){var h=this.childNodes.indexOf(j);if(h!=-1){this.childNodes.splice(h,1)}else{return}j.parentNode=null;j.dispatchEvent(new enchant.Event("removed"));if(this.scene){var k=new enchant.Event("removedfromscene");j.scene=null;j.dispatchEvent(k);if(j._element){this.scene._element.removeChild(j._element)}else{if(j.childNodes){var f=j.childNodes.slice();var g=Array.prototype.push;while(f.length){j=f.pop();j.scene=null;j.dispatchEvent(k);if(j._element){this.scene._element.removeChild(j._element)}else{if(j.childNodes){g.apply(f,j.childNodes)}}}}}}},firstChild:{get:function(){return this.childNodes[0]}},lastChild:{get:function(){return this.childNodes[this.childNodes.length-1]}},_updateCoordinate:function(){if(this.parentNode){this._offsetX=this.parentNode._offsetX+this._x;this._offsetY=this.parentNode._offsetY+this._y}else{this._offsetX=this._x;this._offsetY=this._y}for(var g=0,f=this.childNodes.length;g<f;g++){this.childNodes[g]._updateCoordinate()}}});enchant.Scene=enchant.Class.create(enchant.Group,{initialize:function(){enchant.Group.call(this);this._element=document.createElement("div");this._element.style.position="absolute";this._element.style.overflow="hidden";this._element.style.width=(this.width=c.width)+"px";this._element.style.height=(this.height=c.height)+"px";this._element.style[e+"TransformOrigin"]="0 0";this._element.style[e+"Transform"]="scale("+c.scale+")";this.scene=this;var f=this;if(d){this._element.addEventListener("touchstart",function(k){var j=k.touches;for(var h=0,g=j.length;h<g;h++){k=new enchant.Event("touchstart");k.identifier=j[h].identifier;k._initPosition(j[h].pageX,j[h].pageY);f.dispatchEvent(k)}},false);this._element.addEventListener("touchmove",function(k){var j=k.touches;for(var h=0,g=j.length;h<g;h++){k=new enchant.Event("touchmove");k.identifier=j[h].identifier;k._initPosition(j[h].pageX,j[h].pageY);f.dispatchEvent(k)}},false);this._element.addEventListener("touchend",function(k){var j=k.changedTouches;for(var h=0,g=j.length;h<g;h++){k=new enchant.Event("touchend");k.identifier=j[h].identifier;k._initPosition(j[h].pageX,j[h].pageY);f.dispatchEvent(k)}},false)}else{this._element.addEventListener("mousedown",function(h){var g=h.pageX;var i=h.pageY;h=new enchant.Event("touchstart");h.identifier=c._mousedownID;h._initPosition(g,i);f.dispatchEvent(h);f._mousedown=true},false);c._element.addEventListener("mousemove",function(h){if(!f._mousedown){return}var g=h.pageX;var i=h.pageY;h=new enchant.Event("touchmove");h.identifier=c._mousedownID;h._initPosition(g,i);f.dispatchEvent(h)},false);c._element.addEventListener("mouseup",function(h){if(!f._mousedown){return}var g=h.pageX;var i=h.pageY;h=new enchant.Event("touchend");h.identifier=c._mousedownID;h._initPosition(g,i);f.dispatchEvent(h);f._mousedown=false},false)}},backgroundColor:{get:function(){return this._backgroundColor},set:function(f){this._element.style.backgroundColor=this._backgroundColor=f}},_updateCoordinate:function(){this._offsetX=this._x;this._offsetY=this._y;for(var g=0,f=this.childNodes.length;g<f;g++){this.childNodes[g]._updateCoordinate()}}});var a=["putImageData","drawImage","drawFocusRing","fill","stroke","clearRect","fillRect","strokeRect","fillText","strokeText"];enchant.Surface=enchant.Class.create(enchant.EventTarget,{initialize:function(h,f){enchant.EventTarget.call(this);this.width=h;this.height=f;this.context=null;var i="enchant-surface"+c._surfaceID++;if(document.getCSSCanvasContext){this.context=document.getCSSCanvasContext("2d",i,h,f);this._element=this.context.canvas;this._css="-webkit-canvas("+i+")";var g=this.context}else{if(document.mozSetImageElement){this._element=document.createElement("canvas");this._element.width=h;this._element.height=f;this._css="-moz-element(#"+i+")";this.context=this._element.getContext("2d");document.mozSetImageElement(i,this._element)}else{this._element=document.createElement("canvas");this._element.width=h;this._element.height=f;this._element.style.position="absolute";this.context=this._element.getContext("2d");a.forEach(function(j){var k=this.context[j];this.context[j]=function(){k.apply(this,arguments);this._dirty=true}},this)}}},getPixel:function(f,g){return this.context.getImageData(f,g,1,1).data},setPixel:function(h,m,l,k,f,i){var j=this.context.createImageData(1,1);j.data[0]=l;j.data[1]=k;j.data[2]=f;j.data[3]=i;this.context.putImageData(j,h,m,1,1)},clear:function(){this.context.clearRect(0,0,this.width,this.height)},draw:function(f){arguments[0]=f=f._element;if(arguments.length==1){this.context.drawImage(f,0,0)}else{this.context.drawImage.apply(this.context,arguments)}},clone:function(){var f=new enchant.Surface(this.width,this.height);f.draw(this);return f},toDataURL:function(){var f=this._element.src;if(f){if(f.slice(0,5)=="data:"){return f}else{return this.clone().toDataURL()}}else{return this._element.toDataURL()}}});enchant.Surface.load=function(h){var g=new Image();var f=Object.create(Surface.prototype,{context:{value:null},_css:{value:"url("+h+")"},_element:{value:g}});enchant.EventTarget.call(f);g.src=h;g.onerror=function(){throw new Error("Cannot load an asset: "+g.src)};g.onload=function(){f.width=g.width;f.height=g.height;f.dispatchEvent(new enchant.Event("load"))};return f};enchant.Sound=enchant.Class.create(enchant.EventTarget,{initialize:function(){enchant.EventTarget.call(this);throw new Error("Illegal Constructor");this.duration=0},play:function(){if(this._element){this._element.play()}},pause:function(){if(this._element){this._element.pause()}},stop:function(){this.pause();this.currentTime=0},clone:function(){var f;if(this._element instanceof Audio){f=Object.create(enchant.Sound.prototype,{_element:{value:this._element.cloneNode(false)},duration:{value:this.duration}})}else{f=Object.create(enchant.Sound.prototype)}enchant.EventTarget.call(f);return f},currentTime:{get:function(){return this._element?this._element.currentTime:0},set:function(f){if(this._element){this._element.currentTime=f}}},volume:{get:function(){return this._element?this._element.volume:1},set:function(f){if(this._element){this._element.volume=f}}}});enchant.Sound.load=function(j,g){if(g==null){var f=j.match(/\.\w+$/)[0];if(f){g="audio/"+f.slice(1).toLowerCase()}else{g=""}}g=g.replace("mp3","mpeg");var i=Object.create(enchant.Sound.prototype);enchant.EventTarget.call(i);var h=new Audio();if(!enchant.Sound.enabledInMobileSafari&&e=="webkit"&&d){window.setTimeout(function(){i.dispatchEvent(new enchant.Event("load"))},0)}else{if(h.canPlayType(g)){h.src=j;h.load();h.autoplay=false;h.onerror=function(){throw new Error("Cannot load an asset: "+h.src)};h.addEventListener("canplaythrough",function(){i.duration=h.duration;i.dispatchEvent(new enchant.Event("load"))},false);i._element=h}else{if(g=="audio/mpeg"){var l=document.createElement("embed");var k="enchant-audio"+c._soundID++;l.width=l.height=1;l.name=k;l.src="sound.swf?id="+k+"&src="+j;l.allowscriptaccess="always";l.style.position="absolute";l.style.left="-1px";i.addEventListener("load",function(){Object.defineProperties(l,{currentTime:{get:function(){return l.getCurrentTime()},set:function(m){l.setCurrentTime(m)}},volume:{get:function(){return l.getVolume()},set:function(m){l.setVolume(m)}}});i._element=l;i.duration=l.getDuration()});c._element.appendChild(l);enchant.Sound[k]=i}else{window.setTimeout(function(){i.dispatchEvent(new enchant.Event("load"))},0)}}}return i};enchant.Sound.enabledInMobileSafari=false})();
"@file enchant_patch.js";(function(){enchant.Game.prototype.load=function(h,i){if(i==null){i=function(){}}var c=enchant.Game.instance;var e=h;var g=e.indexOf("?");if(0<=g){e=e.substring(0,g)}var d=e.match(/\.(\w)+$/);e=d[0];if(e){e=e.slice(1).toLowerCase()}switch(e){case"jpg":case"gif":case"png":c.assets[h]=enchant.Surface.load(h);c.assets[h].addEventListener("load",i);break;case"mp3":case"aac":case"m4a":case"wav":case"ogg":c.assets[h]=enchant.Sound.load(h,"audio/"+e);c.assets[h].addEventListener("load",i);break;default:var f=new XMLHttpRequest();f.open("GET",h,true);f.onreadystatechange=function(k){if(f.readyState==4){if(f.status!=200){throw new Error("Cannot load an asset: "+h)}var j=f.getResponseHeader("Content-Type")||"";if(j.match(/^image/)){c.assets[h]=enchant.Surface.load(h);c.assets[h].addEventListener("load",i)}else{if(j.match(/^audio/)){c.assets[h]=enchant.Sound.load(h,j);c.assets[h].addEventListener("load",i)}else{c.assets[asset]=f.responseText;i()}}}};f.send(null)}};var b=(function(){var c=navigator.userAgent;if(c.indexOf("Opera")!=-1){return"O"}else{if(c.indexOf("MSIE")!=-1){return"ms"}else{if(c.indexOf("WebKit")!=-1){return"webkit"}else{if(navigator.product=="Gecko"){return"Moz"}else{return""}}}}})();var a=(function(){var c=document.createElement("div");c.setAttribute("ontouchstart","return");return typeof c.ontouchstart=="function"})();enchant.Sound.load=function(h,e){var c=enchant.Game.instance;if(e==null){var d=h.match(/\.\w+$/)[0];if(d){e="audio/"+d.slice(1).toLowerCase()}else{e=""}}e=e.replace("mp3","mpeg");var g=Object.create(enchant.Sound.prototype);enchant.EventTarget.call(g);var f=new Audio();if(!enchant.Sound.enabledInMobileSafari&&b=="webkit"&&a){window.setTimeout(function(){g.dispatchEvent(new enchant.Event("load"))},0)}else{if(f.canPlayType(e)){f.src=h;f.load();f.autoplay=false;f.onerror=function(){throw new Error("Cannot load an asset: "+f.src)};f.addEventListener("canplaythrough",function(){g.duration=f.duration;g.dispatchEvent(new enchant.Event("load"))},false);g._element=f}else{if(e=="audio/mpeg"){var j=document.createElement("embed");var i="enchant-audio"+c._soundID++;j.width=j.height=1;j.name=i;j.src="game/sound.swf?id="+i+"&src="+h;j.allowscriptaccess="always";j.style.position="absolute";j.style.left="-1px";g.addEventListener("load",function(){Object.defineProperties(j,{currentTime:{get:function(){return j.getCurrentTime()},set:function(k){j.setCurrentTime(k)}},volume:{get:function(){return j.getVolume()},set:function(k){j.setVolume(k)}}});g._element=j;g.duration=j.getDuration()});c._element.appendChild(j);enchant.Sound[i]=g}else{window.setTimeout(function(){g.dispatchEvent(new enchant.Event("load"))},0)}}}return g}}());
"@file osakana4242.js";var osakana4242=osakana4242||{};(function(){osakana4242.namespace=function(t){var s=t.split("."),r=osakana4242;if(s[0]==="osakana4242"){s=s.slice(1)}for(var q=0;q<s.length;q+=1){if(typeof r[s[q]]==="undefined"){r[s[q]]={}}r=r[s[q]]}return r};osakana4242.namespace("core");var b=enchant.Class;var p=b.create(b,{initialize:function(q,r){this.x=q||0;this.y=r||0},});osakana4242.Vector2D=p;osakana4242.TimeLeap=b.create({initialize:function(){this.cnt=0;this.cntMax=0;this.resetCnt(0)},resetCnt:function(r){var q=Game.instance;this.cnt=0;this.cntMax=Math.floor(q.fps*r)},isEnd:function(){return this.cntMax<=this.cnt},getRate:function(){return this.cnt/this.cntMax},getLerp:function(u,q,t){var r;var s=this.getRate();if(0<t){s=Math.sin((Math.PI/2)*s)}r=u+(q-u)*s;return r},getLerpForList:function(s,A){var w;var v=this.getRate();if(0<A){v=Math.sin((Math.PI/2)*v)}var t=s.length;if(t<2){error("iilegal args");return 0}if(v<1){var q=Math.floor(v*(t-1));var u=q+1;var r=s[q];var x=s[u];var y=1/(t-1);var z=(v-q*y)/y;w=r+(x-r)*z}else{w=s[t-1]}return w},exec:function(){this.cnt+=1;if(this.cntMax<this.cnt){this.cnt=this.cntMax}},});var e=osakana4242.TimeLeap;var a={sign:function(q){if(0<q){return 1}else{if(q<0){return -1}else{return 0}}},trim:function(q,s,r){if(q<s){return s}if(r<q){return r}return q}};osakana4242.NUtil=a;var o={secToFrame:function(r){var q=Game.instance;return Math.floor(r*q.fps)},frameToSec:function(r){var q=Game.instance;return r/q.fps},secDotToFrameDot:function(r){var q=Game.instance;return r/q.fps},csv:function(){var s="";for(var r=0,q=arguments.length;r<q;++r){s+=arguments[r]+","}return s},randomIntMinMax:function(t,s){var q=s-t;var r=t+Math.floor(Math.random()*(q+1));return r},shuffleList:function(v,q,u){if(!u){u=osakana4242.Util.randomIntMinMax}for(var t=0;t<q;t+=1){var r=u(0,q-1);var s=v[t];v[t]=v[r];v[r]=s}},arrayToString:function(r,v){var v=v||"";var w="";w=v+"[\n";var q=false;for(var s=0,u=r.length;s<u;s+=1){if(0<s){w+=", ";if(q){w+="\n"}}var t=r[s];if(t instanceof Array){w+=this.arrayToString(t,v+"\t");q=true}else{if(s==0){w+=v+"\t"}w+=t;q=false}}w+="\n";w+=v+"]";return w},isInside1D:function(t,r,s,q){return(t<=s)&&(s+q<=t+r)},isInside2D:function(u,x,r,w,s,v,q,t){if(o.isInside1D(u,r,s,q)===false){return false}return o.isInside1D(x,w,v,t)},isHit1D:function(t,r,s,q){return(0<Math.min(t+r,s+q)-Math.max(t,s))},isHit2D:function(u,x,r,w,s,v,q,t){if(o.isHit1D(u,r,s,q)===false){return false}return o.isHit1D(x,w,v,t)},isHitLineAndLine:function(z,y,B,A,H,G,r,q){var F=B-z;var D=A-y;var K=-D;var J=F;var x=Math.sqrt((K*K)+(J*J));if(0<x){x=1/x}K*=x;J*=x;var u=r-H;var s=q-G;var I=-(z*K+y*J);var E=(K*u+J*s);if(E==0){return false}var C=-(K*H+J*G+I)/E;if(C<=0||1<C){return false}var w=H+u*C;var v=G+s*C;var L=((z-w)*(B-w))+((y-v)*(A-v));if(L<0){return true}else{return false}},isHitLineAndRect:function(w,v,t,r,s,q,u,D){var B=Math.min(w,t);var A=Math.min(v,r);var C=Math.abs(t-w)+1;var x=Math.abs(r-v)+1;if(!o.isHit2D(B,A,C,x,s,q,u,D)){return false}if(o.isInside2D(s,q,u,D,B,A,C,x)){return true}var F=s;var z=q;var E=s+u;var y=q+D;if(o.isHitLineAndLine(w,v,t,r,F,z,E,z)||o.isHitLineAndLine(w,v,t,r,F,y,E,y)||o.isHitLineAndLine(w,v,t,r,F,z,F,y)||o.isHitLineAndLine(w,v,t,r,E,z,E,y)){return true}return false},getLineToPointDistance:function(w,v,C,A,B,z){var G=C-w;var F=A-v;var J=-F;var I=G;var s=Math.sqrt((J*J)+(I*I));if(0<s){s=1/s}J*=s;I*=s;var H=-(w*J+v*I);var y=-(J*B+I*z+H);var r=B+J*y;var q=z+I*y;var K=((w-r)*(C-r))+((v-q)*(A-q));var u=osakana4242.Util;var D=0;if(K<0){D=u.getPToPDistance(B,z,r,q)}else{var x=u.getPToPDistance2(B,z,r,q);var E=u.getPToPDistance2(B,z,r,q);D=Math.min(x,E);D=Math.sqrt(D)}return D},getPToPDistance2:function(t,s,v,u){var r=v-t;var q=u-s;return r*r+q*q},getPToPDistance:function(r,q,u,s){var t=osakana4242.Util;return Math.sqrt(t.getPToPDistance2(r,q,u,s))},scalar2D:function(q,s){var r=Math.sqrt(q*q+s*s);return r},inner2D:function(s,u,r,t){var q=(s*r)+(u*t);return q}};osakana4242.Util=o;osakana4242.FpsCtrl=b.create(b,{initialize:function(){this.execTimer=0;this.frameCnt=0;this.elapsed=0;this.fpsAve=0},exec:function(s,w,v){var t=Game.instance;var r=1000/t.fps;this.execTimer+=s;var u=0;while(r<=this.execTimer){v.call(w);this.execTimer-=r;u+=1}this.frameCnt+=1;this.elapsed+=s;if(30<=this.frameCnt){this.fpsAve=Math.round(1000*this.frameCnt/this.elapsed);this.frameCnt=0;this.elapsed=0}var q=8;if(q<u){u=q}return u}});osakana4242.Sound=b.create(b,{initialize:function(s,t,r){var q=l.instance;var u=q.assets(s);this.sounds=[u];this.idx=0;this.num=1;this.playTime=t;this.isLoop=r;this.isPlaying=false;this.timeoutId=null},play:function(){this.isPlaying=true;this._play()},clearTimeout:function(){if(this.timeoutId!=null){window.clearTimeout(this.timeoutId);this.timeoutId=null}},_play:function(){this.timeoutId=null;this.clearTimeout();this._stop();if(this.isPlaying){this.sounds[this.idx].play();var r=this;if(this.isLoop){var q=Math.floor(this.playTime*1000);this.timeoutId=window.setTimeout(function(){r._play.call(r)},q)}}this.idx+=1;if(this.num<=this.idx){this.idx=0}},_stop:function(){for(var q=0;q<this.sounds.length;q+=1){try{this.sounds[q].stop()}catch(r){d.debug.log(o.csv("sound",q,"stop",r));if(r.message=="DOM Exception: INVALID_STATE_ERR (11)"){}else{throw r}}}},stop:function(){this.isPlaying=false;this.clearTimeout();this._stop()}});var m=osakana4242.Sound;osakana4242.SoundMgr=b.create(b,{initialize:function(){this.channels={bgm:{name:""},se:{name:""}};this.soundList={}},play:function(q,r){if(!l.instance.appConfig.isSoundLoad){return}this.stop(q);var s=this.channels[q];s.name=r;this.soundList[s.name].play()},stop:function(q){if(!l.instance.appConfig.isSoundLoad){return}var r=this.channels[q];if(r.name!=""){this.soundList[r.name].stop();r.name=""}},add:function(r,s,q){if(!l.instance.appConfig.isSoundLoad){return}this.soundList[r]=new m(r,s,q)},exec:function(){}});var h=osakana4242.SoundMgr;osakana4242.core.FastRandom=b.create(b,{initialize:function(){this._seed=0;this._mulValue=69069;this._addValue=1},seed:{get:function(){return this._seed},set:function(q){this._seed=Math.floor(q);d.debug.log(o.csv("setSeed seed",this._seed))}},getInt:function(){this._seed=(this._seed*this._mulValue+this._addValue)&2147483647;return this._seed>>16},getIntN:function(r){var q=this.getInt()%r;return q},getIntMinMax:function(s,q){var r=q-s+1;return s+this.getIntN(r)}});var g=osakana4242.core.FastRandom;var i=b.create(b,{initialize:function(r,q){this.frameTime=r;this.frameNum=q.length;this.frameList=q}});osakana4242.AnimData=i;var n=b.create(b,{initialize:function(){this.waitCnt=0;this.speed=1;this.frameIdx=0;this.animData=null;this._animId=""},setAnimId:function(q){this.animId=q},getAnimId:function(){return this.animId},animId:{get:function(){return this._animId},set:function(q){this._animId=q;this.animData=n.DATA_LIST[this._animId];this.waitCnt=0;this.frameIdx=0;this.speed=1},},curFrame:{get:function(){if(this.animData!=null){return this.animData.frameList[this.frameIdx]}else{return 0}},},getCurFrame:function(){return this.curFrame},exec:function(){if(this.animData==null){return}this.waitCnt+=1;if(o.secToFrame(this.animData.frameTime)/this.speed<=this.waitCnt){this.frameIdx+=1;if(this.animData.frameNum<=this.frameIdx){this.frameIdx=0}this.waitCnt=0}}});n.DATA_LIST={};osakana4242.Anim=n;osakana4242.NineleapUtil={sendScore:function(r,q){if(location.hostname=="r.jsgames.jp"){var s=location.pathname.match(/^\/games\/(\d+)/)[1];location.replace(["http://9leap.net/games/",s,"/result","?score=",encodeURIComponent(r),"&result=",encodeURIComponent(q)].join(""))}}};var k=b.create(b,{initialize:function(){this.pos=new p();this.isMove=false;this.isStart=false;this.isEnd=false}});osakana4242.Input=k;var j=b.create(b,{initialize:function(){this.inputW=new k();this.inputR=new k()},setScene:function(s){var q=osakana4242.Core.instance;var r=this;s.addEventListener(enchant.Event.TOUCH_START,function(t){q.input.onTouchStart.call(r,t)});s.addEventListener(enchant.Event.TOUCH_MOVE,function(t){q.input.onTouchMove.call(r,t)});s.addEventListener(enchant.Event.TOUCH_END,function(t){q.input.onTouchEnd.call(r,t)})},onTouchStart:function(q){this.inputW.isStart=true;this.inputW.pos.x=q.x;this.inputW.pos.y=q.y},onTouchMove:function(q){this.inputW.isMove=true;this.inputW.pos.x=q.x;this.inputW.pos.y=q.y},onTouchEnd:function(q){this.inputW.isEnd=true;this.inputW.pos.x=q.x;this.inputW.pos.y=q.y},exec:function(){var q=this.inputR;q.pos.x=this.inputW.pos.x;q.pos.y=this.inputW.pos.y;q.isStart=this.inputW.isStart;this.inputW.isStart=false;q.isMove=this.inputW.isMove;this.inputW.isMove=false;q.isEnd=this.inputW.isEnd;this.inputW.isEnd=false},getInput:function(){return this.inputR}});osakana4242.InputMgr=j;var c=b.create(b,{initialize:function(){this.resPath=html.resPath||"";this.cacheStr="?v=hoge"}});var d={debug:console,};osakana4242.Logger=d;d.debug={log:function(){}};var l=b.create(b,{initialize:function(q,r){if(l.instance!=null){return}this.appConfig=q;this.sound=new h();this.input=new j();this.fade=new f();this.randomMap={};this.randomMap.core_default=new g();this.debug={error:function(t){var s=Game.instance;window.alert(t);s.stop()},};l.instance=this},exec:function(){this.input.exec();this.sound.exec();this.fade.exec()},assets:function(r){var q=Game.instance;return q.assets[this.getResUrl(r)]},getResUrl:function(q){return this.appConfig.resPath+q+this.appConfig.cacheStr},preload:function(q){var r=Game.instance;for(var u=0,t=q.length;u<t;++u){var s=this.getResUrl(q[u]);r.preload(s)}}});var f=b.create(b,{initialize:function(){var q=l.instance;this.curValue=1;this.startValue=0;this.endValue=0;this.tl=new e()},attachLayer:function(r){var q=new Sprite();r.addChild(q);q.x=0;q.y=0;q.width=320;q.height=320;q.backgroundColor="rgb(0,0,0)";q.opacity=this.curValue;q.touchEnabled=false;this.sprite=q},updateSprite:function(q){q.opacity=this.curValue},exec:function(q){if(this.tl.isEnd()){return}this.tl.exec();this.curValue=this.tl.getLerp(this.startValue,this.endValue,0);this.updateSprite(this.sprite)},fadeIn:function(q){this.endValue=0;if(q==0){this.curValue=this.endValue}this.tl.resetCnt(q);this.startValue=this.curValue},fadeOut:function(q){this.endValue=1;if(q==0){this.curValue=this.endValue}this.tl.resetCnt(q);this.startValue=this.curValue},isEnd:function(){return this.tl.isEnd()}});osakana4242.core.Fader=f;osakana4242.Core=l}());
"@file df.js";(function(){var e=osakana4242.namespace("jump_hell");var d=osakana4242.namespace("jump_hell.DF");d.VERSION=21;d.FLG_FPS=false;d.SC_W=320;d.SC_H=320;d.SC_CX=d.SC_W/2;d.SC_CY=d.SC_H/2;d.BASE_FPS=20;d.PANEL_SIZE=48;d.SCORE_MAX=99999999;d.CHAIN_TIME=1;d.PANEL_TIME=3;d.JUMP_TIME=0.5;d.JUMP_TIME_SLOW=1;d.JUMP_TIME_FAST=0.5;d.PANEL_GROUP_W=320;d.PANEL_GROUP_H=240;d.LEVEL_PANEL_GROUP_NUM=16;d.LEVEL_MAX=4;d.FONT_SIZE=16;d.PANEL_SLIDE_TIME=0.5;d.PANEL_TAP_RANK_A=1;d.PANEL_TAP_RANK_B=2;d.PANEL_TAP_RANK_C=3;d.PANEL_TAP_RANK_D=4;d.PANEL_TAP_RANK_E=5;d.PANEL_TAP_RANK_NUM=5;d.BUTTON_FRAME_PAUSE=10;d.BUTTON_FRAME_PLAY=11;function b(n,h){var f={};for(var l=0,k=h.length;l<k;++l){var o=h[l];var i={};for(var g=0,m=n.length;g<m;++g){var j=n[g];i[j]=o[g]}f[i.id]=i}return f}d.PANEL_TAP_RANK_MAP=b(["id","score","name","judge_distance","trim_distance","flg_chain"],[[1,500,"PERFECT",16,0,1],[2,300,"GREAT",24,4,1],[3,100,"GOOD",48,8,1],[4,50,"BAD",56,12,0],[5,10,"BAD",99,16,0],]);d.PANEL_JUMP_TIME_MAP=b(["id","score","time","flg_chain"],[[1,1000,0.1,1],[2,500,0.2,1],[3,400,0.3,1],[4,300,0.4,1],[5,200,0.5,1],[6,100,1,1],[7,50,2,0],[8,40,3,0],[9,30,4,0],[10,20,9,0],]);d.PANEL_JUMP_TIME_RANK_A=1;d.PANEL_JUMP_TIME_RANK_B=2;d.PANEL_JUMP_TIME_RANK_C=3;d.PANEL_JUMP_TIME_RANK_D=4;d.PANEL_JUMP_TIME_RANK_E=5;d.PANEL_JUMP_TIME_RANK_F=6;d.PANEL_JUMP_TIME_RANK_G=7;d.PANEL_JUMP_TIME_RANK_H=8;d.PANEL_JUMP_TIME_RANK_I=9;d.PANEL_JUMP_TIME_RANK_J=10;d.PANEL_JUMP_TIME_RANK_NUM=10;d.CHAIN_CNT_MAX=16;d.CHAIN_ANIM_LIST=[["star_1"],["star_1",'star_2"'],["star_2"],["star_2","star_3"],["star_3"],["star_3","star_4"],["star_4"]];d.PLAY_TYPE_STAGE_SELECT=1;d.PLAY_TYPE_ALL_STAGE=2;var a=enchant.Class.create(enchant.Class,{initialize:function(i,h,f){this.r=i;this.g=h;this.b=f},makeStr:function(){return"rgb("+this.r+","+this.g+","+this.b+")"}});e.ColorRGB=a;var c=enchant.Class.create(enchant.Class,{initialize:function(f){this.color=f}});c.DEFAULT=new c(new a(255,255,255));e.PanelAttr=c}());
"@file sprite.js";(function(){var b=osakana4242.namespace("Core");var a=enchant.Class;osakana4242.Sprite=a.create(enchant.Sprite,{initialize:function(d,c){enchant.Sprite.call(this,d,c)},cx:{get:function(){return this.x+this.width/2},set:function(c){this.x=c-this.width/2}},cy:{get:function(){return this.y+this.height/2},set:function(c){this.y=c-this.height/2}},getCx:function(){return this.cx},getCy:function(){return this.cy},setCx:function(c){this.cx=c},setCy:function(c){this.cy=c},setText:function(c){var e=16;var d=16;this.width=c.length*e;this.height=e;if(this.image===null||this.image.width!=this.width||this.image.height!=this.height){this.image=new Surface(e*c.length,e)}this.drawText(c,e,d,this.image)},drawText:function(g,o,m,c){var k,j,h,n,e;var d=b.instance;c.clear();for(var f=0,l=g.length;f<l;f++){n=g.charCodeAt(f);if(n>=32&&n<=127){e=n-32}else{e=0}k=e%m;j=Math.floor(e/m);c.draw(d.assets("img/font.png"),k*o,j*o,o,o,f*o,0,o,o)}}});osakana4242.Sprite3D=a.create(osakana4242.Sprite,{initialize:function(d,c){osakana4242.Sprite.call(this,d,c);this.yy=0;this.yz=0},yy:{set:function(c){this._yy=c;this.y=this._yy+this._yz},get:function(){return this._yy}},yz:{set:function(c){this._yz=c;this.y=this._yy+this._yz},get:function(){return this._yz}},cyy:{get:function(){return this.yy+this.height/2},set:function(c){this.yy=c-this.height/2}},cyz:{get:function(){return this.yz+this.height/2},set:function(c){this.yz=c-this.height/2}}})}());
"@file sprite_camera.js";(function(){var b=enchant.Class;var d=osakana4242.namespace("TimeLeap");var f=osakana4242.namespace("Util");var c=osakana4242.namespace("Sprite");var e=osakana4242.namespace("Core");var g=osakana4242.namespace("jump_hell");var a=b.create(c,{initialize:function(i,j){c.call(this);this.x=0;this.y=0;this.tx=0;this.ty=0;this.vw=i;this.vh=j;this.visible=false;this.speedMax=f.secDotToFrameDot(1000);this.speedMin=f.secDotToFrameDot(10);var h=new c();h.width=this.vw-2;h.height=this.vh-2;h.backgroundColor="rgb(255, 255, 255)";h.opacity=0.1;h.visible=false;this.cameraSprite=h;h=new c();h.width=16;h.height=16;h.backgroundColor="rgb(255, 255, 255)";h.visible=false;this.cameraTargetSprite=h;this.curTargetDistance=0},exec:function(){var k=this.vw/2-16;var i=this.vw/2+16;var m=this.tx;var l=this.ty;if(m<k){}else{if(i<m){}}var t=m-this.x;var s=l-this.y;var p=Math.sqrt(t*t+s*s);this.curTargetDistance=p;var o=0<p?t/p:0;var n=0<p?s/p:0;var h=300;var j=this.speedMin+(Math.min(h,p)/h)*(this.speedMax-this.speedMin);var r=o*j;var q=n*j;if(t*t<r*r){r=t}if(s*s<q*q){q=s}this.x+=r;this.y+=q;this.cameraSprite.setCx(this.x);this.cameraSprite.setCy(this.y);this.cameraTargetSprite.setCx(this.tx);this.cameraTargetSprite.setCy(this.ty)},updateLayer:function(h){h.x=this.vw/2-this.x;h.y=this.vh/2-this.y}});osakana4242.namespace("jump_hell.sprite").Camera=a}());
osakana4242.jump_hell.STAGE_DATA={stages:[{id:1,name:"STAGE 1",flg_last:0,bg:{background_color:"rgb(52, 45, 83)",effect_vx:16,effect_vy:4},colors:[{r:255,g:0,b:0},{r:50,g:50,b:255},{r:0,g:200,b:0},{r:230,g:230,b:0}],form_map:{"1_1":{colors:[0,1],panels:[{x:-40,y:-24,color_id:0}]},"2_1":{panels:[{x:-120,y:0,color_id:0},{x:120,y:0,color_id:1}]},"2_2":{panels:[{x:-88,y:-8,color_id:0},{x:88,y:8,color_id:1}]},"2_3":{panels:[{x:0,y:-40,color_id:0},{x:0,y:32,color_id:1}]},"3_1":{panels:[{x:-120,y:-40,color_id:0},{x:120,y:-40,color_id:1},{x:0,y:40,color_id:2}]},"3_2":{panels:[{x:40,y:-56,color_id:0},{x:24,y:32,color_id:1},{x:120,y:-8,color_id:2}]},"4_1":{panels:[{x:16,y:-40,color_id:0},{x:16,y:72,color_id:1},{x:-72,y:-8,color_id:2},{x:96,y:-8,color_id:3}]},"5_1":{panels:[{x:-88,y:-72,color_id:0},{x:112,y:-72,color_id:1},{x:16,y:0,color_id:2},{x:-88,y:64,color_id:3},{x:112,y:64,color_id:4}]},"6_1":{panels:[{x:-40,y:-56,color_id:0},{x:-40,y:8,color_id:0},{x:-40,y:72,color_id:0},{x:64,y:-56,color_id:1},{x:64,y:72,color_id:1},{x:64,y:8,color_id:1}]}},zone_map:{zone_1:["2_1","2_2","2_1","2_3","2_1","2_2","2_1","2_3","2_1","2_2","2_1","2_3","2_1","2_2","2_1","2_3","2_1","2_2","2_1","3_1","3_1","3_1","3_1","3_1","3_2","3_2","3_2","3_2"],zone_2:["3_1","3_1","3_1","3_1","3_1","3_2","3_2","3_2","3_2","3_2","4_1","4_1","4_1","4_1","4_1","4_1","4_1","4_1","4_1"],zone_3:["4_1","4_1","4_1","4_1","4_1","4_1","4_1","4_1","4_1","4_1","5_1","5_1","5_1","5_1","5_1","5_1","5_1"]},areas:[{colors:[0,1],zones:["zone_1"]},{colors:[0,1,2],zones:["zone_2"]},{colors:[0,1,2,3],zones:["zone_3"]}]},{id:2,name:"STAGE 2",flg_last:0,bg:{background_color:"rgb(52, 45, 83)",effect_vx:128,effect_vy:32},colors:[{r:240,g:240,b:150},{r:240,g:120,b:240},{r:100,g:255,b:255},{r:255,g:130,b:130}],form_map:{"1_1":{panels:[{x:-64,y:-40,color_id:0}]},"2_1":{panels:[{x:48,y:-48,color_id:0},{x:120,y:0,color_id:1}]},"2_2":{panels:[{x:-112,y:-56,color_id:0},{x:112,y:24,color_id:1}]},"3_1":{panels:[{x:-56,y:48,color_id:0},{x:48,y:-56,color_id:0},{x:-8,y:-8,color_id:1}]},"3_2":{panels:[{x:-72,y:56,color_id:0},{x:104,y:16,color_id:1},{x:-8,y:-64,color_id:2}]},"4_1":{panels:[{x:-80,y:-40,color_id:0},{x:80,y:-40,color_id:1},{x:-72,y:48,color_id:2},{x:72,y:48,color_id:3}]},"4_2":{panels:[{x:-96,y:-40,color_id:0},{x:40,y:-72,color_id:1},{x:-24,y:32,color_id:2},{x:96,y:48,color_id:3}]},"5_1":{panels:[{x:-88,y:-40,color_id:0},{x:88,y:-40,color_id:1},{x:0,y:0,color_id:2},{x:-88,y:40,color_id:3},{x:88,y:40,color_id:4}]}},zone_map:{zone_1:["1_1","2_1","3_1","4_1"],zone_2:["2_1","4_2","2_2","5_1"],zone_speed:["1_1","2_1","3_1","4_1","1_1","1_1","1_1","1_1","1_1","1_1","1_1","1_1"],zone_3:["3_1","2_1","3_2","2_1"]},areas:[{colors:[0,1],zones:["zone_1","zone_1","zone_2","zone_2"]},{colors:[0,1],zones:["zone_speed"]},{colors:[0,1,2],zones:["zone_2","zone_2","zone_3","zone_speed"]},{colors:[0,1,2,3],zones:["zone_2","zone_2","zone_3","zone_3"]},{colors:[0,1,2,3],zones:["zone_speed"]}]},{id:3,name:"STAGE 3",flg_last:1,bg:{background_color:"rgb(83, 45, 52)",effect_vx:16,effect_vy:4},colors:[{r:255,g:10,b:10},{r:0,g:200,b:0},{r:128,g:96,b:255},{r:224,g:0,b:224},{r:0,g:224,b:224},{r:224,g:224,b:0}],form_map:{"1_1":{panels:[{x:-64,y:-40,color_id:0}]},"2_1":{panels:[{x:48,y:-48,color_id:0},{x:120,y:48,color_id:1}]},"3_1":{panels:[{x:-72,y:40,color_id:0},{x:56,y:-56,color_id:1},{x:-8,y:-8,color_id:2}]},"4_1":{panels:[{x:-80,y:-32,color_id:0},{x:104,y:-72,color_id:1},{x:-112,y:64,color_id:2},{x:8,y:56,color_id:3}]},"4_2":{panels:[{x:0,y:-80,color_id:0},{x:56,y:-64,color_id:1},{x:-88,y:32,color_id:2},{x:64,y:72,color_id:3}]},"5_1":{panels:[{x:-88,y:-40,color_id:0},{x:24,y:-56,color_id:1},{x:-32,y:-72,color_id:2},{x:-104,y:16,color_id:3},{x:80,y:-16,color_id:4}]},"5_2":{panels:[{x:-72,y:-96,color_id:0},{x:56,y:-48,color_id:1},{x:-16,y:-24,color_id:2},{x:-104,y:0,color_id:3},{x:8,y:64,color_id:4}]},"6_1":{panels:[{x:-112,y:-88,color_id:0},{x:-112,y:8,color_id:1},{x:-64,y:56,color_id:2},{x:-16,y:8,color_id:3},{x:32,y:-40,color_id:4},{x:80,y:8,color_id:5}]},"6_2":{panels:[{x:-32,y:-88,color_id:0},{x:48,y:-72,color_id:1},{x:-96,y:-32,color_id:2},{x:96,y:0,color_id:3},{x:-80,y:40,color_id:4},{x:24,y:80,color_id:5}]},"7_1":{panels:[{x:-88,y:-40,color_id:0},{x:88,y:-40,color_id:1},{x:0,y:0,color_id:2},{x:-88,y:40,color_id:3},{x:88,y:40,color_id:4},{x:0,y:-80,color_id:5},{x:0,y:80,color_id:6}]},"7_2":{panels:[{x:-96,y:-72,color_id:0},{x:-40,y:-56,color_id:1},{x:16,y:-32,color_id:2},{x:-112,y:-8,color_id:3},{x:-48,y:8,color_id:4},{x:16,y:32,color_id:5},{x:80,y:48,color_id:6}]},"8_1":{panels:[{x:-88,y:-88,color_id:0},{x:-32,y:-80,color_id:1},{x:24,y:-72,color_id:2},{x:80,y:-64,color_id:3},{x:72,y:-8,color_id:4},{x:16,y:0,color_id:5},{x:-40,y:8,color_id:6},{x:-96,y:16,color_id:7}]},"8_2":{panels:[{x:-56,y:-88,color_id:0},{x:-24,y:-32,color_id:1},{x:16,y:24,color_id:2},{x:128,y:-40,color_id:3},{x:48,y:88,color_id:4},{x:72,y:0,color_id:5},{x:-32,y:72,color_id:6},{x:-88,y:88,color_id:7}]}},zone_map:{zone_10:["8_1","2_1","2_1","2_1","3_1","3_1","3_1","3_1","3_1","3_1"],zone_20:["4_1","4_1","4_1","5_1","5_1","5_1","5_1","5_1","5_1","5_1","5_1","5_1"],zone_30:["3_1","3_1","3_1","5_1","5_1","5_1","5_1","5_2","5_2","5_2","5_2","5_2","6_1","6_1","6_1","6_1","6_1","6_1","6_1","6_1","6_1","6_1","6_1","6_1","7_1","7_1"],zone_31:["3_1","3_1","7_1","3_1","7_2","7_2"],zone_40:["7_2","7_1","7_1","8_1","8_2"],zone_41:["7_1","7_2","8_1","8_2","8_1"]},areas:[{colors:[0,1,2],zones:["zone_10"]},{colors:[3,4,5],zones:["zone_20"]},{colors:[1,2,3,4],zones:["zone_30","zone_31"]},{colors:[0,1,2,3,4,5],zones:["zone_40","zone_41"]}]},{id:4,name:"TEST STAGE",flg_last:1,bg:{background_color:"rgb(52, 45, 83)",effect_vx:100,effect_vy:20},colors:[{r:255,g:0,b:0},{r:50,g:50,b:255},{r:0,g:200,b:0},{r:230,g:230,b:0}],form_map:{"1_1":{colors:[0,1],panels:[{x:-40,y:-24,color_id:0}]}},zone_map:{zone_1:["1_1","1_1","1_1","1_1"]},areas:[{colors:[0,1],zones:["zone_1"]}]}]};
"@file scene_load.js";(function(){enchant();var c=osakana4242.Logger;var h=osakana4242.jump_hell;var g=osakana4242.jump_hell.DF;var f=osakana4242.Vector2D;var e=osakana4242.TimeLeap;var b=osakana4242.core;var d=osakana4242.Sprite;var a=Class.create(Scene,{initialize:function(){var i=Game.instance;Scene.call(this);this.addEventListener(Event.ENTER_FRAME,this.exec);this.state=0;this.tl=new e();this.frameCnt=0;var j;j=new d();this.spriteText=j;j.x=8;j.y=8;this.addChild(j)},exec:function(){var i=Game.instance;switch(this.state){case 0:this.state+=1;break;case 1:this.state+=1;break;case 2:if(this.tl.isEnd()){var j=new h.SceneTitle();i.replaceScene(j)}this.tl.exec();break}this.frameCnt+=1}});h.SceneLoad=a}());
"@file scene_title.js";(function(){enchant();var c=osakana4242.Logger;var f=osakana4242.namespace("jump_hell");var d=osakana4242.namespace("jump_hell.DF");var k=osakana4242.namespace("Vector2D");var g=osakana4242.namespace("NineleapUtil");var b=osakana4242.namespace("TimeLeap");var i=osakana4242.namespace("Util");var h=osakana4242.namespace("FpsCtrl");var e=osakana4242.namespace("Core");var a=osakana4242.namespace("Sprite");var j=Class.create(Scene,{initialize:function(){var l=e.instance;Scene.call(this);this.addEventListener(Event.ENTER_FRAME,this.exec);this.state=0;this.tl=new b();this.frameCnt=0;var m;m=new a();this.spriteBg=m;this.addChild(m);m.image=l.assets("img/title.png");m.width=m.image.width;m.height=m.image.height;m.setCx(d.SC_CX);m.setCy(d.SC_CY);m=new a();this.spriteText=m;this.addChild(m);m.image=l.assets("img/texts.png");m.width=320;m.height=16;m.cx=d.SC_CX;m.cy=d.SC_H-16;this.buttons=[];this.buttonPush=null;m=new a();this.buttons.push(m);m.name="RETRY";m.image=l.assets("img/buttons.png");m.width=240;m.height=48;m.setCx(d.SC_CX);m.setCy(216);m.frame=0;m.visible=false;this.addChild(m);m=new a();this.buttons.push(m);m.name="SEND_RESULT";m.image=l.assets("img/buttons.png");m.width=240;m.height=48;m.setCx(d.SC_CX);m.setCy(280);m.frame=1;m.visible=false;this.addChild(m);this.addEventListener(Event.TOUCH_END,this.onTouchEnd);this.isTouchEnd=false;this.tutorialIdx=0},onTouchEnd:function(l){this.isTouchEnd=true},exec:function(){var o;var m=Game.instance;var l=e.instance;var n=this.isTouchEnd;this.isTouchEnd=false;switch(this.state){case 0:this.state+=1;break;case 1:this.state+=1;break;case 2:o=this.spriteText;o.visible=(m.frame%i.secToFrame(1))<=i.secToFrame(0.75);if(n){l.sound.play("se","snd/se_ok.mp3");this.setBg(0);this.state+=1}this.tl.exec();break;case 3:o=this.spriteText;o.visible=(m.frame%i.secToFrame(1))<=i.secToFrame(0.75);if(n){l.sound.play("se","snd/se_ok.mp3");var p=this.tutorialIdx+1;if(p<j.TUTORIAL_LIST.length){this.setBg(p);if(p==j.TUTORIAL_LIST.length-1){}}else{this.tl.resetCnt(0.5);this.state+=1}}this.tl.exec();break;case 4:if(this.tl.isEnd()){var q=new f.SceneGame();m.replaceScene(q)}this.tl.exec();break;case 5:break}this.frameCnt+=1},setBg:function(l){var m=e.instance;this.tutorialIdx=l;this.spriteBg.image=m.assets(j.TUTORIAL_LIST[this.tutorialIdx])}});j.TUTORIAL_LIST=["img/tutorial_01.png","img/tutorial_02.png"];f.SceneTitle=j}());
"@file scene_game.js";(function(){var x=osakana4242.Logger;var d=enchant.Game;var t=enchant.Class;var s=osakana4242.Vector2D;var p=osakana4242.TimeLeap;var f=osakana4242.Util;var i=osakana4242.NUtil;var g=osakana4242.FpsCtrl;var y=osakana4242.Anim;var c=osakana4242.AnimData;var r=osakana4242.Input;var l=osakana4242.Sprite;var j=osakana4242.Sprite3D;var b=osakana4242.Core;var k=osakana4242.jump_hell;var q=osakana4242.jump_hell.PanelAttr;var n=osakana4242.jump_hell.ColorRGB;var o=osakana4242.jump_hell.DF;var e=osakana4242.jump_hell.sprite.Camera;var m={distanceToPanelTapRank:function(A){var C=o.PANEL_TAP_RANK_NUM;var B=o.PANEL_TAP_RANK_MAP;for(var D=1;D<=C;++D){var z=B[D];if(A<z.judge_distance){return z}}return B[C]},timeToJumpTimeRecord:function(D){var C=o.PANEL_JUMP_TIME_RANK_NUM;var A=o.PANEL_JUMP_TIME_MAP;for(var B=1;B<=C;++B){var z=A[B];if(D<=z.time){return z}}return A[C]},getNeetEffect:function(D,C){var A=null;if(C===undefined){C=0}for(var B=0,z=D.length;B<z;++B){var E=D[B];if(!E.isUse){E.priority=C;return E}if(E.priority<=C&&(A==null||A.frameCnt<E.frameCnt)){A=E}}A.priority=C;return A},};var u=t.create(Scene,{initialize:function(){var B=d.instance;var A=b.instance;this._isPause=false;var z=osakana4242.jump_hell.STAGE_DATA;var C=A.record.jump_hell.playProgress;this.stage=z.stages[C.curStageId-1];this.stageFormMap=this.stage.form_map;this.stageZoneMap=this.stage.zone_map;this.stagePanelAttrList=(function(D){var I=[];for(var G=0,F=D.length;G<F;++G){var E=D[G];var H=new q(new n(E.r,E.g,E.b));I.push(H)}return I}(this.stage.colors));(function(I){for(var J in I.stageZoneMap){var E=I.stageZoneMap[J];for(var D=0,G=E.length;D<G;++D){var H=E[D];var F=I.stageFormMap[H];x.debug.log(f.csv("zone",J,"form",H,F));if(F===undefined){throw new Error("invalid stage data!")}}}}(this));this.stageFormNum=(function(I){var H=0;for(var K=0,L=I.areas.length;K<L;++K){var G=I.areas[K];for(var E=0,J=G.zones.length;E<J;++E){var F=G.zones[E];var D=I.zone_map[F];H+=D.length}}return H}(this.stage));A.randomMap.game.seed=C.startRandomSeed;A.fade.fadeOut(0);Scene.call(this);this.initSprites();this.stageProgress={areaIdx:0,zoneIdx:0,zoneList:[],formIdx:0,playerLeftJump:0};this.tl=new p();this.score=C.calcTotalScore();this.chainCnt=0;this.chainCntMaxRecord=0;this.chainTimeCnt=f.secToFrame(o.CHAIN_TIME);this.panelTimeCnt=f.secToFrame(o.PANEL_TIME);this.panelAttrList=new Array(128);this.panelAttrListLen=0;this.panelAttrListIdxGet=0;this.backgroundColor=this.stage.bg["background_color"];this.formAddCnt=0;this.setScore(this.score);this.setChainCnt(0);this.initArea();this.addPanel(o.SC_W/2);this.player.setTargetPanel(this.panels[0]);this.stateCnt=0;this.state=u.STATE_IN_1;this.fpsCtrl=new g();this.chainTimeMax=f.secToFrame(o.CHAIN_TIME);this.panelTimeMax=f.secToFrame(o.PANEL_TIME)-this.chainTimeMax;this.addEventListener(Event.TOUCH_START,this.onTouch);this.addEventListener(Event.ENTER_FRAME,this.exec)},initSprites:function(){var B=d.instance;var A=b.instance;var D;this.layerBg=new Group();this.addChild(this.layerBg);this.layerStage=new Group();this.addChild(this.layerStage);this.layerSystem=new Group();this.addChild(this.layerSystem);A.fade.attachLayer(this);this.spriteBg=new w();this.spriteBg.effectVx=f.secDotToFrameDot(this.stage.bg["effect_vx"]);this.spriteBg.effectVy=f.secDotToFrameDot(this.stage.bg["effect_vy"]);this.layerBg.addChild(this.spriteBg);D=new j();this.spriteGround1=D;this.layerStage.addChild(D);D.width=640;D.height=320;D.cx=o.SC_W/2;D.yz=80;D.image=A.assets("img/ground_01.png");D=new j();this.spriteGround2=D;this.layerStage.addChild(D);D.width=640;D.height=320;D.cx=o.SC_W/2;D.yz=this.getPanelAddYFromGroupAddId(this.stageFormNum)-64;D.image=A.assets("img/ground_02.png");this.panels=new Array(16);for(var C=0;C<this.panels.length;C+=1){var z=new h();this.layerStage.addChild(z);this.panels[C]=z;z.visible=false}this.panelEffects=new Array(8);for(var C=0;C<this.panelEffects.length;C+=1){var E=new v();this.layerStage.addChild(E);this.panelEffects[C]=E}D=new j();this.layerStage.addChild(D);this.shadow=D;D.image=A.assets("img/chara_01.png");D.width=32;D.height=16;D.frame=127;D.visible=false;this.player=new a();this.layerStage.addChild(this.player);this.player.cx=o.SC_W/2;this.player.cyz=o.SC_H/2;this.camera=new e(o.SC_W,o.SC_H);this.camera.x=this.player.cx;this.camera.y=this.player.cy+160;this.layerStage.addChild(this.camera.cameraSprite);this.layerStage.addChild(this.camera.cameraTargetSprite);this.chainEffects=new Array(8);for(var C=0;C<this.chainEffects.length;C+=1){var E=new v();this.layerStage.addChild(E);this.chainEffects[C]=E}this.scoreEffects=new Array(8);for(var C=0;C<this.scoreEffects.length;C+=1){var E=new v();this.layerSystem.addChild(E);this.scoreEffects[C]=E}D=new l();this.chainGaugeFrame=D;this.layerSystem.addChild(D);D.image=A.assets("img/chain_gauge_frame.png");D.width=64;D.height=8;D.touchEnabled=false;D.cx=o.SC_CX;D.y=o.SC_H-12;D=new l();this.chainGauge=D;this.layerSystem.addChild(D);D.width=54;D.height=2;D.touchEnabled=false;D.backgroundColor="rgb(255, 255, 0)";D.x=this.chainGaugeFrame.x+5;D.y=this.chainGaugeFrame.y+3;D.setRate=function(F){if(1<F){F=F-1;this.backgroundColor="rgb(255, 255, 0)"}else{this.backgroundColor="rgb(255, 0, 0)"}this.width=54*F};D=new l();this.labelScore=D;this.layerSystem.addChild(D);D.setText("SCORE");D.touchEnabled=false;D.x=8;D.y=8;D=new l();this.labelScoreValue=D;this.layerSystem.addChild(D);D.setText("0       ");D.touchEnabled=false;D.x=8+o.FONT_SIZE*6;D.y=8;D=new l();this.labelChain=D;this.layerSystem.addChild(D);D.setText("CHAIN");D.touchEnabled=false;D.x=8;D.y=8+o.FONT_SIZE;D=new l();this.labelChainValue=D;this.layerSystem.addChild(D);D.setText("0  ");D.touchEnabled=false;D.x=8+16*6;D.y=8+o.FONT_SIZE;if(o.FLG_FPS){D=new l();this.labelFps=D;this.layerSystem.addChild(D);D.setText("FPS:00");D.touchEnabled=false;D.x=8;D.y=8+o.FONT_SIZE*2}D=new l();this.buttonPause=D;this.layerSystem.addChild(D);D.image=A.assets("img/buttons.png");D.width=48;D.height=48;D.frame=o.BUTTON_FRAME_PAUSE;D.x=8;D.y=o.SC_H-D.height-8;D=new l();this.labelPause=D;this.layerSystem.addChild(D);D.setText("PAUSE");D.visible=false;D.cx=o.SC_W/2;D.cy=o.SC_H/2;this.areaChangeEffect=new v();this.layerSystem.addChild(this.areaChangeEffect);D=new l();this.spriteStart=D;this.layerSystem.addChild(D);D.image=A.assets("img/start.png");D.width=D.image.width;D.height=D.image.height;D.visible=false;D=new l();this.spriteStageName=D;this.layerSystem.addChild(D);D.setText(this.stage.name);D.visible=false},exec:function(A){var z=this.fpsCtrl.exec(A.elapsed,this,this.execSub);if(o.FLG_FPS){this.labelFps.setText("FPS:"+this.fpsCtrl.fpsAve)}},isPause:{get:function(){return this._isPause},set:function(z){b.instance.sound.play("se","snd/se_ok.mp3");this._isPause=z;this.labelPause.visible=z;if(this.isPause){this.buttonPause.frame=o.BUTTON_FRAME_PLAY;this.scene.removeChild(this.layerStage)}else{this.buttonPause.frame=o.BUTTON_FRAME_PAUSE;this.scene.insertBefore(this.layerStage,this.layerSystem)}},},onTouch:function(E){var F={x:E.x,y:E.y,width:1,height:1};if(this.buttonPause.intersect(F)){this.isPause=!this.isPause;return}var M=null;var B=0;var I={x:0,yy:0,yz:0};for(var D=0,A=this.panels.length;D<A;++D){var z=this.panels[D];if(!this.player.isSelectablePanel(z)){continue}var H=this.layerStage.x+z.cx;var G=this.layerStage.y+z.cy;var L=H-E.x;var K=G-E.y;var C=L*L+K*K;if(M==null||C<B){M=z;B=C;I.x=-L;I.yz=-K}}if(M!=null){var J=Math.sqrt(B);this.player.setTargetPanel(M,I)}},execSprites:function(B,z){for(var A=0;A<z;A+=1){B[A].exec()}},execSub:function(){var z=b.instance;var A=d.instance;var B=null;z.exec();if(this.isPause){return}this.spriteBg.exec();this.areaChangeEffect.exec();this.execSprites(this.scoreEffects,this.scoreEffects.length);this.execSprites(this.panels,this.panels.length);this.player.exec();this.execSprites(this.panelEffects,this.panelEffects.length);this.execSprites(this.chainEffects,this.chainEffects.length);switch(this.state){case u.STATE_IN_1:z.sound.play("bgm","snd/bgm_main_intro.mp3");B=this.spriteStageName;B.visible=true;B.cx=o.SC_CX;B.cy=o.SC_CY+16;B=this.spriteStart;B.visible=true;B.cx=o.SC_CX;B.cy=-140;this.tl.resetCnt(2.25);z.fade.fadeIn(0.3);this.state+=1;break;case u.STATE_IN_2:B=this.spriteStart;B.cy=this.tl.getLerp(-40,140,1);if(this.tl.isEnd()){this.tl.resetCnt(1);this.state+=1}this.tl.exec();break;case u.STATE_IN_3:B=this.spriteStart;if(this.tl.isEnd()){B.visible=false;this.tl.resetCnt(0.25);this.state+=1}this.tl.exec();break;case u.STATE_IN_4:B=this.spriteStart;B.visible=(A.frame&1)==0;this.spriteStageName.visible=B.visible;if(this.tl.isEnd()){B.visible=false;this.spriteStageName.visible=false;z.sound.play("bgm","snd/bgm_main.mp3");this.state=u.STATE_MAIN}this.tl.exec();break;case u.STATE_MAIN:if(this.player.state==a.STATE_WAIT_2){--this.chainTimeCnt;if(this.chainTimeCnt<0){this.chainTimeCnt=0;if(0<this.chainCnt){this.setChainCnt(0)}--this.panelTimeCnt;if(this.panelTimeCnt<0){this.panelTimeCnt=0;this.player.state=a.STATE_DEAD_1;this.player.isDead=true}}this.chainGauge.setRate(this.chainTimeCnt/this.chainTimeMax+this.panelTimeCnt/this.panelTimeMax)}break;case u.STATE_OUT_1:this.tl.resetCnt(2.5);this.state+=1;break;case u.STATE_OUT_2:if(this.tl.isEnd()){z.sound.stop("bgm");this.labelScore.visible=false;this.labelScoreValue.visible=false;this.labelChain.visible=false;this.labelChainValue.visible=false;var D=z.record.jump_hell.playProgress;var C=D.stageMap[D.curStageId];C.score=this.score;C.chainMax=this.chainCntMaxRecord;C.isGameClear=this.stageProgress.playerLeftJump<=0;if(D.isFinalStage()||!C.isGameClear){A.pushScene(new k.SceneResult());this.state=u.STATE_RESULT_1}else{z.fade.fadeOut(0.3);this.state+=1}}this.tl.exec();break;case u.STATE_OUT_3:if(z.fade.isEnd()){var D=z.record.jump_hell.playProgress;D.incrementStage();A.replaceScene(new k.SceneGame())}break;case u.STATE_RESULT_1:break}this.camera.tx=this.player.cx;this.camera.ty=this.player.cyz-112;this.camera.exec();this.camera.updateLayer(this.layerStage);this.spriteBg.updatePos(this.layerStage.x/4,this.layerStage.y/4)},addPanel:function(G){var D=this.popForm();if(D==null){this.spriteGround2.cx=this.player.cx;return false}var C=this.stageProgress;var E=this.stage.areas[C.areaIdx];var A=D.panels;var F=A.length;var M=0;var N=null;var P=1;var I=1;switch(this.randomIntMinMax(0,3)){case 0:P=1;I=1;break;case 1:P=-1;I=1;break;case 2:P=1;I=-1;break;case 3:P=-1;I=-1;break}var H=this.getPanelAddYFromGroupAddId(this.formAddCnt);var L={};for(var J=0,B=this.panels.length;J<B&&M<F;++J){var z=this.panels[J];if(!z.visible){var O=A[M];var K=O.color_id;var N=L[K];if(N===undefined){N=this.popPanelAttr();L[K]=N}z.visible=true;z.areaIdx=C.areaIdx;z.formAddId=this.formAddCnt;z.cx=O.x*P+G;z.cyz=O.y*I+H+o.PANEL_GROUP_H/2;z.setAttr(N,false);z.targetX=o.PANEL_GROUP_W/2;z.targetYZ=H;M+=1}}this.formAddCnt+=1;return true},getPanelAddYFromGroupAddId:function(z){return -(z+1)*o.PANEL_GROUP_H},randomIntMinMax:function(A,z){return b.instance.randomMap.game.getIntMinMax(A,z)},popPanelAttr:function(){var A=this.panelAttrList[this.panelAttrListIdxGet];var z=this.stagePanelAttrList[A];++this.panelAttrListIdxGet;if(this.panelAttrListLen<=this.panelAttrListIdxGet){this.panelAttrListIdxGet=0;f.shuffleList(this.panelAttrList,this.panelAttrListLen,this.randomIntMinMax)}return z},initArea:function(){var F=this.stageProgress;var E=this.stage.areas[F.areaIdx];var D=E.colors;this.initPanelAttrList(D);var z=[];var C=E.zones;for(var B=0,A=C.length;B<A;++B){z.push(this.stageZoneMap[C[B]])}f.shuffleList(z,z.length,this.randomIntMinMax);F.zoneList=z},initPanelAttrList:function(B){this.panelAttrListLen=0;this.panelAttrListIdxGet=0;for(var A=0,z=B.length;A<z;++A){this.panelAttrList[A]=B[A];++this.panelAttrListLen}f.shuffleList(this.panelAttrList,this.panelAttrListpanelAttrListLen,this.randomIntMinMax)},getForm:function(){var A=this.stageProgress;if(this.stage.areas.length<=A.areaIdx){return null}var B=A.zoneList[A.zoneIdx][A.formIdx];var z=this.stageFormMap[B];return z},popForm:function(){var z=this.getForm();var A=this.stageProgress;++A.formIdx;var B=A.zoneList[A.zoneIdx];if(B===undefined){throw new Error("fromKeyList "+undefined)}if(B.length<=A.formIdx){A.formIdx=0;++A.zoneIdx;if(A.zoneList.length<=A.zoneIdx){A.zoneIdx=0;++A.areaIdx;if(this.stage.areas.length<=A.areaIdx){}else{this.initArea()}}}x.debug.log(f.csv("popForm",A.areaIdx,A.zoneIdx,A.formIdx,"form",z));if(z!=null){++A.playerLeftJump}else{x.debug.log(f.csv("form empty",A.areaIdx,A.zoneIdx,A.formIdx,"form",z,"formKey",B[A.zoneIdx]))}return z},checkChainCnt:function(){if(0<this.chainTimeCnt){this.setChainCnt(Math.min(this.chainCnt+1,o.CHAIN_CNT_MAX))}else{this.setChainCnt(1)}},catchPanelJumpEvent:function(C,A,K){var D=b.instance;D.sound.play("se","snd/se_panel.mp3");var I=0;var M=f.frameToSec((this.chainTimeMax-this.chainTimeCnt)+(this.panelTimeMax-this.panelTimeCnt));var E=m.timeToJumpTimeRecord(M);var F=o.PANEL_TAP_RANK_MAP[K];x.debug.log(f.csv("jumpTime",E.id,E.time,M,"tap",F.id,F.judge_distance));I+=E.score;I+=F.score;this.chainTimeCnt=this.chainTimeMax;this.panelTimeCnt=this.panelTimeMax;this.chainGauge.setRate(this.chainTimeCnt/this.chainTimeMax+this.panelTimeCnt/this.panelTimeMax);var L=Math.floor(I*this.chainCnt);this.setScore(this.score+L);this.labelScoreValue.text=this.score;var z=this.getScoreEffect();var J=this.layerStage.x+this.player.cx;var H=this.layerStage.y+this.player.cy-16;z.startScoreUpEffect(L,J,H);if(this.player.areaIdx!==A.areaIdx&&A.areaIdx<this.stage.areas.length){this.player.areaIdx=A.areaIdx;var G=A.areaIdx+1;this.areaChangeEffect.startAreaChangeEffect(G)}var B=this.stageProgress;--B.playerLeftJump;if(B.playerLeftJump<=0){this.scene.state=u.STATE_OUT_1;return true}else{return false}},setScore:function(z){z=Math.floor(z);this.score=z;if(o.SCORE_MAX<this.score){this.score=o.SCORE_MAX}this.labelScoreValue.setText(""+z)},setChainCnt:function(z){this.chainCnt=z;this.labelChain.visible=2<=z;this.labelChainValue.visible=2<=z;this.labelChainValue.setText("x"+z);if(this.chainCntMaxRecord<z){this.chainCntMaxRecord=z}},getPanelEffect:function(){var A=null;for(var B=0,z=this.panelEffects.length;B<z;B+=1){var C=this.panelEffects[B];if(!C.isUse){return C}if(A==null||A.frameCnt<C.frameCnt){A=C}}return A},getChainEffect:function(z){return m.getNeetEffect(this.chainEffects,z)},getScoreEffect:function(){return m.getNeetEffect(this.scoreEffects,0)},canOpenFormColor:function(B){var D=this.camera.cameraSprite;var A=this.scene.panels;for(var C=0,E=A.length;C<E;++C){var z=A[C];if(B===z.formAddId){if(!f.isHit2D(D.x,D.y,D.width,D.height,z.x,z.y,z.width,z.height)){return false}}}return true}});u.STATE_IN_1=1;u.STATE_IN_2=2;u.STATE_IN_3=3;u.STATE_IN_4=4;u.STATE_MAIN=5;u.STATE_OUT_1=6;u.STATE_OUT_2=7;u.STATE_OUT_3=8;u.STATE_RESULT_1=9;k.SceneGame=u;var a=t.create(j,{initialize:function(){j.call(this,32,32);this.x=0;this.yy=0;this.yz=0;this.footX=16;this.footY=32;this.startX=0;this.startY=0;this.targetPanelRelPos={x:0,yy:0,yz:0};this.panelTapRank=o.PANEL_TAP_RANK_A;this.curPanelRelPos={x:0,yy:0,yz:0};this.targetPanel=null;this.curPanel=null;this.state=a.STATE_WAIT_2;this.pose=0;this.anim=new y(this);this.anim.setAnimId("stand_u");this.isDead=false;this.tl=new p();this.tlChainEffect=new p();this.tmpPanelAttrList=new Array(8);this.targetTapDistance=0;var z=b.instance;this.image=z.assets("img/chara_01.png");this.touchEnabled=false;this.areaIdx=-1;this.frameCnt=0},setTargetPanel:function(B,z){if(this.state===a.STATE_WAIT_2){if(this.isSelectablePanel(B)){this.targetPanel=B;if(z){var D=Math.sqrt(z.x*z.x+z.yz*z.yz);this.targetTapDistance=D;var A=m.distanceToPanelTapRank(D);this.panelTapRank=A.id;var C=A.trim_distance;this.targetPanelRelPos.x=i.trim(z.x,-C,C);this.targetPanelRelPos.yy=0;this.targetPanelRelPos.yz=i.trim(z.yz,-C,C)}}}},isSelectablePanel:function(z){if(!z.visible){return false}if(this.curPanel===null||z.formAddId<=this.curPanel.formAddId+1&&this.curPanel!==z){return true}return false},exec:function(H){var F=b.instance;this.frame=this.anim.getCurFrame();this.anim.exec();var E=this.anim.getAnimId();switch(this.state){case a.STATE_WAIT_1:if(this.scene.state==u.STATE_MAIN){E="stand_u"}this.execPanelFit();if(this.curPanel!==null){if(this.scene.canOpenFormColor(this.curPanel.formAddId+1)){++this.state}}else{++this.state}break;case a.STATE_WAIT_2:if(this.scene.state==u.STATE_MAIN){E="stand_u";if(this.targetPanel!=this.curPanel){this.scene.checkChainCnt();var O=this.scene.getChainEffect(1);O.startPanelTapEffect(this.targetPanel.cx+this.targetPanelRelPos.x,this.targetPanel.cyz+this.targetPanelRelPos.yz,this.panelTapRank);this.state=a.STATE_JUMP_1}}this.execPanelFit();this.execChainEffect(0.1);break;case a.STATE_JUMP_1:this.scene.addPanel(this.targetPanel.cx);var P=(this.targetPanel.cx+this.targetPanelRelPos.x)-(this.x+this.footX);var M=(this.targetPanel.cyz+this.targetPanelRelPos.yz)-(this.yz+this.footY);if(P<0){E="jump_lu"}else{if(0<P){E="jump_ru"}else{E="jump_u"}}var K=i.trim(this.scene.chainCnt,1,o.CHAIN_CNT_MAX)-1;var A=o.CHAIN_CNT_MAX-1;var J=(A-K)/A;var I=o.JUMP_TIME_FAST+J*(o.JUMP_TIME_SLOW-o.JUMP_TIME_FAST);this.tl.resetCnt(I);this.tlChainEffect.resetCnt(0);this.startX=this.x;this.startYZ=this.yz;this.yy=0;F.sound.play("se","snd/se_jump.mp3");this.state+=1;break;case a.STATE_JUMP_2:this.x=this.tl.getLerp(this.startX,this.targetPanel.cx+this.targetPanelRelPos.x-this.footX,1);this.yz=this.tl.getLerp(this.startYZ,this.targetPanel.cyz+this.targetPanelRelPos.yz-this.footY,1);this.yy=this.tl.getLerpForList(a.JUMP_YY_LIST,0);this.execChainEffect(0.05);if(this.tl.isEnd()){if(this.curPanel==null||this.curPanel.attr==this.targetPanel.attr){var D=this.curPanel;this.curPanel=this.targetPanel;this.curPanelRelPos.x=this.targetPanelRelPos.x;this.curPanelRelPos.yz=this.targetPanelRelPos.yz;var N=this.curPanel.formAddId;for(var G=0,B=this.scene.panels.length;G<B;G+=1){var z=this.scene.panels[G];if(this.curPanel!=z&&z.formAddId<=N&&z.visible){z.visible=false;this.scene.getPanelEffect().startPanelKillEffect(z)}}this.curPanel.setAttr(this.getNextPanelAttr(),true);this.scene.getPanelEffect().startPanelChangeEffect(this.curPanel);var C=this.scene.catchPanelJumpEvent(D,this.curPanel,this.panelTapRank);if(C){this.state=a.STATE_CLEAR_1}else{this.state=a.STATE_WAIT_1}}else{this.scene.setChainCnt(0);this.isDead=true;this.curPanel=this.targetPanel;this.state=a.STATE_DEAD_1}}this.tl.exec();break;case a.STATE_MISS_1:this.tl.resetCnt(o.JUMP_TIME);this.startX=this.x;this.startY=this.y;this.state+=1;break;case a.STATE_MISS_2:this.x=this.tl.getLerp(this.startX,this.targetPanel.cx-this.footX,1);this.y=this.tl.getLerp(this.startY,this.targetPanel.cyz-this.footY,1);if(this.tl.isEnd()){this.curPanel=this.targetPanel;this.state=a.STATE_WAIT_1}this.tl.exec();break;case a.STATE_DEAD_1:F.sound.play("bgm","snd/jgl_game_over.mp3");E="dead";this.tl.resetCnt(1);this.startX=this.x;this.startY=this.y;this.curPanel.visible=false;this.scene.getPanelEffect().startPanelKillEffect(this.curPanel);this.curPanel=null;this.targetPanel=null;this.state+=1;break;case a.STATE_DEAD_2:this.y=this.tl.getLerp(this.startY,this.startY+32,1);this.scaleX=this.tl.getLerp(1,0.7,1);this.scaleY=this.tl.getLerp(1,0.7,1);if((this.frameCnt&1)==0){this.visible=true}else{this.visible=false}if(this.tl.isEnd()){this.visible=false;this.state+=1;this.scene.state=u.STATE_OUT_1}this.tl.exec();break;case a.STATE_DEAD_3:break;case a.STATE_CLEAR_1:F.sound.play("bgm","snd/jgl_game_clear.mp3");this.execPanelFit();E="stand_d";this.state+=1;break;case a.STATE_CLEAR_2:this.execPanelFit();break}if(E!=this.anim.getAnimId()){this.anim.setAnimId(E)}var L=this.scene.shadow;L.x=this.x;L.yz=this.yz+16;if(this.curPanel){L.yy=this.curPanel.yy}L.visible=this.curPanel&&this.curPanel.intersect(L)||this.targetPanel&&this.targetPanel.intersect(L);this.frameCnt+=1},execPanelFit:function(){if(this.curPanel!==null){this.x=this.curPanel.cx-this.footX+this.curPanelRelPos.x;this.yz=this.curPanel.cyz-this.footY+this.curPanelRelPos.yz;this.yy=this.curPanel.yy}},execChainEffect:function(z){if(this.scene.chainCnt<2||this.scene.chainTimeCnt<=0){return}if(this.tlChainEffect.isEnd()){var A=this.scene.getChainEffect(0);A.startChainEffect(this.cx+f.randomIntMinMax(-8,8),this.cy+f.randomIntMinMax(-16,16),this.scene.chainCnt);this.tlChainEffect.resetCnt(z)}this.tlChainEffect.exec()},getNextPanelAttr:function(){var D=0;var B=this.curPanel.formAddId+1;for(var C=0,E=this.scene.panels.length;C<E&&D<this.tmpPanelAttrList.length;++C){var A=this.scene.panels[C];if(B===A.formAddId){this.tmpPanelAttrList[D]=A.attr;++D}}if(D<=0){return q.DEFAULT}var z=this.scene.randomIntMinMax(0,D-1);return this.tmpPanelAttrList[z]},});a.STATE_WAIT_1=1;a.STATE_WAIT_2=2;a.STATE_JUMP_1=3;a.STATE_JUMP_2=4;a.STATE_MISS_1=5;a.STATE_MISS_2=6;a.STATE_DEAD_1=7;a.STATE_DEAD_2=8;a.STATE_DEAD_3=9;a.STATE_CLEAR_1=10;a.STATE_CLEAR_2=11;a.JUMP_YY_LIST=[0,-24,-32,-24,0];k.SpritePlayer=a;var h=t.create(j,{initialize:function(){var z=b.instance;j.call(this,o.PANEL_SIZE,o.PANEL_SIZE);this.x=32;this.y=32;this.startX=this.x;this.startY=this.yz;this.targetX=this.x;this.targetYZ=this.yz;this.areaIdx=0;this.formAddId=0;this.attr=q.DEFAULT;this.image=z.assets("img/panel.png");this.tl=new p();this.colorRGB=new n(0,0,0);this.anim=new y(this);this.anim.setAnimId("panel");this.touchEnabled=false;this.isOpenColor=false},exec:function(E){if(!this.visible){return}var A=this.scene.player;var D=this.scene.camera;if(this===A.curPanel&&0<=A.yy){var z=this.targetX-this.x;var C=this.targetYZ-this.yz;var B=this.tl.getLerp(this.startY,this.targetYZ,1)-this.yz;this.yz+=B;this.yy=-0.5*this.tl.getLerpForList(a.JUMP_YY_LIST,0);this.tl.exec()}this.frame=this.anim.getCurFrame();this.anim.exec();if(!this.isOpenColor){if(this.scene.canOpenFormColor(this.formAddId)){x.debug.log(f.csv("openColor",this.formAddId));this.backgroundColor=this.attr.color.makeStr();this.isOpenColor=true}}},setAttr:function(z,A){this.attr=z;if(A){this.backgroundColor=this.attr.color.makeStr()}else{this.backgroundColor="rgb(64,64,64)"}this.isOpenColor=A;this.tl.resetCnt(o.PANEL_SLIDE_TIME);this.startX=this.x;this.startY=this.yz},onTouch:function(z){}});k.SpritePanel=h;var v=t.create(j,{initialize:function(){j.call(this);this.execEffect=null;this.tl=new p();this.anim=new y(this);this.state=0;this.startX=0;this.startY=0;this.touchEnabled=false;this.isUse=false;this.reset(null);this.unUse()},reset:function(z){this.backgroundColor="transparent";this.scaleX=1;this.scaleY=1;this.startX=0;this.startY=0;this.rotation=0;this.frameCnt=0;this.state=0;this.opacity=1;this.execEffect=z;this.isUse=z!==null},unUse:function(){this.isUse=false;this.visible=false},exec:function(z){if(!this.isUse){return}if(this.execEffect!=null){this.execEffect(this)}this.frameCnt+=1},startAreaChangeEffect:function(z){this.reset(this.execAreaChangeEffect);this.setText("AREA "+z);this.cx=0;this.cy=o.SC_H-this.height;this.visible=true;this.tl.resetCnt(0.25)},execAreaChangeEffect:function(z){switch(z.state){case 0:if(!z.tl.isEnd()){z.visible=(this.frameCnt&1)===0;z.x=z.tl.getLerp(0,160,1)}else{z.tl.resetCnt(2);z.state+=1}break;case 1:if(!z.tl.isEnd()){z.x=z.tl.getLerp(160,170,1)}else{z.tl.resetCnt(0.25);z.state+=1}break;case 2:if(!z.tl.isEnd()){z.visible=(this.frameCnt&1)===0;z.x=z.tl.getLerp(170,o.SC_W+z.width,1)}else{z.unUse();z.state+=1}break;case 3:break}z.tl.exec()},startScoreUpEffect:function(B,A,z){this.reset(this.execScoreUpEffect);this.setText("+"+B);this.cx=A;this.cy=z;this.visible=true;this.tl.resetCnt(0.75);this.startX=A;this.startY=z},execScoreUpEffect:function(z){if(!z.tl.isEnd()){z.y=z.tl.getLerp(this.startY,this.startY-48,1)}else{z.unUse()}z.tl.exec()},startPanelTapRankEffect:function(C,z,B){this.reset(this.execPanelTapRankEffect);var A=b.instance;this.width=64;this.height=64;this.image=A.assets("img/panel_tap_effect.png");this.frame=0;this.cx=C;this.cy=z;this.visible=true;this.tl.resetCnt(0.5);this.state=1;this.startX=C;this.startY=z},execPanelTapRankEffect:function(z){switch(z.state){case 1:if(!z.tl.isEnd()){}else{this.tl.resetCnt(0.25);++z.state}break;case 2:if(!z.tl.isEnd()){z.visible=(this.frameCnt&1)===0}else{z.unUse()}break}z.tl.exec()},startChainEffect:function(C,A,F){this.reset(this.execChainEffect);var B=b.instance;this.width=16;this.height=16;this.cx=C;this.cy=A;this.visible=true;this.tl.resetCnt(0.5);this.startX=C;this.startY=A;this.endX=C+f.randomIntMinMax(-10,10);this.endY=A+f.randomIntMinMax(5,15);this.image=B.assets("img/effect.png");this.rotation=0;var z=0;if(F<5){z=0}else{if(F<10){z=1}else{if(F<15){z=2}else{if(F<20){z=3}else{if(F<25){z=4}else{if(F<30){z=5}else{z=6}}}}}}var E=o.CHAIN_ANIM_LIST[z];var D=E[f.randomIntMinMax(0,E.length-1)];this.anim.setAnimId(D);this.frame=this.anim.getCurFrame()},execChainEffect:function(z){this.frame=this.anim.getCurFrame();this.anim.exec();if(!z.tl.isEnd()){if(false){z.rotation=z.tl.getLerp(0,360,0)}z.cx=z.tl.getLerp(z.startX,z.endX,0);z.cy=z.tl.getLerp(z.startY,z.endY,0)}else{z.unUse()}z.tl.exec()},startPanelTapEffect:function(B,z){this.reset(this.execPanelTapEffect);var A=b.instance;this.width=32;this.height=32;this.cx=B;this.cy=z-16;this.visible=true;this.tl.resetCnt(0.5);this.startX=B;this.startY=z;this.image=A.assets("img/panel_tap_effect.png");this.rotation=0;var C="panel_tap_effect";this.anim.setAnimId(C);this.frame=this.anim.getCurFrame()},execPanelTapEffect:function(z){this.frame=this.anim.getCurFrame();this.anim.exec();if(!z.tl.isEnd()){}else{z.unUse()}z.tl.exec()},startPanelKillEffect:function(z){this.reset(this.execPanelKillEffect);this.image=null;this.width=o.PANEL_SIZE*0.5;this.height=o.PANEL_SIZE*0.5;this.cx=z.cx;this.cy=z.cy;this.backgroundColor=z.attr.color.makeStr();this.visible=true;this.tl.resetCnt(0.25)},execPanelKillEffect:function(A){if(!A.tl.isEnd()){var z=A.effectCnt/A.effectCntMax;A.visible=(this.frameCnt&1)===0}else{A.unUse()}A.tl.exec()},startPanelChangeEffect:function(z){this.reset(this.execPanelChangeEffect);this.image=null;this.width=o.PANEL_SIZE*1.5;this.height=o.PANEL_SIZE*1.5;this.cx=z.cx;this.cy=z.cy;this.backgroundColor=z.attr.color.makeStr();this.opacity=1;this.visible=true;this.effectCnt=0;this.effectCntMax=12;this.rotation=0;this.tl.resetCnt(0.25)},execPanelChangeEffect:function(A){if(!A.tl.isEnd()){var z=A.effectCnt/A.effectCntMax;A.visible=(this.frameCnt&1)===0;if(false){A.rotation=A.tl.getLerp(0,360,0)}}else{A.unUse()}A.tl.exec()}});k.SpriteEffect=v;var w=t.create(Group,{initialize:function(){var z=b.instance;Group.call(this);this.sprites=[];for(var B=0;B<4;++B){var A=null;A=new l();A.width=64;A.height=64;A.image=z.assets("img/bg_02.png");A.frame=0;this.addChild(A);this.sprites[B]=A}this.bgX=0;this.bgY=0;this.effectX=0;this.effectY=0;this.effectVx=0;this.effectVy=0;this.updatePos(0,0)},updatePos:function(z,D){var A=d.instance;this.bgX=z;this.bgY=D;z+=this.effectX;D+=this.effectY;if(0<=z){z=-Math.floor(o.SC_W-z)%o.SC_W+o.SC_W}if(0<=D){D=-Math.floor(o.SC_H-D)%o.SC_H+o.SC_H}z=Math.floor(z)%o.SC_W-o.SC_W;D=Math.floor(D)%o.SC_H-o.SC_H;for(var C=0;C<this.sprites.length;C+=1){var B=this.sprites[C];B.x=z+Math.floor(C%2)*o.SC_W;B.y=D+Math.floor(C/2)*o.SC_H;this.sprites[C]=B}},exec:function(z){this.effectX+=this.effectVx;this.effectY+=this.effectVy},});k.SpriteBg=w}());
"@file scene_result.js";(function(){var d=enchant.Game;var c=osakana4242.Logger;var g=osakana4242.namespace("jump_hell");var e=osakana4242.namespace("jump_hell.DF");var l=osakana4242.namespace("Vector2D");var h=osakana4242.namespace("NineleapUtil");var b=osakana4242.namespace("TimeLeap");var k=osakana4242.namespace("Util");var i=osakana4242.namespace("FpsCtrl");var f=osakana4242.namespace("Core");var a=osakana4242.namespace("Sprite");var j=Class.create(Scene,{initialize:function(){var n=d.instance;var m=f.instance;Scene.call(this);this.addEventListener(Event.ENTER_FRAME,this.exec);this.state=0;this.tl=new b();this.frameCnt=0;var p=m.record.jump_hell.playProgress;this.stageRecord=p.stageMap[p.curStageId];var o;o=new a();this.spriteResult=o;this.addChild(o);if(this.stageRecord.isGameClear){o.image=m.assets("img/clear.png")}else{o.image=m.assets("img/game_over.png")}o.width=o.image.width;o.height=o.image.height;o.setCx(e.SC_CX);o.setCy(-50);o=new a();this.spriteText=o;this.addChild(o);o.visible=false;o.setCx(e.SC_CX);o.setCy(240);o=new a();this.labelChainCntRecord=o;this.addChild(o);o=new a();this.labelResultScore=o;this.addChild(o);this.buttons=[];this.buttonPush=null;o=new a();this.buttons.push(o);o.name="RETRY";o.image=m.assets("img/buttons.png");o.width=240;o.height=48;o.setCx(e.SC_CX);o.setCy(216);o.frame=0;o.visible=false;this.addChild(o);o=new a();this.buttons.push(o);o.name="SEND_RESULT";o.image=m.assets("img/buttons.png");o.width=240;o.height=48;o.setCx(e.SC_CX);o.setCy(280);o.frame=1;o.visible=false;this.addChild(o);this.addEventListener(Event.TOUCH_END,this.onTouchEnd);m.input.setScene(this);this.isTouchEnd=false;this.tutorialIdx=0},onTouchEnd:function(m){this.isTouchEnd=true},exec:function(){var s;var p=d.instance;var n=f.instance;n.exec();var o=n.input.getInput();var q=this.isTouchEnd;this.isTouchEnd=false;switch(this.state){case 0:var s;s=this.labelResultScore;s.setText("SCORE "+this.stageRecord.score);s.visible=true;s.setCx(e.SC_W*1.5);s.y=140;s=this.labelChainCntRecord;s.setText("MAX CHAIN x"+this.stageRecord.chainMax);s.visible=false;s.setCx(-e.SC_W*1.5);s.y=140+e.FONT_SIZE*1;this.tl.resetCnt(0.25);this.state+=1;break;case 1:var s;s=this.spriteResult;s.setCy(this.tl.getLerp(-50,80,1));s=this.labelResultScore;s.setCx(this.tl.getLerp(e.SC_W*1.5,e.SC_W/2,1));s=this.labelChainCntRecord;s.setCx(this.tl.getLerp(-e.SC_W*1.5,e.SC_W/2,1));s=this.spriteText;s.visible=(p.frame%k.secToFrame(1))<=k.secToFrame(0.75);if(this.tl.isEnd()){for(var r=0;r<this.buttons.length;r+=1){s=this.buttons[r];s.visible=true}this.state+=1}this.tl.exec();break;case 2:s=this.spriteText;s.visible=(p.frame%k.secToFrame(1))<k.secToFrame(0.75);if(o.isEnd){for(var r=0;r<this.buttons.length;r+=1){s=this.buttons[r];if(k.isHit2D(s.x,s.y,s.width,s.height,o.pos.x,o.pos.y,1,1)){this.buttonPush=s;break}}}if(this.buttonPush!=null){n.sound.play("se","snd/se_ok.mp3");this.tl.resetCnt(0.5);this.state+=1}break;case 3:this.buttonPush.visible=(p.frame&1)==0;if(this.tl.isEnd()){for(var r=0;r<this.buttons.length;r+=1){s=this.buttons[r];s.visible=false}this.state+=1}this.tl.exec();break;case 4:switch(this.buttonPush.name){case"RETRY":n.record.jump_hell.playProgress.resetProgress();if(html.urlRetry){location.href=html.urlRetry}else{p.popScene();p.replaceScene(new g.SceneGame())}break;case"SEND_RESULT":s=this.spriteText;s.visible=true;s.setText("...");s.setCx(e.SC_CX);s.y=240;var t={replayData:{randomSeed:n.record.jump_hell.playProgress.startRandomSeed,input:[0,0,0,0,0],},};var m=JSON.stringify(t);if(html.sendScore){html.sendScore(this.stageRecord.score,"SCORE:"+this.stageRecord.score,m)}else{h.sendScore(this.stageRecord.score,"SCORE:"+this.stageRecord.score)}this.state+=1;break}this.buttonPush=null;break;case 5:s=this.spriteText;s.visible=(p.frame%k.secToFrame(1))<k.secToFrame(0.75);break}this.frameCnt+=1}});g.SceneResult=j}());
"@file game.js";(function(){var d=enchant.Game;var m=enchant.Sound;var h=osakana4242.jump_hell;var j=osakana4242.jump_hell.DF;var f=osakana4242.Util;var i=osakana4242.SoundList;var a=osakana4242.Core;var r=osakana4242.Anim;var c=osakana4242.AnimData;var l=osakana4242.core.Input;var k=osakana4242.core.FastRandom;var p=osakana4242.Logger;var e={resPath:html.resPath||"",cacheStr:"?v="+j.VERSION,isSoundLoad:html.isSoundLoad,isDebug:true,};var s={curStageId:1,playType:1,};var n=Class.create(Scene,{initialize:function(){this.playType=html.playType;this.startStageId=html.startStageId;this.startRandomSeed=html.startRandomSeed;this.stageMap={};this._curStageId=0;this.curStageId=parseInt(html.startStageId)},curStageId:{get:function(){return this._curStageId},set:function(t){this._curStageId=t;this.stageMap[t]={score:0}}},calcTotalScore:function(){var v=0;for(var u in this.stageMap){var t=this.stageMap[u];v+=t.score}return v},getStageById:function(x){var w=osakana4242.jump_hell.STAGE_DATA.stages;for(var v=0,u=w.length;v<u;++v){var t=w[v];if(t.id===x){return t}}return null},isFinalStage:function(){if(this.playType===j.PLAY_TYPE_ALL_STAGE){var u=this.getStageById(this.curStageId);if(u.flg_last===1){return true}var t=osakana4242.jump_hell.STAGE_DATA;if(this.curStageId===t.stages.length){return true}return false}else{return true}},resetProgress:function(){this.stageMap={};this.curStageId=this.startStageId},incrementStage:function(){if(this.isFinalStage()){}else{++this.curStageId}}});var b=new n();r.DATA_LIST={stand_u:new c(0.2,[0,1]),jump_u:new c(0.1,[0]),jump_lu:new c(0.1,[8,9]),jump_ru:new c(0.1,[16,17]),stand_d:new c(0.2,[24]),dead:new c(0.2,[32]),star_1:new c(0.05,[0,1,2,3]),star_2:new c(0.05,[8,9,10,11]),star_3:new c(0.05,[16,17,18,19]),star_4:new c(0.05,[24,25,26,27]),panel:new c(0.1,[0,1,2,3]),panel_tap_effect:new c(0.1,[0,1,2,3]),dummy:new c(0.1,[])};var q=new d(j.SC_W,j.SC_H);var o=new a(e,q);var g=html?html.isPc:false;if(g){q.fps=60}else{q.fps=j.BASE_FPS}o.randomMap.game=new k();o.randomMap.effect=new k();o.record=o.record||{};o.record.jump_hell={playProgress:b};o.preload(["img/chara_01.png","img/font.png","img/texts.png","img/buttons.png","img/panel.png","img/bg_02.png","img/bg_03.png","img/ground_01.png","img/ground_02.png","img/title.png","img/start.png","img/clear.png","img/chain_gauge_frame.png","img/effect.png","img/panel_tap_effect.png","img/game_over.png","img/tutorial_01.png","img/tutorial_02.png"]);if(e.isSoundLoad){o.preload(["snd/se_ok.mp3","snd/se_panel.mp3","snd/se_jump.mp3","snd/jgl_game_over.mp3","snd/jgl_game_clear.mp3","snd/bgm_main_intro.mp3","snd/bgm_main.mp3"])}q.addEventListener("progress",function(t){p.debug.log(f.csv("loaded",t.loaded))});q.onload=function(){var t=a.instance;t.sound.add("snd/se_ok.mp3",0,false);t.sound.add("snd/se_panel.mp3",0,false);t.sound.add("snd/se_jump.mp3",0,false);t.sound.add("snd/jgl_game_over.mp3",0,false);t.sound.add("snd/jgl_game_clear.mp3",0,false);t.sound.add("snd/bgm_main_intro.mp3",0,false);t.sound.add("snd/bgm_main.mp3",27.472,true);var u=new h.SceneLoad();q.replaceScene(u)};m.enabledInMobileSafari=false;p.debug.log("game.start");q.start()}());
