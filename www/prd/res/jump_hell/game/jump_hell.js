/**
 * enchant.js v0.5.1
 *
 * Copyright (c) Ubiquitous Entertainment Inc.
 * Dual licensed under the MIT or GPL Version 3 licenses
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */

if(typeof Object.defineProperty!=="function"){Object.defineProperty=function(a,c,b){if("value" in b){a[c]=b.value}if("get" in b){a.__defineGetter__(c,b.get)}if("set" in b){a.__defineSetter__(c,b.set)}return a}}if(typeof Object.defineProperties!=="function"){Object.defineProperties=function(b,a){for(var c in a){if(a.hasOwnProperty(c)){Object.defineProperty(b,c,a[c])}}return b}}if(typeof Object.create!=="function"){Object.create=function(a,c){function b(){}b.prototype=a;var d=new b();if(c!=null){Object.defineProperties(d,c)}return d}}if(typeof Object.getPrototypeOf!=="function"){Object.getPrototypeOf=function(a){return a.__proto__}}if(typeof Function.prototype.bind!=="function"){Function.prototype.bind=function(a){var e=this;var b=Array.prototype.slice.call(arguments,1);var d=function(){};var c=function(){var f=b.concat(Array.prototype.slice.call(arguments));return e.apply(this instanceof d?this:a||window,f)};d.prototype=e.prototype;c.prototype=new d();return c}}var enchant=function(b){if(b!=null){if(!(b instanceof Array)){b=Array.prototype.slice.call(arguments)}b=b.filter(function(c){return[c].join()})}(function a(f,g){var d=[],e,c;for(var h in f){if(f.hasOwnProperty(h)){if(typeof f[h]==="function"){window[h]=f[h]}else{if(typeof f[h]==="object"&&Object.getPrototypeOf(f[h])===Object.prototype){if(b==null){d.push(h)}else{e=b.indexOf(g+h);if(e!==-1){d.push(h);b.splice(e,1)}}}}}}for(e=0,c=d.length;e<c;e++){a(f[d[e]],g+d[e]+".")}}(enchant,""));if(b!=null&&b.length){throw new Error("Cannot load module: "+b.join(", "))}};window.addEventListener("message",function(d,a){try{var b=JSON.parse(d.data);if(b.type==="event"){enchant.Game.instance.dispatchEvent(new enchant.Event(b.value))}else{if(b.type==="debug"){switch(b.value){case"start":enchant.Game.instance.start();break;case"pause":enchant.Game.instance.pause();break;case"resume":enchant.Game.instance.resume();break;case"tick":enchant.Game.instance._tick();break;default:break}}}}catch(c){}},false);enchant.Class=function(b,a){return enchant.Class.create(b,a)};enchant.Class.create=function(d,a){if(arguments.length===0){return enchant.Class.create(Object,a)}else{if(arguments.length===1&&typeof arguments[0]!=="function"){return enchant.Class.create(Object,arguments[0])}}for(var c in a){if(a.hasOwnProperty(c)){if(typeof a[c]==="object"&&Object.getPrototypeOf(a[c])===Object.prototype){if(!("enumerable" in a[c])){a[c].enumerable=true}}else{a[c]={value:a[c],enumerable:true,writable:true}}}}var b=function(){if(this instanceof b){b.prototype.initialize.apply(this,arguments)}else{return new b()}};b.prototype=Object.create(d.prototype,a);b.prototype.constructor=b;if(b.prototype.initialize==null){b.prototype.initialize=function(){d.apply(this,arguments)}}return b};enchant.ENV={VENDOR_PREFIX:(function(){var a=navigator.userAgent;if(a.indexOf("Opera")!==-1){return"O"}else{if(a.indexOf("MSIE")!==-1){return"ms"}else{if(a.indexOf("WebKit")!==-1){return"webkit"}else{if(navigator.product==="Gecko"){return"Moz"}else{return""}}}}}()),TOUCH_ENABLED:(function(){var a=document.createElement("div");a.setAttribute("ontouchstart","return");return typeof a.ontouchstart==="function"}()),RETINA_DISPLAY:(function(){if(navigator.userAgent.indexOf("iPhone")!==-1&&window.devicePixelRatio===2){var a=document.querySelector('meta[name="viewport"]');if(a==null){a=document.createElement("meta");document.head.appendChild(a)}a.setAttribute("content","width=640");return true}else{return false}}()),USE_FLASH_SOUND:(function(){var a=navigator.userAgent;var b=navigator.vendor||"";return(location.href.indexOf("http")===0&&a.indexOf("Mobile")===-1&&b.indexOf("Apple")!==-1)}()),USE_DEFAULT_EVENT_TAGS:["input","textarea","select","area"],CANVAS_DRAWING_METHODS:["putImageData","drawImage","drawFocusRing","fill","stroke","clearRect","fillRect","strokeRect","fillText","strokeText"]};enchant.Event=enchant.Class.create({initialize:function(a){this.type=a;this.target=null;this.x=0;this.y=0;this.localX=0;this.localY=0},_initPosition:function(c,b){var a=enchant.Game.instance;this.x=this.localX=(c-a._pageX)/a.scale;this.y=this.localY=(b-a._pageY)/a.scale}});enchant.Event.LOAD="load";enchant.Event.PROGRESS="progress";enchant.Event.ENTER_FRAME="enterframe";enchant.Event.EXIT_FRAME="exitframe";enchant.Event.ENTER="enter";enchant.Event.EXIT="exit";enchant.Event.ADDED="added";enchant.Event.ADDED_TO_SCENE="addedtoscene";enchant.Event.REMOVED="removed";enchant.Event.REMOVED_FROM_SCENE="removedfromscene";enchant.Event.TOUCH_START="touchstart";enchant.Event.TOUCH_MOVE="touchmove";enchant.Event.TOUCH_END="touchend";enchant.Event.RENDER="render";enchant.Event.INPUT_START="inputstart";enchant.Event.INPUT_CHANGE="inputchange";enchant.Event.INPUT_END="inputend";enchant.Event.LEFT_BUTTON_DOWN="leftbuttondown";enchant.Event.LEFT_BUTTON_UP="leftbuttonup";enchant.Event.RIGHT_BUTTON_DOWN="rightbuttondown";enchant.Event.RIGHT_BUTTON_UP="rightbuttonup";enchant.Event.UP_BUTTON_DOWN="upbuttondown";enchant.Event.UP_BUTTON_UP="upbuttonup";enchant.Event.DOWN_BUTTON_DOWN="downbuttondown";enchant.Event.DOWN_BUTTON_UP="downbuttonup";enchant.Event.A_BUTTON_DOWN="abuttondown";enchant.Event.A_BUTTON_UP="abuttonup";enchant.Event.B_BUTTON_DOWN="bbuttondown";enchant.Event.B_BUTTON_UP="bbuttonup";enchant.EventTarget=enchant.Class.create({initialize:function(){this._listeners={}},addEventListener:function(b,c){var a=this._listeners[b];if(a==null){this._listeners[b]=[c]}else{if(a.indexOf(c)===-1){a.unshift(c)}}},on:function(){this.addEventListener.apply(this,arguments)},removeEventListener:function(c,d){var b=this._listeners[c];if(b!=null){var a=b.indexOf(d);if(a!==-1){b.splice(a,1)}}},clearEventListener:function(a){if(a!=null){delete this._listeners[a]}else{this._listeners={}}},dispatchEvent:function(d){d.target=this;d.localX=d.x-this._offsetX;d.localY=d.y-this._offsetY;if(this["on"+d.type]!=null){this["on"+d.type](d)}var c=this._listeners[d.type];if(c!=null){c=c.slice();for(var b=0,a=c.length;b<a;b++){c[b].call(this,d)}}}});(function(){var a;enchant.Game=enchant.Class.create(enchant.EventTarget,{initialize:function(g,r){if(window.document.body===null){throw new Error("document.body is null. Please excute 'new Game()' in window.onload.")}enchant.EventTarget.call(this);var m=true;if(a){m=false;a.stop()}a=enchant.Game.instance=this;this.width=g||320;this.height=r||320;this.scale=1;var n=document.getElementById("enchant-stage");if(!n){n=document.createElement("div");n.id="enchant-stage";n.style.width=window.innerWidth+"px";n.style.height=window.innerHeight+"px";n.style.position="absolute";if(document.body.firstChild){document.body.insertBefore(n,document.body.firstChild)}else{document.body.appendChild(n)}this.scale=Math.min(window.innerWidth/this.width,window.innerHeight/this.height);this._pageX=0;this._pageY=0}else{var e=window.getComputedStyle(n);g=parseInt(e.width,10);r=parseInt(e.height,10);if(g&&r){this.scale=Math.min(g/this.width,r/this.height)}else{n.style.width=this.width+"px";n.style.height=this.height+"px"}while(n.firstChild){n.removeChild(n.firstChild)}n.style.position="relative";var d=n.getBoundingClientRect();this._pageX=Math.round(window.scrollX+d.left);this._pageY=Math.round(window.scrollY+d.top)}if(!this.scale){this.scale=1}n.style.fontSize="12px";n.style.webkitTextSizeAdjust="none";this._element=n;this.fps=30;this.frame=0;this.ready=null;this.running=false;this.assets={};var k=this._assets=[];(function h(c){if(c.assets instanceof Array){[].push.apply(k,c.assets)}for(var t in c){if(c.hasOwnProperty(t)){if(typeof c[t]==="object"&&Object.getPrototypeOf(c[t])===Object.prototype){h(c[t])}}}}(enchant));this._scenes=[];this.currentScene=null;this.rootScene=new enchant.Scene();this.pushScene(this.rootScene);this.loadingScene=new enchant.Scene();this.loadingScene.backgroundColor="#000";var s=this.width*0.9|0;var q=this.width*0.3|0;var j=s*0.05|0;var l=new enchant.Sprite(s,q);l.x=(this.width-s)/2;l.y=(this.height-q)/2;var i=new enchant.Surface(s,q);i.context.fillStyle="#fff";i.context.fillRect(0,0,s,q);i.context.fillStyle="#000";i.context.fillRect(j,j,s-j*2,q-j*2);l.image=i;var b=0,f=0;this.addEventListener("progress",function(c){b=c.loaded/c.total});l.addEventListener("enterframe",function(){f*=0.9;f+=b*0.1;i.context.fillStyle="#fff";i.context.fillRect(j,0,(s-j*2)*f,q)});this.loadingScene.addChild(l);this._mousedownID=0;this._surfaceID=0;this._soundID=0;this._intervalID=null;this._offsetX=0;this._offsetY=0;this.input={};this._keybind={};this.keybind(37,"left");this.keybind(38,"up");this.keybind(39,"right");this.keybind(40,"down");var o=0;["left","right","up","down","a","b"].forEach(function(c){this.addEventListener(c+"buttondown",function(t){var u;if(!this.input[c]){this.input[c]=true;u=new enchant.Event((o++)?"inputchange":"inputstart");this.dispatchEvent(u)}this.currentScene.dispatchEvent(t);if(u){this.currentScene.dispatchEvent(u)}});this.addEventListener(c+"buttonup",function(t){var u;if(this.input[c]){this.input[c]=false;u=new enchant.Event((--o)?"inputchange":"inputend");this.dispatchEvent(u)}this.currentScene.dispatchEvent(t);if(u){this.currentScene.dispatchEvent(u)}})},this);if(m){n=enchant.Game.instance._element;var p;document.addEventListener("keydown",function(t){a.dispatchEvent(new enchant.Event("keydown"));if((37<=t.keyCode&&t.keyCode<=40)||t.keyCode===32){t.preventDefault();t.stopPropagation()}if(!a.running){return}var c=a._keybind[t.keyCode];if(c){p=new enchant.Event(c+"buttondown");a.dispatchEvent(p)}},true);document.addEventListener("keyup",function(t){if(!a.running){return}var c=a._keybind[t.keyCode];if(c){p=new enchant.Event(c+"buttonup");a.dispatchEvent(p)}},true);if(enchant.ENV.TOUCH_ENABLED){n.addEventListener("touchstart",function(t){var c=(t.target.tagName).toLowerCase();if(enchant.ENV.USE_DEFAULT_EVENT_TAGS.indexOf(c)===-1){t.preventDefault();if(!a.running){t.stopPropagation()}}},true);n.addEventListener("touchmove",function(t){var c=(t.target.tagName).toLowerCase();if(enchant.ENV.USE_DEFAULT_EVENT_TAGS.indexOf(c)===-1){t.preventDefault();if(!a.running){t.stopPropagation()}}},true);n.addEventListener("touchend",function(t){var c=(t.target.tagName).toLowerCase();if(enchant.ENV.USE_DEFAULT_EVENT_TAGS.indexOf(c)===-1){t.preventDefault();if(!a.running){t.stopPropagation()}}},true)}else{n.addEventListener("mousedown",function(t){var c=(t.target.tagName).toLowerCase();if(enchant.ENV.USE_DEFAULT_EVENT_TAGS.indexOf(c)===-1){t.preventDefault();a._mousedownID++;if(!a.running){t.stopPropagation()}}},true);n.addEventListener("mousemove",function(t){var c=(t.target.tagName).toLowerCase();if(enchant.ENV.USE_DEFAULT_EVENT_TAGS.indexOf(c)===-1){t.preventDefault();if(!a.running){t.stopPropagation()}}},true);n.addEventListener("mouseup",function(t){var c=(t.target.tagName).toLowerCase();if(enchant.ENV.USE_DEFAULT_EVENT_TAGS.indexOf(c)===-1){t.preventDefault();if(!a.running){t.stopPropagation()}}},true)}}},preload:function(b){if(!(b instanceof Array)){b=Array.prototype.slice.call(arguments)}[].push.apply(this._assets,b)},load:function(d,e){if(e==null){e=function(){}}var b=enchant.Game.findExt(d);if(enchant.Game._loadFuncs[b]){enchant.Game._loadFuncs[b].call(this,d,e,b)}else{var c=new XMLHttpRequest();c.open("GET",d,true);c.onreadystatechange=function(g){if(c.readyState===4){if(c.status!==200&&c.status!==0){throw new Error(c.status+": Cannot load an asset: "+d)}var f=c.getResponseHeader("Content-Type")||"";if(f.match(/^image/)){a.assets[d]=enchant.Surface.load(d);a.assets[d].addEventListener("load",e)}else{if(f.match(/^audio/)){a.assets[d]=enchant.Sound.load(d,f);a.assets[d].addEventListener("load",e)}else{a.assets[d]=c.responseText;e()}}}};c.send(null)}},start:function(){if(this._intervalID){window.clearInterval(this._intervalID)}else{if(this._assets.length){if(enchant.Sound.enabledInMobileSafari&&!a._touched&&enchant.ENV.VENDOR_PREFIX==="webkit"&&enchant.ENV.TOUCH_ENABLED){var h=new enchant.Scene();h.backgroundColor="#000";var l=Math.round(a.width/10);var k=new enchant.Sprite(a.width,l);k.y=(a.height-l)/2;k.image=new enchant.Surface(a.width,l);k.image.context.fillStyle="#fff";k.image.context.font=(l-1)+"px bold Helvetica,Arial,sans-serif";var b=k.image.context.measureText("Touch to Start").width;k.image.context.fillText("Touch to Start",(a.width-b)/2,l-1);h.addChild(k);document.addEventListener("touchstart",function(){a._touched=true;a.removeScene(h);a.start()},true);a.pushScene(h);return}var c={};var e=this._assets.filter(function(i){return i in c?false:c[i]=true});var g=0,j=e.length,d=function(){var i=new enchant.Event("progress");i.loaded=++g;i.total=j;a.dispatchEvent(i);if(g===j){a.removeScene(a.loadingScene);a.dispatchEvent(new enchant.Event("load"))}};for(var f=0;f<j;f++){this.load(e[f],d)}this.pushScene(this.loadingScene)}else{this.dispatchEvent(new enchant.Event("load"))}}this.currentTime=Date.now();this._intervalID=window.setInterval(function(){a._tick()},1000/this.fps);this.running=true},debug:function(){this._debug=true;this.rootScene.addEventListener("enterframe",function(b){this._actualFps=(1/b)});this.start()},actualFps:{get:function(){return this._actualFps||this.fps}},_tick:function(){var d=Date.now();var g=new enchant.Event("enterframe");g.elapsed=d-this.currentTime;this.currentTime=d;var b=this.currentScene.childNodes.slice();var c=Array.prototype.push;while(b.length){var f=b.pop();f.dispatchEvent(g);f.age++;if(f.childNodes){c.apply(b,f.childNodes)}}this.currentScene.age++;this.currentScene.dispatchEvent(g);this.dispatchEvent(g);this.dispatchEvent(new enchant.Event("exitframe"));this.frame++},stop:function(){if(this._intervalID){window.clearInterval(this._intervalID);this._intervalID=null}this.running=false},pause:function(){if(this._intervalID){window.clearInterval(this._intervalID);this._intervalID=null}},resume:function(){if(this._intervalID){return}this.currentTime=Date.now();this._intervalID=window.setInterval(function(){a._tick()},1000/this.fps);this.running=true},pushScene:function(b){this._element.appendChild(b._element);if(this.currentScene){this.currentScene.dispatchEvent(new enchant.Event("exit"))}this.currentScene=b;this.currentScene.dispatchEvent(new enchant.Event("enter"));return this._scenes.push(b)},popScene:function(){if(this.currentScene===this.rootScene){return this.currentScene}this._element.removeChild(this.currentScene._element);this.currentScene.dispatchEvent(new enchant.Event("exit"));this.currentScene=this._scenes[this._scenes.length-2];this.currentScene.dispatchEvent(new enchant.Event("enter"));return this._scenes.pop()},replaceScene:function(b){this.popScene();return this.pushScene(b)},removeScene:function(c){if(this.currentScene===c){return this.popScene()}else{var b=this._scenes.indexOf(c);if(b!==-1){this._scenes.splice(b,1);this._element.removeChild(c._element);return c}else{return null}}},keybind:function(c,b){this._keybind[c]=b},getElapsedTime:function(){return this.frame/this.fps}});enchant.Game._loadFuncs={};enchant.Game._loadFuncs.jpg=enchant.Game._loadFuncs.jpeg=enchant.Game._loadFuncs.gif=enchant.Game._loadFuncs.png=enchant.Game._loadFuncs.bmp=function(b,c){this.assets[b]=enchant.Surface.load(b);this.assets[b].addEventListener("load",c)};enchant.Game._loadFuncs.mp3=enchant.Game._loadFuncs.aac=enchant.Game._loadFuncs.m4a=enchant.Game._loadFuncs.wav=enchant.Game._loadFuncs.ogg=function(c,d,b){this.assets[c]=enchant.Sound.load(c,"audio/"+b);this.assets[c].addEventListener("load",d)};enchant.Game.findExt=function(c){var b=c.match(/\.\w+$/);if(b&&b.length>0){return b[0].slice(1).toLowerCase()}if(c.indexOf("data:")===0){return c.split(/[\/;]/)[1].toLowerCase()}return null};enchant.Game.instance=null}());enchant.Node=enchant.Class.create(enchant.EventTarget,{initialize:function(){enchant.EventTarget.call(this);this._x=0;this._y=0;this._offsetX=0;this._offsetY=0;this.age=0;this.parentNode=null;this.scene=null;this.addEventListener("touchstart",function(a){if(this.parentNode&&!this.parentNode._element){this.parentNode.dispatchEvent(a)}});this.addEventListener("touchmove",function(a){if(this.parentNode&&!this.parentNode._element){this.parentNode.dispatchEvent(a)}});this.addEventListener("touchend",function(a){if(this.parentNode&&!this.parentNode._element){this.parentNode.dispatchEvent(a)}})},moveTo:function(a,b){this._x=a;this._y=b;this._updateCoordinate()},moveBy:function(a,b){this._x+=a;this._y+=b;this._updateCoordinate()},x:{get:function(){return this._x},set:function(a){this._x=a;this._updateCoordinate()}},y:{get:function(){return this._y},set:function(a){this._y=a;this._updateCoordinate()}},_updateCoordinate:function(){if(this.parentNode){this._offsetX=this.parentNode._offsetX+this._x;this._offsetY=this.parentNode._offsetY+this._y}else{this._offsetX=this._x;this._offsetY=this._y}},remove:function(){if(this._listener){this.clearEventListener()}if(this.parentNode){this.parentNode.removeChild(this)}}});enchant.Entity=enchant.Class.create(enchant.Node,{initialize:function(){var a=enchant.Game.instance;enchant.Node.call(this);this._element=document.createElement("div");this._style=this._element.style;this._style.position="absolute";this._width=0;this._height=0;this._backgroundColor=null;this._opacity=1;this._visible=true;this._buttonMode=null;if(enchant.Game.instance._debug){this._style.border="1px solid blue";this._style.margin="-1px"}this.buttonMode=null;this.buttonPressed=false;this.addEventListener("touchstart",function(){if(!this.buttonMode){return}this.buttonPressed=true;var d=new enchant.Event(this.buttonMode+"buttondown");this.dispatchEvent(d);a.dispatchEvent(d)});this.addEventListener("touchend",function(){if(!this.buttonMode){return}this.buttonPressed=false;var d=new enchant.Event(this.buttonMode+"buttonup");this.dispatchEvent(d);a.dispatchEvent(d)});var c=this;var b=function(){c.dispatchEvent(new enchant.Event("render"))};this.addEventListener("addedtoscene",function(){b();a.addEventListener("exitframe",b)});this.addEventListener("removedfromscene",function(){a.removeEventListener("exitframe",b)});this.addEventListener("render",function(){if(this._offsetX!==this._previousOffsetX){this._style.left=this._offsetX+"px"}if(this._offsetY!==this._previousOffsetY){this._style.top=this._offsetY+"px"}this._previousOffsetX=this._offsetX;this._previousOffsetY=this._offsetY});if(enchant.ENV.TOUCH_ENABLED){this._element.addEventListener("touchstart",function(h){var g=h.touches;for(var f=0,d=g.length;f<d;f++){h=new enchant.Event("touchstart");h.identifier=g[f].identifier;h._initPosition(g[f].pageX,g[f].pageY);c.dispatchEvent(h)}},false);this._element.addEventListener("touchmove",function(h){var g=h.touches;for(var f=0,d=g.length;f<d;f++){h=new enchant.Event("touchmove");h.identifier=g[f].identifier;h._initPosition(g[f].pageX,g[f].pageY);c.dispatchEvent(h)}},false);this._element.addEventListener("touchend",function(h){var g=h.changedTouches;for(var f=0,d=g.length;f<d;f++){h=new enchant.Event("touchend");h.identifier=g[f].identifier;h._initPosition(g[f].pageX,g[f].pageY);c.dispatchEvent(h)}},false)}else{this._element.addEventListener("mousedown",function(f){var d=f.pageX;var g=f.pageY;f=new enchant.Event("touchstart");f.identifier=a._mousedownID;f._initPosition(d,g);c.dispatchEvent(f);c._mousedown=true},false);a._element.addEventListener("mousemove",function(f){if(!c._mousedown){return}var d=f.pageX;var g=f.pageY;f=new enchant.Event("touchmove");f.identifier=a._mousedownID;f._initPosition(d,g);c.dispatchEvent(f)},false);a._element.addEventListener("mouseup",function(f){if(!c._mousedown){return}var d=f.pageX;var g=f.pageY;f=new enchant.Event("touchend");f.identifier=a._mousedownID;f._initPosition(d,g);c.dispatchEvent(f);c._mousedown=false},false)}},id:{get:function(){return this._element.id},set:function(a){this._element.id=a}},className:{get:function(){return this._element.className},set:function(a){this._element.className=a}},width:{get:function(){return this._width},set:function(a){this._style.width=(this._width=a)+"px"}},height:{get:function(){return this._height},set:function(a){this._style.height=(this._height=a)+"px"}},backgroundColor:{get:function(){return this._backgroundColor},set:function(a){this._element.style.backgroundColor=this._backgroundColor=a}},opacity:{get:function(){return this._opacity},set:function(a){this._style.opacity=this._opacity=a}},visible:{get:function(){return this._visible},set:function(a){if(this._visible=a){this._style.display="block"}else{this._style.display="none"}}},touchEnabled:{get:function(){return this._touchEnabled},set:function(a){if(this._touchEnabled=a){this._style.pointerEvents="all"}else{this._style.pointerEvents="none"}}},intersect:function(a){return this._offsetX<a._offsetX+a.width&&a._offsetX<this._offsetX+this.width&&this._offsetY<a._offsetY+a.height&&a._offsetY<this._offsetY+this.height},within:function(a,c){if(c==null){c=(this.width+this.height+a.width+a.height)/4}var b;return(b=this._offsetX-a._offsetX+(this.width-a.width)/2)*b+(b=this._offsetY-a._offsetY+(this.height-a.height)/2)*b<c*c},scale:function(a,b){if(b==null){b=a}this._scaleX*=a;this._scaleY*=b;this._dirty=true},rotate:function(a){this._rotation+=a;this._dirty=true},scaleX:{get:function(){return this._scaleX},set:function(a){this._scaleX=a;this._dirty=true}},scaleY:{get:function(){return this._scaleY},set:function(a){this._scaleY=a;this._dirty=true}},rotation:{get:function(){return this._rotation},set:function(a){this._rotation=a;this._dirty=true}}});enchant.Sprite=enchant.Class.create(enchant.Entity,{initialize:function(b,a){enchant.Entity.call(this);this.width=b;this.height=a;this._scaleX=1;this._scaleY=1;this._rotation=0;this._dirty=false;this._image=null;this._frame=0;this._frameSequence=[];this._style.overflow="hidden";this.addEventListener("render",function(){if(this._dirty){var c=["rotate(",this._rotation,"deg)","scale(",this._scaleX,",",this._scaleY,")"];if(navigator.userAgent.indexOf("iPhone")!==-1){c.push("translate3d(0,0,0)")}this._style[enchant.ENV.VENDOR_PREFIX+"Transform"]=c.join("");this._dirty=false}});this.addEventListener("enterframe",function(){if(this._frameSequence.length!==0){var c=this._frameSequence.shift();if(c===null){this._frameSequence=[]}else{this._setFrame(c);this._frameSequence.push(c)}}});if(enchant.Game.instance._debug){this._style.border="1px solid red";this._style.margin="-1px"}},image:{get:function(){return this._image},set:function(c){if(c===this._image){return}if(this._image!=null){if(this._image.css){this._style.backgroundImage=""}else{if(this._element.firstChild){this._element.removeChild(this._element.firstChild);if(this._dirtyListener){this.removeEventListener("render",this._dirtyListener);this._dirtyListener=null}else{this._image._parent=null}}}}if(c!=null){if(c._css){this._style.backgroundImage=c._css}else{if(c._parent){var a=document.createElement("canvas");var b=a.getContext("2d");a.width=c.width;a.height=c.height;b.drawImage(c._element,0,0);this._dirtyListener=function(){if(c._dirty){b.drawImage(c._element);c._dirty=false}};this.addEventListener("render",this._dirtyListener);this._element.appendChild(a)}else{c._parent=this;this._element.appendChild(c._element)}}}this._image=c;this.frame=this.frame}},frame:{get:function(){return this._frame},set:function(c){if(c instanceof Array){var a=c;var b=a.shift();this._setFrame(b);a.push(b);this._frameSequence=a}else{this._setFrame(c);this._frameSequence=[];this._frame=c}}},_setFrame:function(c){if(this._image!=null){this._frame=c;var b=this._image.width/this._width|0;if(this._image._css){this._style.backgroundPosition=[-(c%b|0)*this._width,"px ",-(c/b|0)*this._height,"px"].join("")}else{if(this._element.firstChild){var a=this._element.firstChild.style;a.left=-(c%b|0)*this._width+"px";a.top=-(c/b|0)*this._height+"px"}}}}});enchant.Label=enchant.Class.create(enchant.Entity,{initialize:function(a){enchant.Entity.call(this);this.width=300;this.text=a;this.textAlign="left"},text:{get:function(){return this._element.innerHTML},set:function(a){this._element.innerHTML=a}},textAlign:{get:function(){return this._style.textAlign},set:function(a){this._style.textAlign=a}},font:{get:function(){return this._style.font},set:function(a){this._style.font=a}},color:{get:function(){return this._style.color},set:function(a){this._style.color=a}}});(function(){enchant.Map=enchant.Class.create(enchant.Entity,{initialize:function(d,b){var a=enchant.Game.instance;enchant.Entity.call(this);var c=document.createElement("canvas");if(enchant.ENV.RETINA_DISPLAY&&a.scale===2){c.width=a.width*2;c.height=a.height*2;this._style.webkitTransformOrigin="0 0";this._style.webkitTransform="scale(0.5)"}else{c.width=a.width;c.height=a.height}this._element.appendChild(c);this._context=c.getContext("2d");this._tileWidth=d||0;this._tileHeight=b||0;this._image=null;this._data=[[[]]];this._dirty=false;this._tight=false;this.touchEnabled=false;this.collisionData=null;this._listeners.render=null;this.addEventListener("render",function(){if(this._dirty||this._previousOffsetX==null){this._dirty=false;this.redraw(0,0,a.width,a.height)}else{if(this._offsetX!==this._previousOffsetX||this._offsetY!==this._previousOffsetY){if(this._tight){var o=-this._offsetX;var l=-this._offsetY;var q=-this._previousOffsetX;var n=-this._previousOffsetY;var h=o-q+a.width;var f=q-o+a.width;var j=l-n+a.height;var i=n-l+a.height;if(h>this._tileWidth&&f>this._tileWidth&&j>this._tileHeight&&i>this._tileHeight){var m,k,s,r,p,g;if(h<f){m=0;s=q-o;p=h}else{m=o-q;s=0;p=f}if(j<i){k=0;r=n-l;g=j}else{k=l-n;r=0;g=i}if(a._buffer==null){a._buffer=document.createElement("canvas");a._buffer.width=this._context.canvas.width;a._buffer.height=this._context.canvas.height}var e=a._buffer.getContext("2d");if(this._doubledImage){e.clearRect(0,0,p*2,g*2);e.drawImage(this._context.canvas,m*2,k*2,p*2,g*2,0,0,p*2,g*2);e=this._context;e.clearRect(s*2,r*2,p*2,g*2);e.drawImage(a._buffer,0,0,p*2,g*2,s*2,r*2,p*2,g*2)}else{e.clearRect(0,0,p,g);e.drawImage(this._context.canvas,m,k,p,g,0,0,p,g);e=this._context;e.clearRect(s,r,p,g);e.drawImage(a._buffer,0,0,p,g,s,r,p,g)}if(s===0){this.redraw(p,0,a.width-p,a.height)}else{this.redraw(0,0,a.width-p,a.height)}if(r===0){this.redraw(0,g,a.width,a.height-g)}else{this.redraw(0,0,a.width,a.height-g)}}else{this.redraw(0,0,a.width,a.height)}}else{this.redraw(0,0,a.width,a.height)}}}this._previousOffsetX=this._offsetX;this._previousOffsetY=this._offsetY})},loadData:function(f){this._data=Array.prototype.slice.apply(arguments);this._dirty=true;this._tight=false;for(var e=0,b=this._data.length;e<b;e++){var j=0;f=this._data[e];for(var h=0,d=f.length;h<d;h++){for(var a=0,g=f[h].length;a<g;a++){if(f[h][a]>=0){j++}}}if(j/(f.length*f[0].length)>0.2){this._tight=true;break}}},checkTile:function(b,g){if(b<0||this.width<=b||g<0||this.height<=g){return false}var d=this._image.width;var a=this._image.height;var f=this._tileWidth||d;var c=this._tileHeight||a;b=b/f|0;g=g/c|0;var e=this._data[0];return e[g][b]},hitTest:function(j,g){if(j<0||this.width<=j||g<0||this.height<=g){return false}var a=this._image.width;var k=this._image.height;var h=this._tileWidth||a;var e=this._tileHeight||k;j=j/h|0;g=g/e|0;if(this.collisionData!=null){return this.collisionData[g]&&!!this.collisionData[g][j]}else{for(var d=0,f=this._data.length;d<f;d++){var c=this._data[d];var b;if(c[g]!=null&&(b=c[g][j])!=null&&0<=b&&b<(a/h|0)*(k/e|0)){return true}}return false}},image:{get:function(){return this._image},set:function(b){var h=enchant.Game.instance;this._image=b;if(enchant.ENV.RETINA_DISPLAY&&h.scale===2){var c=new enchant.Surface(b.width*2,b.height*2);var g=this._tileWidth||b.width;var d=this._tileHeight||b.height;var i=b.width/g|0;var a=b.height/d|0;for(var e=0;e<a;e++){for(var f=0;f<i;f++){c.draw(b,f*g,e*d,g,d,f*g*2,e*d*2,g*2,d*2)}}this._doubledImage=c}this._dirty=true}},tileWidth:{get:function(){return this._tileWidth},set:function(a){this._tileWidth=a;this._dirty=true}},tileHeight:{get:function(){return this._tileHeight},set:function(a){this._tileHeight=a;this._dirty=true}},width:{get:function(){return this._tileWidth*this._data[0][0].length}},height:{get:function(){return this._tileHeight*this._data[0].length}},redraw:function(l,k,z,u){if(this._image==null){return}var v,a,j,o,m;if(this._doubledImage){v=this._doubledImage;a=this._tileWidth*2;j=this._tileHeight*2;o=-this._offsetX*2;m=-this._offsetY*2;l*=2;k*=2;z*=2;u*=2}else{v=this._image;a=this._tileWidth;j=this._tileHeight;o=-this._offsetX;m=-this._offsetY}var g=v.width/a|0;var f=v.height/j|0;var e=Math.max((l+o)/a|0,0);var s=Math.max((k+m)/j|0,0);var D=Math.ceil((l+o+z)/a);var h=Math.ceil((k+m+u)/j);var A=v._element;var c=this._context;var d=c.canvas;c.clearRect(l,k,z,u);for(var B=0,C=this._data.length;B<C;B++){var F=this._data[B];var q=Math.min(D,F[0].length);var E=Math.min(h,F.length);for(k=s;k<E;k++){for(l=e;l<q;l++){var w=F[k][l];if(0<=w&&w<g*f){var t=(w%g)*a;var p=(w/g|0)*j;c.drawImage(A,t,p,a,j,l*a-o,k*j-m,a,j)}}}}}})}());enchant.Group=enchant.Class.create(enchant.Node,{initialize:function(){enchant.Node.call(this);this.childNodes=[];this._x=0;this._y=0;[enchant.Event.ADDED_TO_SCENE,enchant.Event.REMOVED_FROM_SCENE].forEach(function(a){this.addEventListener(a,function(b){this.childNodes.forEach(function(c){c.scene=this.scene;c.dispatchEvent(b)},this)})},this)},addChild:function(f){this.childNodes.push(f);f.parentNode=this;f.dispatchEvent(new enchant.Event("added"));if(this.scene){var h=new enchant.Event("addedtoscene");f.scene=this.scene;f.dispatchEvent(h);f._updateCoordinate();var c=document.createDocumentFragment();var a;var b=Array.prototype.push;if(f._element){c.appendChild(f._element)}else{if(f.childNodes){a=f.childNodes.slice().reverse();while(a.length){f=a.pop();f.scene=this.scene;f.dispatchEvent(h);if(f._element){c.appendChild(f._element)}else{if(f.childNodes){b.apply(a,f.childNodes.reverse())}}}}}if(!c.childNodes.length){return}var g,d=this;while(d.parentNode){a=d.parentNode.childNodes;a=a.slice(a.indexOf(d)+1).reverse();while(a.length){f=a.pop();if(f._element){g=f._element;break}else{if(f.childNodes){b.apply(a,f.childNodes.slice().reverse())}}}d=d.parentNode}if(g){this.scene._element.insertBefore(c,g)}else{this.scene._element.appendChild(c)}}},insertBefore:function(b,c){var g=this.childNodes.indexOf(c);if(g!==-1){this.childNodes.splice(g,0,b);b.parentNode=this;b.dispatchEvent(new enchant.Event("added"));if(this.scene){var h=new enchant.Event("addedtoscene");b.scene=this.scene;b.dispatchEvent(h);b._updateCoordinate();var j=document.createDocumentFragment();var a;var k=Array.prototype.push;if(b._element){j.appendChild(b._element)}else{if(b.childNodes){a=b.childNodes.slice().reverse();while(a.length){b=a.pop();b.scene=this.scene;b.dispatchEvent(h);if(b._element){j.appendChild(b._element)}else{if(b.childNodes){k.apply(a,b.childNodes.reverse())}}}}}if(!j.childNodes.length){return}var f,d=c;while(d!==this){if(g!=null){a=this.childNodes.slice(g+1).reverse();g=null}else{a=d.parentNode.childNodes;a=a.slice(a.indexOf(d)+1).reverse()}while(a.length){b=a.pop();if(b._element){f=b._element;break}else{if(b.childNodes){k.apply(a,b.childNodes.slice().reverse())}}}d=d.parentNode}if(f){this.scene._element.insertBefore(j,f)}else{this.scene._element.appendChild(j)}}}else{this.addChild(b)}},removeChild:function(d){var c=this.childNodes.indexOf(d);if(c!==-1){this.childNodes.splice(c,1)}else{return}d.parentNode=null;d.dispatchEvent(new enchant.Event("removed"));if(this.scene){var f=new enchant.Event("removedfromscene");d.scene=null;d.dispatchEvent(f);if(d._element){this.scene._element.removeChild(d._element)}else{if(d.childNodes){var a=d.childNodes.slice();var b=Array.prototype.push;while(a.length){d=a.pop();d.scene=null;d.dispatchEvent(f);if(d._element){this.scene._element.removeChild(d._element)}else{if(d.childNodes){b.apply(a,d.childNodes)}}}}}}},firstChild:{get:function(){return this.childNodes[0]}},lastChild:{get:function(){return this.childNodes[this.childNodes.length-1]}},_updateCoordinate:function(){if(this.parentNode){this._offsetX=this.parentNode._offsetX+this._x;this._offsetY=this.parentNode._offsetY+this._y}else{this._offsetX=this._x;this._offsetY=this._y}for(var b=0,a=this.childNodes.length;b<a;b++){this.childNodes[b]._updateCoordinate()}}});enchant.RGroup=enchant.Class.create(enchant.Group,{initialize:function(b,a){enchant.Group.call(this);if(arguments.length<2){throw ("Width and height of RGroup must be specified")}this.width=b;this.height=a;this.rotationOrigin={x:b/2,y:a/2};this._rotation=0},addChild:function(a){enchant.Group.prototype.addChild.apply(this,arguments);a.transformOrigin="0 0"},rotation:{get:function(){return this._rotation},set:function(l){var e=(l-this._rotation);if(e===0){return}var h=e/180*Math.PI;var g=Math.sin(h);var k=Math.cos(h);var j={x:this.width/2,y:this.height/2};for(var d=0,f=this.childNodes.length;d<f;d++){var c=this.childNodes[d];c.rotation-=e;var b=(c.x-j.x);var a=(c.y-j.y);c.x=+k*b+g*a+j.x;c.y=-g*b+k*a+j.y}this._rotation=l}}});enchant.Scene=enchant.Class.create(enchant.Group,{initialize:function(){var a=enchant.Game.instance;enchant.Group.call(this);this._element=document.createElement("div");this._element.style.position="absolute";this._element.style.overflow="hidden";this._element.style.width=(this.width=a.width)+"px";this._element.style.height=(this.height=a.height)+"px";this._element.style[enchant.ENV.VENDOR_PREFIX+"TransformOrigin"]="0 0";this._element.style[enchant.ENV.VENDOR_PREFIX+"Transform"]="scale("+a.scale+")";this.scene=this;var b=this;if(enchant.ENV.TOUCH_ENABLED){this._element.addEventListener("touchstart",function(g){var f=g.touches;for(var d=0,c=f.length;d<c;d++){g=new enchant.Event("touchstart");g.identifier=f[d].identifier;g._initPosition(f[d].pageX,f[d].pageY);b.dispatchEvent(g)}},false);this._element.addEventListener("touchmove",function(g){var f=g.touches;for(var d=0,c=f.length;d<c;d++){g=new enchant.Event("touchmove");g.identifier=f[d].identifier;g._initPosition(f[d].pageX,f[d].pageY);b.dispatchEvent(g)}},false);this._element.addEventListener("touchend",function(g){var f=g.changedTouches;for(var d=0,c=f.length;d<c;d++){g=new enchant.Event("touchend");g.identifier=f[d].identifier;g._initPosition(f[d].pageX,f[d].pageY);b.dispatchEvent(g)}},false)}else{this._element.addEventListener("mousedown",function(d){var c=d.pageX;var f=d.pageY;d=new enchant.Event("touchstart");d.identifier=a._mousedownID;d._initPosition(c,f);b.dispatchEvent(d);b._mousedown=true},false);a._element.addEventListener("mousemove",function(d){if(!b._mousedown){return}var c=d.pageX;var f=d.pageY;d=new enchant.Event("touchmove");d.identifier=a._mousedownID;d._initPosition(c,f);b.dispatchEvent(d)},false);a._element.addEventListener("mouseup",function(d){if(!b._mousedown){return}var c=d.pageX;var f=d.pageY;d=new enchant.Event("touchend");d.identifier=a._mousedownID;d._initPosition(c,f);b.dispatchEvent(d);b._mousedown=false},false)}},backgroundColor:{get:function(){return this._backgroundColor},set:function(a){this._element.style.backgroundColor=this._backgroundColor=a}},_updateCoordinate:function(){this._offsetX=this._x;this._offsetY=this._y;for(var b=0,a=this.childNodes.length;b<a;b++){this.childNodes[b]._updateCoordinate()}}});(function(){enchant.CanvasGroup=enchant.Class.create(enchant.Group,{initialize:function(){var B=enchant.Game.instance;var C=this;enchant.Group.call(this);this._dirty=false;this._rotation=0;this._cvsCache={};this._cvsCache.matrix=[1,0,0,1,0,0];this._cvsCache.detectColor="#000000";this.width=B.width;this.height=B.height;this._element=document.createElement("canvas");this._element.width=B.width;this._element.height=B.height;this._element.style.position="absolute";this._detect=document.createElement("canvas");this._detect.width=B.width;this._detect.height=B.height;this._detect.style.position="absolute";this.context=this._element.getContext("2d");this._dctx=this._detect.getContext("2d");this._colorManager=new p(16,256);if(enchant.ENV.TOUCH_ENABLED){this._element.addEventListener("touchstart",function(H){var G=H.touches;for(var F=0,E=G.length;F<E;F++){H=new enchant.Event("touchstart");H.identifier=G[F].identifier;H._initPosition(G[F].pageX,G[F].pageY);v.call(C,H)}},false);this._element.addEventListener("touchmove",function(H){var G=H.touches;for(var F=0,E=G.length;F<E;F++){H=new enchant.Event("touchmove");H.identifier=G[F].identifier;H._initPosition(G[F].pageX,G[F].pageY);u.call(C,H)}},false);this._element.addEventListener("touchend",function(H){var G=H.changedTouches;for(var F=0,E=G.length;F<E;F++){H=new enchant.Event("touchend");H.identifier=G[F].identifier;H._initPosition(G[F].pageX,G[F].pageY);o.call(C,H)}},false)}else{this._element.addEventListener("mousedown",function(F){var E=F.pageX;var G=F.pageY;F=new enchant.Event("touchstart");F.identifier=B._mousedownID;F._initPosition(E,G);v.call(C,F);C._mousedown=true},false);B._element.addEventListener("mousemove",function(F){if(!C._mousedown){return}var E=F.pageX;var G=F.pageY;F=new enchant.Event("touchmove");F.identifier=B._mousedownID;F._initPosition(E,G);u.call(C,F)},false);B._element.addEventListener("mouseup",function(F){if(!C._mousedown){return}var E=F.pageX;var G=F.pageY;F=new enchant.Event("touchend");F.identifier=B._mousedownID;F._initPosition(E,G);o.call(C,F);C._mousedown=false},false)}var D=[enchant.Event.ENTER,enchant.Event.ADDED_TO_SCENE];var A=[enchant.Event.EXIT,enchant.Event.REMOVED_FROM_SCENE];D.forEach(function(E){this.addEventListener(E,this._startRendering);this.addEventListener(E,function(){f.push(this)})},this);A.forEach(function(E){this.addEventListener(E,this._stopRendering);this.addEventListener(E,function(){var F=f.indexOf(this);if(F!==-1){f.splice(F,1)}})},this);this._onexitframe=function(){var E=C.context;E.clearRect(0,0,B.width,B.height);y.call(C,C._colorManager);b.call(C,E)}},_startRendering:function(){var A=enchant.Game.instance;if(!A._listeners.exitframe){A._listeners.exitframe=[]}A._listeners.exitframe.push(this._onexitframe)},_stopRendering:function(){var A=enchant.Game.instance;A.removeEventListener("exitframe",this._onexitframe)},_getEntityByPosition:function(A,D){var B=this._dctx;B.clearRect(0,0,this.width,this.height);a.call(this,B);var C=B.getImageData(A,D,1,1).data;return this._colorManager.getSpriteByColor(C)},_touchstartPropagation:function(B){var A=this._getEntityByPosition(B.x,B.y);if(A){this._touching=A;q.call(this._touching,B,this.parentNode)}else{A=null}return A},_touchmovePropagation:function(A){if(this._touching!=null){q.call(this._touching,A,this.parentNode)}},_touchendPropagation:function(A){if(this._touching!=null){q.call(this._touching,A,this.parentNode);this._touching=null}},rotation:{get:function(){return this._rotation},set:function(A){this._rotation=A;this._dirty=true}},scaleX:{get:function(){return this._scaleX},set:function(A){this._scaleX=A;this._dirty=true}},scaleY:{get:function(){return this._scaleY},set:function(A){this._scaleY=A;this._dirty=true}},addChild:function(A){this.childNodes.push(A);A.parentNode=this;A.dispatchEvent(new enchant.Event("added"));if(this.scene){A.scene=this.scene;var B=new enchant.Event("addedtoscene");e.call(A,B,this._colorManager)}},insertBefore:function(C,A){var B=this.childNodes.indexOf(A);if(B!==-1){this.childNodes.splice(B,0,C);C.dispatchEvent(new enchant.Event("added"));if(this.scene){C.scene=this.scene;var D=new enchant.Event("addedtoscene");e.call(C,D,this._colorManager)}}else{this.addChild(C)}},removeChild:function(B){var A;if((A=this.childNodes.indexOf(B))!==-1){this.childNodes.splice(A,1)}B.parentNode=null;B.dispatchEvent(new enchant.Event("removed"));if(this.scene){B.scene=null;var C=new enchant.Event("removedfromscene");c.call(B,C,this._colorManager)}}});var t=0;var f=[];var r=null;var d=null;var v=function(E){var A=enchant.Game.instance;var D;for(var B=f.length-1;B>=0;B--){D=f[B];if(D.scene!==A.currentScene){continue}var C=D._touchstartPropagation(E);if(C){r=C;d=D;return}}};var u=function(A){if(d!=null){d._touchmovePropagation(A)}};var o=function(A){if(d!=null){d._touchendPropagation(A);r=null;d=null}};if(enchant.widget){enchant.widget.EntityGroup.prototype.cvsRender=function(A){if(this.background&&this.background._element.width>0&&this.background._element.height>0){A.drawImage(this.background._element,t,t,this.width+t,this.height+t)}A.beginPath();A.rect(0,0,this.width,this.height);A.clip()}}enchant.Map.prototype.cvsRender=function(A){var B=enchant.Game.instance;A.save();A.setTransform(1,0,0,1,0,0);var C=this._element.firstChild;A.drawImage(C,0,0,B.width,B.height);A.restore()};enchant.Sprite.prototype.cvsRender=function(H){var B,F,I,A;var E,D,G,C;if(this._image){A=Math.abs(this._frame)||0;B=this._image;F=B._element;I=B.width/this._width|0;E=(A%I|0)*this._width;D=(A/I|0)*this._height%B.height;D=Math.min(D,B.height-this._height);G=Math.min(B.width-E,this._width);C=Math.min(B.height-D,this._height);H.drawImage(F,E,D,G,C,t,t,this._width+t,this._height+t)}};enchant.Label.prototype.cvsRender=function(A){if(this.text){A.textBaseline="top";A.font=this.font;A.fillStyle=this.color||"#000000";A.fillText(this.text,t,t,this.width+t)}};var p=enchant.Class.create({initialize:function(B,A){this.reference=[];this.detectColorNum=0;this.colorResolution=B||16;this.max=A||1},attachDetectColor:function(A){this.detectColorNum+=1;this.reference[this.detectColorNum]=A;return this._createNewColor()},detachDetectColor:function(B){var A=this.reference.indexOf(B);if(A!==-1){this.reference[A]=null}},_createNewColor:function(){var D=this.detectColorNum;var B=this.colorResolution;var A=B/this.max;return[parseInt((D/B/B)%B,10)/A,parseInt((D/B)%B,10)/A,parseInt(D%B,10)/A,1]},_decodeDetectColor:function(A){var B=this.colorResolution;return ~~(A[0]*B*B*B/256)+~~(A[1]*B*B/256)+~~(A[2]*B/256)},getSpriteByColor:function(A){return this.reference[this._decodeDetectColor(A)]}});var h=function(B,A){B=B||function(){};A=A||function(){};var C=function(){B.apply(this,arguments);var F;if(this.childNodes){for(var E=0,D=this.childNodes.length;E<D;E++){F=this.childNodes[E];C.apply(F,arguments)}}A.apply(this,arguments)};return C};var i=function(J,E){var F=J.x;var D=J.y;var I=J.width||0;var H=J.height||0;var K=J.rotation||0;var P=(typeof J.scaleX==="number")?J.scaleX:1;var N=(typeof J.scaleY==="number")?J.scaleY:1;var C=Math.PI*K/180;var B=Math.cos(C);var A=Math.sin(C);var G=(typeof J.originX==="number")?J.originX:I/2;var L=(typeof J.originY==="number")?J.originY:H/2;var R=P*B;var Q=P*A;var O=N*A;var M=N*B;E[0]=P*B;E[1]=P*A;E[2]=-N*A;E[3]=N*B;E[4]=(-R*G+O*L+F+G);E[5]=(-Q*G-M*L+D+L)};var s=function(A){if(A.__dirty||A._cvsCache.x!==A.x||A._cvsCache.y!==A.y||A._cvsCache.width!==A.width||A._cvsCache.height!==A.height){i(A,A._cvsCache.matrix);A.__dirty=false;A._cvsCache.x=A.x;A._cvsCache.y=A.y;A._cvsCache.width=A.width;A._cvsCache.height=A.height}};var g=function(A,B){if(B.alphaBlending){A.globalCompositeOperation=B.alphaBlending}else{A.globalCompositeOperation="source-atob"}A.globalAlpha=(typeof B.opacity==="number")?B.opacity:1};var j=function(A,B){s(B);A.transform.apply(A,B._cvsCache.matrix)};var x=function(A,C){var B=enchant.Game.instance;if(typeof C.visible!=="undefined"&&!C.visible){return}if(C.backgroundColor){A.fillStyle=C.backgroundColor;A.fillRect(t,t,C.width+t,C.height+t)}if(C.cvsRender){C.cvsRender(A)}if(B._debug){if(C instanceof enchant.Label||C instanceof enchant.Sprite){A.strokeStyle="#ff0000"}else{A.strokeStyle="#0000ff"}A.strokeRect(t,t,C.width+t,C.height+t)}};var b=h(function(A){A.save();g(A,this);j(A,this);x(A,this)},function(A){A.restore()});var z=function(A){return"#"+("00"+Number(parseInt(A[0],10)).toString(16)).slice(-2)+("00"+Number(parseInt(A[1],10)).toString(16)).slice(-2)+("00"+Number(parseInt(A[2],10)).toString(16)).slice(-2)};var m=function(A,B){A.fillStyle=B._cvsCache.detectColor;A.fillRect(0,0,B.width,B.height)};var a=h(function(A){A.save();j(A,this);m(A,this)},function(A){A.restore()});var n=function(){if(this._dirty){this.__dirty=true}else{this.__dirty=false}};var l=function(A){if(this._cvsCache){return}this.addEventListener("render",n);this._cvsCache={};this._cvsCache.matrix=[];this._cvsCache.detectColor=z(A.attachDetectColor(this))};var w=function(A){if(!this._cvsCache){return}this.removeEventListener("render",n);A.detachDetectColor(this);delete this._cvsCache};var y=h(function(A){l.call(this,A)});var e=h(function(B,A){this.dispatchEvent(B);l.call(this,A)});var c=h(function(B,A){this.dispatchEvent(B);w.call(this,A)});var k=h(function(A){this.dispatchEvent(A)});var q=function(B,A){this.dispatchEvent(B);if(this.parentNode&&this.parentNode!==A){q.call(this.parentNode,B,A)}}}());enchant.Scene=enchant.Class.create(enchant.Group,{initialize:function(){enchant.Group.call(this);this._element=document.createElement("div");this._element.style.position="absolute";this._element.style.overflow="hidden";this._element.style.width=(this.width=enchant.Game.instance.width)+"px";this._element.style.height=(this.height=enchant.Game.instance.height)+"px";this._element.style[enchant.ENV.VENDOR_PREFIX+"TransformOrigin"]="0 0";this._element.style[enchant.ENV.VENDOR_PREFIX+"Transform"]="scale("+enchant.Game.instance.scale+")";this.scene=this;var a=this;if(enchant.ENV.TOUCH_ENABLED){this._element.addEventListener("touchstart",function(f){var d=f.touches;for(var c=0,b=d.length;c<b;c++){f=new enchant.Event("touchstart");f.identifier=d[c].identifier;f._initPosition(d[c].pageX,d[c].pageY);a.dispatchEvent(f)}},false);this._element.addEventListener("touchmove",function(f){var d=f.touches;for(var c=0,b=d.length;c<b;c++){f=new enchant.Event("touchmove");f.identifier=d[c].identifier;f._initPosition(d[c].pageX,d[c].pageY);a.dispatchEvent(f)}},false);this._element.addEventListener("touchend",function(f){var d=f.changedTouches;for(var c=0,b=d.length;c<b;c++){f=new enchant.Event("touchend");f.identifier=d[c].identifier;f._initPosition(d[c].pageX,d[c].pageY);a.dispatchEvent(f)}},false)}else{this._element.addEventListener("mousedown",function(c){var b=c.pageX;var d=c.pageY;c=new enchant.Event("touchstart");c.identifier=enchant.Game.instance._mousedownID;c._initPosition(b,d);a.dispatchEvent(c);a._mousedown=true},false);enchant.Game.instance._element.addEventListener("mousemove",function(c){if(!a._mousedown){return}var b=c.pageX;var d=c.pageY;c=new enchant.Event("touchmove");c.identifier=enchant.Game.instance._mousedownID;c._initPosition(b,d);a.dispatchEvent(c)},false);enchant.Game.instance._element.addEventListener("mouseup",function(c){if(!a._mousedown){return}var b=c.pageX;var d=c.pageY;c=new enchant.Event("touchend");c.identifier=enchant.Game.instance._mousedownID;c._initPosition(b,d);a.dispatchEvent(c);a._mousedown=false},false)}},backgroundColor:{get:function(){return this._backgroundColor},set:function(a){this._element.style.backgroundColor=this._backgroundColor=a}},_updateCoordinate:function(){this._offsetX=this._x;this._offsetY=this._y;for(var b=0,a=this.childNodes.length;b<a;b++){this.childNodes[b]._updateCoordinate()}}});enchant.Surface=enchant.Class.create(enchant.EventTarget,{initialize:function(d,a){enchant.EventTarget.call(this);var b=enchant.Game.instance;this.width=d;this.height=a;this.context=null;var e="enchant-surface"+b._surfaceID++;if(document.getCSSCanvasContext){this.context=document.getCSSCanvasContext("2d",e,d,a);this._element=this.context.canvas;this._css="-webkit-canvas("+e+")";var c=this.context}else{if(document.mozSetImageElement){this._element=document.createElement("canvas");this._element.width=d;this._element.height=a;this._css="-moz-element(#"+e+")";this.context=this._element.getContext("2d");document.mozSetImageElement(e,this._element)}else{this._element=document.createElement("canvas");this._element.width=d;this._element.height=a;this._element.style.position="absolute";this.context=this._element.getContext("2d");enchant.ENV.CANVAS_DRAWING_METHODS.forEach(function(f){var g=this.context[f];this.context[f]=function(){g.apply(this,arguments);this._dirty=true}},this)}}},getPixel:function(a,b){return this.context.getImageData(a,b,1,1).data},setPixel:function(d,j,i,h,c,e){var f=this.context.createImageData(1,1);f.data[0]=i;f.data[1]=h;f.data[2]=c;f.data[3]=e;this.context.putImageData(f,d,j)},clear:function(){this.context.clearRect(0,0,this.width,this.height)},draw:function(b){b=b._element;if(arguments.length===1){this.context.drawImage(b,0,0)}else{var a=arguments;a[0]=b;this.context.drawImage.apply(this.context,a)}},clone:function(){var a=new enchant.Surface(this.width,this.height);a.draw(this);return a},toDataURL:function(){var a=this._element.src;if(a){if(a.slice(0,5)==="data:"){return a}else{return this.clone().toDataURL()}}else{return this._element.toDataURL()}}});enchant.Surface.load=function(c){var b=new Image();var a=Object.create(enchant.Surface.prototype,{context:{value:null},_css:{value:"url("+c+")"},_element:{value:b}});enchant.EventTarget.call(a);b.src=c;b.onerror=function(){throw new Error("Cannot load an asset: "+b.src)};b.onload=function(){a.width=b.width;a.height=b.height;a.dispatchEvent(new enchant.Event("load"))};return a};enchant.Sound=enchant.Class.create(enchant.EventTarget,{initialize:function(){enchant.EventTarget.call(this);this.duration=0;throw new Error("Illegal Constructor")},play:function(){if(this._element){this._element.play()}},pause:function(){if(this._element){this._element.pause()}},stop:function(){this.pause();this.currentTime=0},clone:function(){var a;if(this._element instanceof Audio){a=Object.create(enchant.Sound.prototype,{_element:{value:this._element.cloneNode(false)},duration:{value:this.duration}})}else{if(enchant.ENV.USE_FLASH_SOUND){return this}else{a=Object.create(enchant.Sound.prototype)}}enchant.EventTarget.call(a);return a},currentTime:{get:function(){return this._element?this._element.currentTime:0},set:function(a){if(this._element){this._element.currentTime=a}}},volume:{get:function(){return this._element?this._element.volume:1},set:function(a){if(this._element){this._element.volume=a}}}});enchant.Sound.load=function(e,b){if(b==null){var a=enchant.Game.findExt(e);if(a){b="audio/"+a}else{b=""}}b=b.replace("mp3","mpeg").replace("m4a","mp4");var d=Object.create(enchant.Sound.prototype);enchant.EventTarget.call(d);var c=new Audio();if(!enchant.Sound.enabledInMobileSafari&&enchant.ENV.VENDOR_PREFIX==="webkit"&&enchant.ENV.TOUCH_ENABLED){window.setTimeout(function(){d.dispatchEvent(new enchant.Event("load"))},0)}else{if(!enchant.ENV.USE_FLASH_SOUND&&c.canPlayType(b)){c.src=e;c.load();c.autoplay=false;c.onerror=function(){throw new Error("Cannot load an asset: "+c.src)};c.addEventListener("canplaythrough",function(){d.duration=c.duration;d.dispatchEvent(new enchant.Event("load"))},false);d._element=c}else{if(b==="audio/mpeg"){var g=document.createElement("embed");var f="enchant-audio"+enchant.Game.instance._soundID++;g.width=g.height=1;g.name=f;g.src="sound.swf?id="+f+"&src="+e;g.allowscriptaccess="always";g.style.position="absolute";g.style.left="-1px";d.addEventListener("load",function(){Object.defineProperties(g,{currentTime:{get:function(){return g.getCurrentTime()},set:function(h){g.setCurrentTime(h)}},volume:{get:function(){return g.getVolume()},set:function(h){g.setVolume(h)}}});d._element=g;d.duration=g.getDuration()});enchant.Game.instance._element.appendChild(g);enchant.Sound[f]=d}else{window.setTimeout(function(){d.dispatchEvent(new enchant.Event("load"))},0)}}}return d};enchant.Sound.enabledInMobileSafari=false;
"@file enchant_patch.js";(function(){enchant.Game.prototype.load=function(h,i){if(i==null){i=function(){}}var c=enchant.Game.instance;var e=h;var g=e.indexOf("?");if(0<=g){e=e.substring(0,g)}var d=e.match(/\.(\w)+$/);e=d[0];if(e){e=e.slice(1).toLowerCase()}switch(e){case"jpg":case"gif":case"png":c.assets[h]=enchant.Surface.load(h);c.assets[h].addEventListener("load",i);break;case"mp3":case"aac":case"m4a":case"wav":case"ogg":c.assets[h]=enchant.Sound.load(h,"audio/"+e);c.assets[h].addEventListener("load",i);break;default:var f=new XMLHttpRequest();f.open("GET",h,true);f.onreadystatechange=function(k){if(f.readyState==4){if(f.status!=200){throw new Error("Cannot load an asset: "+h)}var j=f.getResponseHeader("Content-Type")||"";if(j.match(/^image/)){c.assets[h]=enchant.Surface.load(h);c.assets[h].addEventListener("load",i)}else{if(j.match(/^audio/)){c.assets[h]=enchant.Sound.load(h,j);c.assets[h].addEventListener("load",i)}else{c.assets[asset]=f.responseText;i()}}}};f.send(null)}};var b=(function(){var c=navigator.userAgent;if(c.indexOf("Opera")!=-1){return"O"}else{if(c.indexOf("MSIE")!=-1){return"ms"}else{if(c.indexOf("WebKit")!=-1){return"webkit"}else{if(navigator.product=="Gecko"){return"Moz"}else{return""}}}}})();var a=(function(){var c=document.createElement("div");c.setAttribute("ontouchstart","return");return typeof c.ontouchstart=="function"})();enchant.Sound.load=function(h,e){var c=enchant.Game.instance;if(e==null){var d=h.match(/\.\w+$/)[0];if(d){e="audio/"+d.slice(1).toLowerCase()}else{e=""}}e=e.replace("mp3","mpeg");var g=Object.create(enchant.Sound.prototype);enchant.EventTarget.call(g);var f=new Audio();if(!enchant.Sound.enabledInMobileSafari&&b=="webkit"&&a){window.setTimeout(function(){g.dispatchEvent(new enchant.Event("load"))},0)}else{if(f.canPlayType(e)){f.src=h;f.load();f.autoplay=false;f.onerror=function(){throw new Error("Cannot load an asset: "+f.src)};f.addEventListener("canplaythrough",function(){g.duration=f.duration;g.dispatchEvent(new enchant.Event("load"))},false);g._element=f}else{if(e=="audio/mpeg"){var j=document.createElement("embed");var i="enchant-audio"+c._soundID++;j.width=j.height=1;j.name=i;j.src="game/sound.swf?id="+i+"&src="+h;j.allowscriptaccess="always";j.style.position="absolute";j.style.left="-1px";g.addEventListener("load",function(){Object.defineProperties(j,{currentTime:{get:function(){return j.getCurrentTime()},set:function(k){j.setCurrentTime(k)}},volume:{get:function(){return j.getVolume()},set:function(k){j.setVolume(k)}}});g._element=j;g.duration=j.getDuration()});c._element.appendChild(j);enchant.Sound[i]=g}else{window.setTimeout(function(){g.dispatchEvent(new enchant.Event("load"))},0)}}}return g}}());
"@file osakana4242.js";var osakana4242=osakana4242||{};(function(){var b={log:function(){}};var k=k||b;osakana4242.namespace=function(v){var u=v.split("."),t=osakana4242;if(u[0]==="osakana4242"){u=u.slice(1)}for(var s=0;s<u.length;s+=1){if(typeof t[u[s]]==="undefined"){t[u[s]]={}}t=t[u[s]]}return t};osakana4242.namespace("core");var o=enchant.Class;var l=o.create(o,{initialize:function(s,t){this.x=s||0;this.y=t||0},});osakana4242.Vector2D=l;osakana4242.TimeLeap=o.create({initialize:function(){this.cnt=0;this.cntMax=0;this.resetCnt(0)},resetCnt:function(t){var s=Game.instance;this.cnt=0;this.cntMax=Math.floor(s.fps*t)},isEnd:function(){return this.cntMax<=this.cnt},getRate:function(){return this.cnt/this.cntMax},getLerp:function(w,s,v){var t;var u=this.getRate();if(0<v){u=Math.sin((Math.PI/2)*u)}t=w+(s-w)*u;return t},getLerpForList:function(u,C){var y;var x=this.getRate();if(0<C){x=Math.sin((Math.PI/2)*x)}var v=u.length;if(v<2){error("iilegal args");return 0}if(x<1){var s=Math.floor(x*(v-1));var w=s+1;var t=u[s];var z=u[w];var A=1/(v-1);var B=(x-s*A)/A;y=t+(z-t)*B}else{y=u[v-1]}return y},exec:function(){this.cnt+=1;if(this.cntMax<this.cnt){this.cnt=this.cntMax}},});var g=osakana4242.TimeLeap;var f={sign:function(s){if(0<s){return 1}else{if(s<0){return -1}else{return 0}}},trim:function(s,u,t){if(s<u){return u}if(t<s){return t}return s}};osakana4242.NUtil=f;var d={secToFrame:function(t){var s=Game.instance;return Math.floor(t*s.fps)},frameToSec:function(t){var s=Game.instance;return t/s.fps},secDotToFrameDot:function(t){var s=Game.instance;return t/s.fps},csv:function(){var u="";for(var t=0,s=arguments.length;t<s;++t){u+=arguments[t]+","}return u},randomIntMinMax:function(v,u){var s=u-v;var t=v+Math.floor(Math.random()*(s+1));return t},shuffleList:function(x,s,w){if(!w){w=osakana4242.Util.randomIntMinMax}for(var v=0;v<s;v+=1){var t=w(0,s-1);var u=x[v];x[v]=x[t];x[t]=u}},arrayToString:function(t,x){var x=x||"";var y="";y=x+"[\n";var s=false;for(var u=0,w=t.length;u<w;u+=1){if(0<u){y+=", ";if(s){y+="\n"}}var v=t[u];if(v instanceof Array){y+=this.arrayToString(v,x+"\t");s=true}else{if(u==0){y+=x+"\t"}y+=v;s=false}}y+="\n";y+=x+"]";return y},isInside1D:function(v,t,u,s){return(v<=u)&&(u+s<=v+t)},isInside2D:function(w,z,t,y,u,x,s,v){if(d.isInside1D(w,t,u,s)===false){return false}return d.isInside1D(z,y,x,v)},isHit1D:function(v,t,u,s){return(0<Math.min(v+t,u+s)-Math.max(v,u))},isHit2D:function(w,z,t,y,u,x,s,v){if(d.isHit1D(w,t,u,s)===false){return false}return d.isHit1D(z,y,x,v)},isHitLineAndLine:function(B,A,D,C,J,I,u,s){var H=D-B;var F=C-A;var M=-F;var L=H;var z=Math.sqrt((M*M)+(L*L));if(0<z){z=1/z}M*=z;L*=z;var w=u-J;var v=s-I;var K=-(B*M+A*L);var G=(M*w+L*v);if(G==0){return false}var E=-(M*J+L*I+K)/G;if(E<=0||1<E){return false}var y=J+w*E;var x=I+v*E;var N=((B-y)*(D-y))+((A-x)*(C-x));if(N<0){return true}else{return false}},isHitLineAndRect:function(y,x,v,t,u,s,w,F){var D=Math.min(y,v);var C=Math.min(x,t);var E=Math.abs(v-y)+1;var z=Math.abs(t-x)+1;if(!d.isHit2D(D,C,E,z,u,s,w,F)){return false}if(d.isInside2D(u,s,w,F,D,C,E,z)){return true}var H=u;var B=s;var G=u+w;var A=s+F;if(d.isHitLineAndLine(y,x,v,t,H,B,G,B)||d.isHitLineAndLine(y,x,v,t,H,A,G,A)||d.isHitLineAndLine(y,x,v,t,H,B,H,A)||d.isHitLineAndLine(y,x,v,t,G,B,G,A)){return true}return false},getLineToPointDistance:function(y,x,E,C,D,B){var I=E-y;var H=C-x;var L=-H;var K=I;var v=Math.sqrt((L*L)+(K*K));if(0<v){v=1/v}L*=v;K*=v;var J=-(y*L+x*K);var A=-(L*D+K*B+J);var u=D+L*A;var s=B+K*A;var M=((y-u)*(E-u))+((x-s)*(C-s));var w=osakana4242.Util;var F=0;if(M<0){F=w.getPToPDistance(D,B,u,s)}else{var z=w.getPToPDistance2(D,B,u,s);var G=w.getPToPDistance2(D,B,u,s);F=Math.min(z,G);F=Math.sqrt(F)}return F},getPToPDistance2:function(v,u,x,w){var t=x-v;var s=w-u;return t*t+s*s},getPToPDistance:function(t,s,w,u){var v=osakana4242.Util;return Math.sqrt(v.getPToPDistance2(t,s,w,u))},scalar2D:function(s,u){var t=Math.sqrt(s*s+u*u);return t},inner2D:function(u,w,t,v){var s=(u*t)+(w*v);return s}};osakana4242.Util=d;osakana4242.FpsCtrl=o.create(o,{initialize:function(){this.execTimer=0;this.frameCnt=0;this.elapsed=0;this.fpsAve=0},exec:function(u,y,x){var v=Game.instance;var t=1000/v.fps;this.execTimer+=u;var w=0;while(t<=this.execTimer){x.call(y);this.execTimer-=t;w+=1}this.frameCnt+=1;this.elapsed+=u;if(30<=this.frameCnt){this.fpsAve=Math.round(1000*this.frameCnt/this.elapsed);this.frameCnt=0;this.elapsed=0}var s=8;if(s<w){w=s}return w}});osakana4242.Sound=o.create(o,{initialize:function(u,v,t){var s=a.instance;var w=s.assets(u);this.sounds=[w];this.idx=0;this.num=1;this.playTime=v;this.isLoop=t;this.isPlaying=false;this.timeoutId=null},play:function(){this.isPlaying=true;this._play()},clearTimeout:function(){if(this.timeoutId!=null){window.clearTimeout(this.timeoutId);this.timeoutId=null}},_play:function(){this.timeoutId=null;this.clearTimeout();this._stop();if(this.isPlaying){this.sounds[this.idx].play();var t=this;if(this.isLoop){var s=Math.floor(this.playTime*1000);this.timeoutId=window.setTimeout(function(){t._play.call(t)},s)}}this.idx+=1;if(this.num<=this.idx){this.idx=0}},_stop:function(){for(var s=0;s<this.sounds.length;s+=1){try{this.sounds[s].stop()}catch(t){q.debug.log(d.csv("sound",s,"stop",t));if(t.message=="DOM Exception: INVALID_STATE_ERR (11)"){}else{throw t}}}},stop:function(){this.isPlaying=false;this.clearTimeout();this._stop()}});var m=osakana4242.Sound;osakana4242.SoundMgr=o.create(o,{initialize:function(){this.channels={bgm:{name:""},se:{name:""}};this.soundList={}},play:function(s,t){if(!a.instance.appConfig.isSoundLoad){return}this.stop(s);var u=this.channels[s];u.name=t;this.soundList[u.name].play()},stop:function(s){if(!a.instance.appConfig.isSoundLoad){return}var t=this.channels[s];if(t.name!=""){this.soundList[t.name].stop();t.name=""}},add:function(t,u,s){if(!a.instance.appConfig.isSoundLoad){return}this.soundList[t]=new m(t,u,s)},exec:function(){}});var h=osakana4242.SoundMgr;osakana4242.core.FastRandom=o.create(o,{initialize:function(){this._seed=0;this._mulValue=69069;this._addValue=1},seed:{get:function(){return this._seed},set:function(s){this._seed=Math.floor(s);q.debug.log(d.csv("setSeed seed",this._seed))}},getInt:function(){this._seed=(this._seed*this._mulValue+this._addValue)&2147483647;return this._seed>>16},getIntN:function(t){var s=this.getInt()%t;return s},getIntMinMax:function(u,s){var t=s-u+1;return u+this.getIntN(t)}});var i=osakana4242.core.FastRandom;var c=o.create(o,{initialize:function(t,s){this.frameTime=t;this.frameNum=s.length;this.frameList=s}});osakana4242.AnimData=c;var r=o.create(o,{initialize:function(){this.waitCnt=0;this.speed=1;this.frameIdx=0;this.animData=null;this._animId=""},setAnimId:function(s){this.animId=s},getAnimId:function(){return this.animId},animId:{get:function(){return this._animId},set:function(s){this._animId=s;this.animData=r.DATA_LIST[this._animId];this.waitCnt=0;this.frameIdx=0;this.speed=1},},curFrame:{get:function(){if(this.animData!=null){return this.animData.frameList[this.frameIdx]}else{return 0}},},getCurFrame:function(){return this.curFrame},exec:function(){if(this.animData==null){return}this.waitCnt+=1;if(d.secToFrame(this.animData.frameTime)/this.speed<=this.waitCnt){this.frameIdx+=1;if(this.animData.frameNum<=this.frameIdx){this.frameIdx=0}this.waitCnt=0}}});r.DATA_LIST={};osakana4242.Anim=r;osakana4242.NineleapUtil={sendScore:function(t,s){if(location.hostname=="r.jsgames.jp"){var u=location.pathname.match(/^\/games\/(\d+)/)[1];location.replace(["http://9leap.net/games/",u,"/result","?score=",encodeURIComponent(t),"&result=",encodeURIComponent(s)].join(""))}}};var j=o.create(o,{initialize:function(){this.pos=new l();this.isMove=false;this.isStart=false;this.isEnd=false}});osakana4242.Input=j;var n=o.create(o,{initialize:function(){this.inputW=new j();this.inputR=new j()},setScene:function(u){var s=osakana4242.Core.instance;var t=this;u.addEventListener(enchant.Event.TOUCH_START,function(v){s.input.onTouchStart.call(t,v)});u.addEventListener(enchant.Event.TOUCH_MOVE,function(v){s.input.onTouchMove.call(t,v)});u.addEventListener(enchant.Event.TOUCH_END,function(v){s.input.onTouchEnd.call(t,v)})},onTouchStart:function(s){this.inputW.isStart=true;this.inputW.pos.x=s.x;this.inputW.pos.y=s.y},onTouchMove:function(s){this.inputW.isMove=true;this.inputW.pos.x=s.x;this.inputW.pos.y=s.y},onTouchEnd:function(s){this.inputW.isEnd=true;this.inputW.pos.x=s.x;this.inputW.pos.y=s.y},exec:function(){var s=this.inputR;s.pos.x=this.inputW.pos.x;s.pos.y=this.inputW.pos.y;s.isStart=this.inputW.isStart;this.inputW.isStart=false;s.isMove=this.inputW.isMove;this.inputW.isMove=false;s.isEnd=this.inputW.isEnd;this.inputW.isEnd=false},getInput:function(){return this.inputR}});osakana4242.InputMgr=n;var e=o.create(o,{initialize:function(){this.resPath=html.resPath||"";this.cacheStr="?v=hoge"}});var q={debug:k,};osakana4242.Logger=q;q.debug=b;var a=o.create(o,{initialize:function(s,t){if(a.instance!=null){return}this.appConfig=s;this.sound=new h();this.input=new n();this.fade=new p();this.randomMap={};this.randomMap.core_default=new i();this.debug={error:function(v){var u=Game.instance;window.alert(v);u.stop()},};a.instance=this},exec:function(){this.input.exec();this.sound.exec();this.fade.exec()},assets:function(t){var s=Game.instance;return s.assets[this.getResUrl(t)]},getResUrl:function(s){return this.appConfig.resPath+s+this.appConfig.cacheStr},preload:function(s){var t=Game.instance;for(var w=0,v=s.length;w<v;++w){var u=this.getResUrl(s[w]);t.preload(u)}}});var p=o.create(o,{initialize:function(){var s=a.instance;this.curValue=1;this.startValue=0;this.endValue=0;this.tl=new g()},attachLayer:function(t){var s=new Sprite();t.addChild(s);s.x=0;s.y=0;s.width=320;s.height=320;s.backgroundColor="rgb(0,0,0)";s.opacity=this.curValue;s.touchEnabled=false;this.sprite=s},updateSprite:function(s){s.opacity=this.curValue},exec:function(s){if(this.tl.isEnd()){return}this.tl.exec();this.curValue=this.tl.getLerp(this.startValue,this.endValue,0);this.updateSprite(this.sprite)},fadeIn:function(s){this.endValue=0;if(s==0){this.curValue=this.endValue}this.tl.resetCnt(s);this.startValue=this.curValue},fadeOut:function(s){this.endValue=1;if(s==0){this.curValue=this.endValue}this.tl.resetCnt(s);this.startValue=this.curValue},isEnd:function(){return this.tl.isEnd()}});osakana4242.core.Fader=p;osakana4242.Core=a}());
"@file df.js";(function(){var e=osakana4242.namespace("jump_hell");var d=osakana4242.namespace("jump_hell.DF");d.VERSION="1.0.1";d.FLG_FPS=false;d.SC_W=320;d.SC_H=320;d.SC_CX=d.SC_W/2;d.SC_CY=d.SC_H/2;d.BASE_FPS=20;d.PANEL_SIZE=48;d.SCORE_MAX=99999999;d.PANEL_TIME=3;d.CHAIN_TIME=1;d.JUMP_TIME=0.5;d.JUMP_TIME_SLOW=1;d.JUMP_TIME_FAST=0.5;d.PANEL_GROUP_W=320;d.PANEL_GROUP_H=240;d.LEVEL_PANEL_GROUP_NUM=16;d.LEVEL_MAX=4;d.FONT_SIZE=16;d.PANEL_SLIDE_TIME=0.5;d.BUTTON_FRAME_PAUSE=10;d.BUTTON_FRAME_PLAY=11;function b(n,h){var f={};for(var l=0,k=h.length;l<k;++l){var o=h[l];var i={};for(var g=0,m=n.length;g<m;++g){var j=n[g];i[j]=o[g]}f[i.id]=i}return f}d.PANEL_TAP_RANK_MAP=b(["id","score","name","judge_distance","trim_distance","flg_chain"],[[1,2000,"A",16,0,1],[2,1000,"B",20,4,1],[3,800,"C",24,8,1],[4,600,"D",28,12,0],[5,400,"E",32,16,0],[6,300,"F",36,16,0],[7,200,"G",40,16,0],[8,100,"H",48,16,0],[9,50,"I",64,16,0],[10,20,"J",99,16,0],]);d.PANEL_JUMP_TIME_MAP=b(["id","score","name","time","flg_chain"],[[1,2000,"A",0.2,1],[2,1000,"B",0.3,1],[3,800,"C",0.4,1],[4,600,"D",0.5,1],[5,400,"E",0.6,1],[6,300,"F",0.8,1],[7,200,"G",1,0],[8,100,"H",1.5,0],[9,50,"I",2,0],[10,30,"J",3,0],]);d.PANEL_TAP_RANK_A=1;d.PANEL_TAP_RANK_B=2;d.PANEL_TAP_RANK_C=3;d.PANEL_TAP_RANK_D=4;d.PANEL_TAP_RANK_E=5;d.PANEL_TAP_RANK_F=6;d.PANEL_TAP_RANK_G=7;d.PANEL_TAP_RANK_H=8;d.PANEL_TAP_RANK_I=9;d.PANEL_TAP_RANK_J=10;d.PANEL_TAP_RANK_NUM=10;d.PANEL_JUMP_TIME_RANK_A=1;d.PANEL_JUMP_TIME_RANK_B=2;d.PANEL_JUMP_TIME_RANK_C=3;d.PANEL_JUMP_TIME_RANK_D=4;d.PANEL_JUMP_TIME_RANK_E=5;d.PANEL_JUMP_TIME_RANK_F=6;d.PANEL_JUMP_TIME_RANK_G=7;d.PANEL_JUMP_TIME_RANK_H=8;d.PANEL_JUMP_TIME_RANK_I=9;d.PANEL_JUMP_TIME_RANK_J=10;d.PANEL_JUMP_TIME_RANK_NUM=10;d.CHAIN_CNT_MAX=16;d.CHAIN_ANIM_LIST=[["star_1"],["star_1",'star_2"'],["star_2"],["star_2","star_3"],["star_3"],["star_3","star_4"],["star_4"]];d.PLAY_TYPE_STAGE_SELECT=1;d.PLAY_TYPE_ALL_STAGE=2;var a=enchant.Class.create(enchant.Class,{initialize:function(i,h,f){this.r=i;this.g=h;this.b=f},makeStr:function(){return"rgb("+this.r+","+this.g+","+this.b+")"}});e.ColorRGB=a;var c=enchant.Class.create(enchant.Class,{initialize:function(f){this.color=f}});c.DEFAULT=new c(new a(255,255,255));e.PanelAttr=c}());
"@file sprite.js";(function(){var b=osakana4242.namespace("Core");var a=enchant.Class;osakana4242.Sprite=a.create(enchant.Sprite,{initialize:function(d,c){enchant.Sprite.call(this,d,c)},cx:{get:function(){return this.x+this.width/2},set:function(c){this.x=c-this.width/2}},cy:{get:function(){return this.y+this.height/2},set:function(c){this.y=c-this.height/2}},getCx:function(){return this.cx},getCy:function(){return this.cy},setCx:function(c){this.cx=c},setCy:function(c){this.cy=c},setText:function(c){var e=16;var d=16;this.width=c.length*e;this.height=e;if(this.image===null||this.image.width!=this.width||this.image.height!=this.height){this.image=new Surface(e*c.length,e)}this.drawText(c,e,d,this.image)},drawText:function(g,o,m,c){var k,j,h,n,e;var d=b.instance;c.clear();for(var f=0,l=g.length;f<l;f++){n=g.charCodeAt(f);if(n>=32&&n<=127){e=n-32}else{e=0}k=e%m;j=Math.floor(e/m);c.draw(d.assets("img/font.png"),k*o,j*o,o,o,f*o,0,o,o)}}});osakana4242.Sprite3D=a.create(osakana4242.Sprite,{initialize:function(d,c){osakana4242.Sprite.call(this,d,c);this.yy=0;this.yz=0},yy:{set:function(c){this._yy=c;this.y=this._yy+this._yz},get:function(){return this._yy}},yz:{set:function(c){this._yz=c;this.y=this._yy+this._yz},get:function(){return this._yz}},cyy:{get:function(){return this.yy+this.height/2},set:function(c){this.yy=c-this.height/2}},cyz:{get:function(){return this.yz+this.height/2},set:function(c){this.yz=c-this.height/2}}})}());
"@file sprite_camera.js";(function(){var b=enchant.Class;var d=osakana4242.namespace("TimeLeap");var f=osakana4242.namespace("Util");var c=osakana4242.namespace("Sprite");var e=osakana4242.namespace("Core");var g=osakana4242.namespace("jump_hell");var a=b.create(c,{initialize:function(i,j){c.call(this);this.x=0;this.y=0;this.tx=0;this.ty=0;this.vw=i;this.vh=j;this.visible=false;this.speedMax=f.secDotToFrameDot(1000);this.speedMin=f.secDotToFrameDot(10);var h=new c();h.width=this.vw-2;h.height=this.vh-2;h.backgroundColor="rgb(255, 255, 255)";h.opacity=0.1;h.visible=false;this.cameraSprite=h;h=new c();h.width=16;h.height=16;h.backgroundColor="rgb(255, 255, 255)";h.visible=false;this.cameraTargetSprite=h;this.curTargetDistance=0},exec:function(){var k=this.vw/2-16;var i=this.vw/2+16;var m=this.tx;var l=this.ty;if(m<k){}else{if(i<m){}}var t=m-this.x;var s=l-this.y;var p=Math.sqrt(t*t+s*s);this.curTargetDistance=p;var o=0<p?t/p:0;var n=0<p?s/p:0;var h=300;var j=this.speedMin+(Math.min(h,p)/h)*(this.speedMax-this.speedMin);var r=o*j;var q=n*j;if(t*t<r*r){r=t}if(s*s<q*q){q=s}this.x+=r;this.y+=q;this.cameraSprite.setCx(this.x);this.cameraSprite.setCy(this.y);this.cameraTargetSprite.setCx(this.tx);this.cameraTargetSprite.setCy(this.ty)},updateLayer:function(h){h.x=this.vw/2-this.x;h.y=this.vh/2-this.y}});osakana4242.namespace("jump_hell.sprite").Camera=a}());
osakana4242.jump_hell.STAGE_DATA={stages:[{id:1,name:"STAGE 1",flg_last:0,bg:{background_color:"rgb(52, 45, 83)",effect_vx:16,effect_vy:4},colors:[{r:255,g:0,b:0},{r:50,g:50,b:255},{r:0,g:200,b:0},{r:230,g:230,b:0}],form_map:{"1_1":{colors:[0,1],panels:[{x:-40,y:-24,color_id:0}]},"2_1":{panels:[{x:-120,y:0,color_id:0},{x:120,y:0,color_id:1}]},"2_2":{panels:[{x:-88,y:-8,color_id:0},{x:88,y:8,color_id:1}]},"2_3":{panels:[{x:0,y:-40,color_id:0},{x:0,y:32,color_id:1}]},"3_1":{panels:[{x:-120,y:-40,color_id:0},{x:120,y:-40,color_id:1},{x:0,y:40,color_id:2}]},"3_2":{panels:[{x:40,y:-56,color_id:0},{x:24,y:32,color_id:1},{x:120,y:-8,color_id:2}]},"4_1":{panels:[{x:16,y:-40,color_id:0},{x:16,y:72,color_id:1},{x:-72,y:-8,color_id:2},{x:96,y:-8,color_id:3}]},"5_1":{panels:[{x:-88,y:-72,color_id:0},{x:112,y:-72,color_id:1},{x:16,y:0,color_id:2},{x:-88,y:64,color_id:3},{x:112,y:64,color_id:4}]},"6_1":{panels:[{x:-40,y:-56,color_id:0},{x:-40,y:8,color_id:0},{x:-40,y:72,color_id:0},{x:64,y:-56,color_id:1},{x:64,y:72,color_id:1},{x:64,y:8,color_id:1}]}},zone_map:{zone_1:["2_1","2_2","2_1","2_3","2_1","2_2","2_1","2_3","2_1","2_2","2_1","2_3","2_1","2_2","2_1","2_3","2_1","2_2","2_1","3_1","3_1","3_1","3_1","3_1","3_2","3_2","3_2","3_2"],zone_2:["3_1","3_1","3_1","3_1","3_1","3_2","3_2","3_2","3_2","3_2","4_1","4_1","4_1","4_1","4_1","4_1","4_1","4_1","4_1"],zone_3:["4_1","4_1","4_1","4_1","4_1","4_1","4_1","4_1","4_1","4_1","5_1","5_1","5_1","5_1","5_1","5_1","5_1"]},areas:[{colors:[0,1],zones:["zone_1"]},{colors:[0,1,2],zones:["zone_2"]},{colors:[0,1,2,3],zones:["zone_3"]}]},{id:2,name:"STAGE 2",flg_last:0,bg:{background_color:"rgb(52, 45, 83)",effect_vx:128,effect_vy:32},colors:[{r:240,g:240,b:150},{r:240,g:120,b:240},{r:100,g:255,b:255},{r:255,g:130,b:130}],form_map:{"1_1":{panels:[{x:-64,y:-40,color_id:0}]},"2_1":{panels:[{x:48,y:-48,color_id:0},{x:120,y:0,color_id:1}]},"2_2":{panels:[{x:-112,y:-56,color_id:0},{x:112,y:24,color_id:1}]},"3_1":{panels:[{x:-56,y:48,color_id:0},{x:48,y:-56,color_id:0},{x:-8,y:-8,color_id:1}]},"3_2":{panels:[{x:-72,y:56,color_id:0},{x:104,y:16,color_id:1},{x:-8,y:-64,color_id:2}]},"4_1":{panels:[{x:-80,y:-40,color_id:0},{x:80,y:-40,color_id:1},{x:-72,y:48,color_id:2},{x:72,y:48,color_id:3}]},"4_2":{panels:[{x:-96,y:-40,color_id:0},{x:40,y:-72,color_id:1},{x:-24,y:32,color_id:2},{x:96,y:48,color_id:3}]},"5_1":{panels:[{x:-88,y:-40,color_id:0},{x:88,y:-40,color_id:1},{x:0,y:0,color_id:2},{x:-88,y:40,color_id:3},{x:88,y:40,color_id:4}]}},zone_map:{zone_1:["1_1","2_1","3_1","4_1"],zone_2:["2_1","4_2","2_2","5_1"],zone_speed:["1_1","2_1","3_1","4_1","1_1","1_1","1_1","1_1","1_1","1_1","1_1","1_1"],zone_3:["3_1","2_1","3_2","2_1"]},areas:[{colors:[0,1],zones:["zone_1","zone_1","zone_2","zone_2"]},{colors:[0,1],zones:["zone_speed"]},{colors:[0,1,2],zones:["zone_2","zone_2","zone_3","zone_speed"]},{colors:[0,1,2,3],zones:["zone_2","zone_2","zone_3","zone_3"]},{colors:[0,1,2,3],zones:["zone_speed"]}]},{id:3,name:"STAGE 3",flg_last:1,bg:{background_color:"rgb(83, 45, 52)",effect_vx:16,effect_vy:4},colors:[{r:255,g:10,b:10},{r:0,g:200,b:0},{r:128,g:96,b:255},{r:224,g:0,b:224},{r:0,g:224,b:224},{r:224,g:224,b:0}],form_map:{"1_1":{panels:[{x:-64,y:-40,color_id:0}]},"2_1":{panels:[{x:48,y:-48,color_id:0},{x:120,y:48,color_id:1}]},"3_1":{panels:[{x:-72,y:40,color_id:0},{x:56,y:-56,color_id:1},{x:-8,y:-8,color_id:2}]},"4_1":{panels:[{x:-80,y:-32,color_id:0},{x:104,y:-72,color_id:1},{x:-112,y:64,color_id:2},{x:8,y:56,color_id:3}]},"4_2":{panels:[{x:0,y:-80,color_id:0},{x:56,y:-64,color_id:1},{x:-88,y:32,color_id:2},{x:64,y:72,color_id:3}]},"5_1":{panels:[{x:-88,y:-40,color_id:0},{x:24,y:-56,color_id:1},{x:-32,y:-72,color_id:2},{x:-104,y:16,color_id:3},{x:80,y:-16,color_id:4}]},"5_2":{panels:[{x:-72,y:-96,color_id:0},{x:56,y:-48,color_id:1},{x:-16,y:-24,color_id:2},{x:-104,y:0,color_id:3},{x:8,y:64,color_id:4}]},"6_1":{panels:[{x:-112,y:-88,color_id:0},{x:-112,y:8,color_id:1},{x:-64,y:56,color_id:2},{x:-16,y:8,color_id:3},{x:32,y:-40,color_id:4},{x:80,y:8,color_id:5}]},"6_2":{panels:[{x:-32,y:-88,color_id:0},{x:48,y:-72,color_id:1},{x:-96,y:-32,color_id:2},{x:96,y:0,color_id:3},{x:-80,y:40,color_id:4},{x:24,y:80,color_id:5}]},"7_1":{panels:[{x:-88,y:-40,color_id:0},{x:88,y:-40,color_id:1},{x:0,y:0,color_id:2},{x:-88,y:40,color_id:3},{x:88,y:40,color_id:4},{x:0,y:-80,color_id:5},{x:0,y:80,color_id:6}]},"7_2":{panels:[{x:-96,y:-72,color_id:0},{x:-40,y:-56,color_id:1},{x:16,y:-32,color_id:2},{x:-112,y:-8,color_id:3},{x:-48,y:8,color_id:4},{x:16,y:32,color_id:5},{x:80,y:48,color_id:6}]},"8_1":{panels:[{x:-88,y:-88,color_id:0},{x:-32,y:-80,color_id:1},{x:24,y:-72,color_id:2},{x:80,y:-64,color_id:3},{x:72,y:-8,color_id:4},{x:16,y:0,color_id:5},{x:-40,y:8,color_id:6},{x:-96,y:16,color_id:7}]},"8_2":{panels:[{x:-56,y:-88,color_id:0},{x:-24,y:-32,color_id:1},{x:16,y:24,color_id:2},{x:128,y:-40,color_id:3},{x:48,y:88,color_id:4},{x:72,y:0,color_id:5},{x:-32,y:72,color_id:6},{x:-88,y:88,color_id:7}]}},zone_map:{zone_10:["8_1","2_1","2_1","2_1","3_1","3_1","3_1","3_1","3_1","3_1"],zone_20:["4_1","4_1","4_1","5_1","5_1","5_1","5_1","5_1","5_1","5_1","5_1","5_1"],zone_30:["3_1","3_1","3_1","5_1","5_1","5_1","5_1","5_2","5_2","5_2","5_2","5_2","6_1","6_1","6_1","6_1","6_1","6_1","6_1","6_1","6_1","6_1","6_1","6_1","7_1","7_1"],zone_31:["3_1","3_1","7_1","3_1","7_2","7_2"],zone_40:["7_2","7_1","7_1","8_1","8_2"],zone_41:["7_1","7_2","8_1","8_2","8_1"]},areas:[{colors:[0,1,2],zones:["zone_10"]},{colors:[3,4,5],zones:["zone_20"]},{colors:[1,2,3,4],zones:["zone_30","zone_31"]},{colors:[0,1,2,3,4,5],zones:["zone_40","zone_41"]}]},{id:4,name:"TEST STAGE",flg_last:1,bg:{background_color:"rgb(52, 45, 83)",effect_vx:100,effect_vy:20},colors:[{r:255,g:0,b:0},{r:50,g:50,b:255},{r:0,g:200,b:0},{r:230,g:230,b:0}],form_map:{"1_1":{colors:[0,1],panels:[{x:-40,y:-24,color_id:0}]}},zone_map:{zone_1:["1_1","1_1","1_1","1_1"]},areas:[{colors:[0,1],zones:["zone_1"]}]}]};
"@file scene_load.js";(function(){enchant();var c=osakana4242.Logger;var h=osakana4242.jump_hell;var g=osakana4242.jump_hell.DF;var f=osakana4242.Vector2D;var e=osakana4242.TimeLeap;var b=osakana4242.core;var d=osakana4242.Sprite;var a=Class.create(Scene,{initialize:function(){var i=Game.instance;Scene.call(this);this.addEventListener(Event.ENTER_FRAME,this.exec);this.state=0;this.tl=new e();this.frameCnt=0;var j;j=new d();this.spriteText=j;j.x=8;j.y=8;this.addChild(j)},exec:function(){var i=Game.instance;switch(this.state){case 0:this.state+=1;break;case 1:this.state+=1;break;case 2:if(this.tl.isEnd()){var j=new h.SceneTitle();i.replaceScene(j)}this.tl.exec();break}this.frameCnt+=1}});h.SceneLoad=a}());
"@file scene_title.js";(function(){enchant();var c=osakana4242.Logger;var f=osakana4242.namespace("jump_hell");var d=osakana4242.namespace("jump_hell.DF");var k=osakana4242.namespace("Vector2D");var g=osakana4242.namespace("NineleapUtil");var b=osakana4242.namespace("TimeLeap");var i=osakana4242.namespace("Util");var h=osakana4242.namespace("FpsCtrl");var e=osakana4242.namespace("Core");var a=osakana4242.namespace("Sprite");var j=Class.create(Scene,{initialize:function(){var l=e.instance;Scene.call(this);this.addEventListener(Event.ENTER_FRAME,this.exec);this.state=0;this.tl=new b();this.frameCnt=0;var m;m=new a();this.spriteBg=m;this.addChild(m);m.image=l.assets("img/title.png");m.width=m.image.width;m.height=m.image.height;m.setCx(d.SC_CX);m.setCy(d.SC_CY);m=new a();this.spriteText=m;this.addChild(m);m.image=l.assets("img/texts.png");m.width=320;m.height=16;m.cx=d.SC_CX;m.cy=d.SC_H-16;this.buttons=[];this.buttonPush=null;m=new a();this.buttons.push(m);m.name="RETRY";m.image=l.assets("img/buttons.png");m.width=240;m.height=48;m.setCx(d.SC_CX);m.setCy(216);m.frame=0;m.visible=false;this.addChild(m);m=new a();this.buttons.push(m);m.name="SEND_RESULT";m.image=l.assets("img/buttons.png");m.width=240;m.height=48;m.setCx(d.SC_CX);m.setCy(280);m.frame=1;m.visible=false;this.addChild(m);this.addEventListener(Event.TOUCH_END,this.onTouchEnd);this.isTouchEnd=false;this.tutorialIdx=0},onTouchEnd:function(l){this.isTouchEnd=true},exec:function(){var o;var m=Game.instance;var l=e.instance;var n=this.isTouchEnd;this.isTouchEnd=false;switch(this.state){case 0:this.state+=1;break;case 1:this.state+=1;break;case 2:o=this.spriteText;o.visible=(m.frame%i.secToFrame(1))<=i.secToFrame(0.75);if(n){l.sound.play("se","snd/se_ok.mp3");this.setBg(0);this.state+=1}this.tl.exec();break;case 3:o=this.spriteText;o.visible=(m.frame%i.secToFrame(1))<=i.secToFrame(0.75);if(n){l.sound.play("se","snd/se_ok.mp3");var p=this.tutorialIdx+1;if(p<j.TUTORIAL_LIST.length){this.setBg(p);if(p==j.TUTORIAL_LIST.length-1){}}else{this.tl.resetCnt(0.5);this.state+=1}}this.tl.exec();break;case 4:if(this.tl.isEnd()){var q=new f.SceneGame();m.replaceScene(q)}this.tl.exec();break;case 5:break}this.frameCnt+=1},setBg:function(l){var m=e.instance;this.tutorialIdx=l;this.spriteBg.image=m.assets(j.TUTORIAL_LIST[this.tutorialIdx])}});j.TUTORIAL_LIST=["img/tutorial_01.png","img/tutorial_02.png"];f.SceneTitle=j}());
"@file scene_game.js";(function(){var x=osakana4242.Logger;var d=enchant.Game;var t=enchant.Class;var s=osakana4242.Vector2D;var p=osakana4242.TimeLeap;var f=osakana4242.Util;var i=osakana4242.NUtil;var g=osakana4242.FpsCtrl;var y=osakana4242.Anim;var c=osakana4242.AnimData;var r=osakana4242.Input;var l=osakana4242.Sprite;var j=osakana4242.Sprite3D;var b=osakana4242.Core;var k=osakana4242.jump_hell;var q=osakana4242.jump_hell.PanelAttr;var n=osakana4242.jump_hell.ColorRGB;var o=osakana4242.jump_hell.DF;var e=osakana4242.jump_hell.sprite.Camera;var m={distanceToPanelTapRank:function(A){var C=o.PANEL_TAP_RANK_NUM;var B=o.PANEL_TAP_RANK_MAP;for(var D=1;D<=C;++D){var z=B[D];if(A<z.judge_distance){return z}}return B[C]},timeToJumpTimeRecord:function(D){var C=o.PANEL_JUMP_TIME_RANK_NUM;var A=o.PANEL_JUMP_TIME_MAP;for(var B=1;B<=C;++B){var z=A[B];if(D<=z.time){return z}}return A[C]},getNeetEffect:function(D,C){var A=null;C=C||0;for(var B=0,z=D.length;B<z;++B){var E=D[B];if(!E.isUse){E.priority=C;return E}if(E.priority<=C&&(A===null||A.frameCnt<E.frameCnt)){A=E}}A.priority=C;return A},};var u=t.create(Scene,{initialize:function(){var B=d.instance;var A=b.instance;this._isPause=false;var z=osakana4242.jump_hell.STAGE_DATA;var C=A.record.jump_hell.playProgress;this.stage=z.stages[C.curStageId-1];this.stageFormMap=this.stage.form_map;this.stageZoneMap=this.stage.zone_map;this.stagePanelAttrList=(function(D){var I=[];for(var G=0,F=D.length;G<F;++G){var E=D[G];var H=new q(new n(E.r,E.g,E.b));I.push(H)}return I}(this.stage.colors));(function(I){for(var J in I.stageZoneMap){var E=I.stageZoneMap[J];for(var D=0,G=E.length;D<G;++D){var H=E[D];var F=I.stageFormMap[H];x.debug.log(f.csv("zone",J,"form",H,F));if(F===undefined){throw new Error("invalid stage data!")}}}}(this));this.stageFormNum=(function(I){var H=0;for(var K=0,L=I.areas.length;K<L;++K){var G=I.areas[K];for(var E=0,J=G.zones.length;E<J;++E){var F=G.zones[E];var D=I.zone_map[F];H+=D.length}}return H}(this.stage));A.randomMap.game.seed=C.startRandomSeed;A.fade.fadeOut(0);Scene.call(this);this.initSprites();this.stageProgress={areaIdx:0,zoneIdx:0,zoneList:[],formIdx:0,playerLeftJump:0};this.tl=new p();this.chainCnt=0;this.chainCntMaxRecord=0;this.chainTimeCnt=f.secToFrame(o.CHAIN_TIME);this.panelTimeCnt=f.secToFrame(o.PANEL_TIME);this.panelAttrList=new Array(128);this.panelAttrListLen=0;this.panelAttrListIdxGet=0;this.backgroundColor=this.stage.bg["background_color"];this.formAddCnt=0;this.setScore(C.calcTotalScore());this.setChainCnt(0);this.initArea();this.addPanel(o.SC_W/2);this.player.setTargetPanel(this.panels[0]);this.stateCnt=0;this.state=u.STATE_IN_1;this.fpsCtrl=new g();this.chainTimeMax=f.secToFrame(o.CHAIN_TIME);this.panelTimeMax=f.secToFrame(o.PANEL_TIME)-this.chainTimeMax;this.addEventListener(Event.TOUCH_START,this.onTouch);this.addEventListener(Event.ENTER_FRAME,this.exec)},initSprites:function(){var B=d.instance;var A=b.instance;var D;this.layerBg=new Group();this.addChild(this.layerBg);this.layerStage=new Group();this.addChild(this.layerStage);this.layerSystem=new Group();this.addChild(this.layerSystem);A.fade.attachLayer(this);this.spriteBg=new w();this.spriteBg.effectVx=f.secDotToFrameDot(this.stage.bg["effect_vx"]);this.spriteBg.effectVy=f.secDotToFrameDot(this.stage.bg["effect_vy"]);this.layerBg.addChild(this.spriteBg);D=new j();this.spriteGround1=D;this.layerStage.addChild(D);D.width=640;D.height=320;D.cx=o.SC_W/2;D.yz=80;D.image=A.assets("img/ground_01.png");D=new j();this.spriteGround2=D;this.layerStage.addChild(D);D.width=640;D.height=320;D.cx=o.SC_W/2;D.yz=this.getPanelAddYFromGroupAddId(this.stageFormNum)-64;D.image=A.assets("img/ground_02.png");this.panels=new Array(16);for(var C=0;C<this.panels.length;C+=1){var z=new h();this.layerStage.addChild(z);this.panels[C]=z;z.visible=false}this.panelEffects=new Array(8);for(var C=0;C<this.panelEffects.length;C+=1){var E=new v();this.layerStage.addChild(E);this.panelEffects[C]=E}D=new j();this.layerStage.addChild(D);this.shadow=D;D.image=A.assets("img/chara_01.png");D.width=32;D.height=16;D.frame=127;D.visible=false;this.player=new a();this.layerStage.addChild(this.player);this.player.cx=o.SC_W/2;this.player.cyz=o.SC_H/2;this.camera=new e(o.SC_W,o.SC_H);this.camera.x=this.player.cx;this.camera.y=this.player.cy+160;this.layerStage.addChild(this.camera.cameraSprite);this.layerStage.addChild(this.camera.cameraTargetSprite);this.chainEffects=new Array(8);for(var C=0;C<this.chainEffects.length;C+=1){var E=new v();this.layerStage.addChild(E);this.chainEffects[C]=E}this.scoreEffects=new Array(8);for(var C=0;C<this.scoreEffects.length;C+=1){var E=new v();this.layerSystem.addChild(E);this.scoreEffects[C]=E}D=new l();this.chainGaugeFrame=D;this.layerSystem.addChild(D);D.image=A.assets("img/chain_gauge_frame.png");D.width=64;D.height=8;D.touchEnabled=false;D.cx=o.SC_CX;D.y=o.SC_H-12;D=new l();this.chainGauge=D;this.layerSystem.addChild(D);D.width=54;D.height=2;D.touchEnabled=false;D.backgroundColor="rgb(255, 255, 0)";D.x=this.chainGaugeFrame.x+5;D.y=this.chainGaugeFrame.y+3;D.setRate=function(F){if(1<F){F=F-1;this.backgroundColor="rgb(255, 255, 0)"}else{this.backgroundColor="rgb(255, 0, 0)"}this.width=54*F};D=new l();this.labelScore=D;this.layerSystem.addChild(D);D.setText("SCORE");D.touchEnabled=false;D.x=8;D.y=8;D=new l();this.labelScoreValue=D;this.layerSystem.addChild(D);D.setText("0       ");D.touchEnabled=false;D.x=8+o.FONT_SIZE*6;D.y=8;D=new l();this.labelChain=D;this.layerSystem.addChild(D);D.setText("CHAIN");D.touchEnabled=false;D.x=8;D.y=8+o.FONT_SIZE;D=new l();this.labelChainValue=D;this.layerSystem.addChild(D);D.setText("0  ");D.touchEnabled=false;D.x=8+16*6;D.y=8+o.FONT_SIZE;if(o.FLG_FPS){D=new l();this.labelFps=D;this.layerSystem.addChild(D);D.setText("FPS:00");D.touchEnabled=false;D.x=8;D.y=8+o.FONT_SIZE*2}D=new l();this.buttonPause=D;this.layerSystem.addChild(D);D.image=A.assets("img/buttons.png");D.width=48;D.height=48;D.frame=o.BUTTON_FRAME_PAUSE;D.x=8;D.y=o.SC_H-D.height-8;D=new l();this.labelPause=D;this.layerSystem.addChild(D);D.setText("PAUSE");D.visible=false;D.cx=o.SC_W/2;D.cy=o.SC_H/2;this.areaChangeEffect=new v();this.layerSystem.addChild(this.areaChangeEffect);D=new l();this.spriteStart=D;this.layerSystem.addChild(D);D.image=A.assets("img/start.png");D.width=D.image.width;D.height=D.image.height;D.visible=false;D=new l();this.spriteStageName=D;this.layerSystem.addChild(D);D.setText(this.stage.name);D.visible=false},exec:function(A){var z=this.fpsCtrl.exec(A.elapsed,this,this.execSub);if(o.FLG_FPS){this.labelFps.setText("FPS:"+this.fpsCtrl.fpsAve)}},isPause:{get:function(){return this._isPause},set:function(z){b.instance.sound.play("se","snd/se_ok.mp3");this._isPause=z;this.labelPause.visible=z;if(this.isPause){this.buttonPause.frame=o.BUTTON_FRAME_PLAY;this.scene.removeChild(this.layerStage)}else{this.buttonPause.frame=o.BUTTON_FRAME_PAUSE;this.scene.insertBefore(this.layerStage,this.layerSystem)}},},onTouch:function(E){var F={_offsetX:E.x,_offsetY:E.y,x:E.x,y:E.y,width:1,height:1};if(this.buttonPause.intersect(F)){this.isPause=!this.isPause;return}var M=null;var B=0;var I={x:0,yy:0,yz:0};for(var D=0,A=this.panels.length;D<A;++D){var z=this.panels[D];if(!this.player.isSelectablePanel(z)){continue}var H=this.layerStage.x+z.cx;var G=this.layerStage.y+z.cy;var L=H-E.x;var K=G-E.y;var C=L*L+K*K;if(M==null||C<B){M=z;B=C;I.x=-L;I.yz=-K}}if(M!=null){var J=Math.sqrt(B);this.player.setTargetPanel(M,I)}},execSprites:function(B,z){for(var A=0;A<z;A+=1){B[A].exec()}},execSub:function(){var z=b.instance;var A=d.instance;var B=null;z.exec();if(this.isPause){return}this.spriteBg.exec();this.areaChangeEffect.exec();this.execSprites(this.scoreEffects,this.scoreEffects.length);this.execSprites(this.panels,this.panels.length);this.player.exec();this.execSprites(this.panelEffects,this.panelEffects.length);this.execSprites(this.chainEffects,this.chainEffects.length);switch(this.state){case u.STATE_IN_1:z.sound.play("bgm","snd/bgm_main_intro.mp3");B=this.spriteStageName;B.visible=true;B.cx=o.SC_CX;B.cy=o.SC_CY+16;B=this.spriteStart;B.visible=true;B.cx=o.SC_CX;B.cy=-140;this.tl.resetCnt(2.25);z.fade.fadeIn(0.3);this.state+=1;break;case u.STATE_IN_2:B=this.spriteStart;B.cy=this.tl.getLerp(-40,140,1);if(this.tl.isEnd()){this.tl.resetCnt(1);this.state+=1}this.tl.exec();break;case u.STATE_IN_3:B=this.spriteStart;if(this.tl.isEnd()){B.visible=false;this.tl.resetCnt(0.25);this.state+=1}this.tl.exec();break;case u.STATE_IN_4:B=this.spriteStart;B.visible=(A.frame&1)==0;this.spriteStageName.visible=B.visible;if(this.tl.isEnd()){B.visible=false;this.spriteStageName.visible=false;z.sound.play("bgm","snd/bgm_main.mp3");this.state=u.STATE_MAIN}this.tl.exec();break;case u.STATE_MAIN:if(this.player.state==a.STATE_WAIT_2){--this.chainTimeCnt;if(this.chainTimeCnt<0){this.chainTimeCnt=0;if(0<this.chainCnt){this.setChainCnt(0)}--this.panelTimeCnt;if(this.panelTimeCnt<0){this.panelTimeCnt=0;this.player.state=a.STATE_DEAD_1;this.player.isDead=true}}this.chainGauge.setRate(this.chainTimeCnt/this.chainTimeMax+this.panelTimeCnt/this.panelTimeMax)}break;case u.STATE_OUT_1:this.tl.resetCnt(2.5);this.state+=1;break;case u.STATE_OUT_2:if(this.tl.isEnd()){z.sound.stop("bgm");this.labelScore.visible=false;this.labelScoreValue.visible=false;this.labelChain.visible=false;this.labelChainValue.visible=false;var C=z.record.jump_hell.playProgress;var D=C.curStageProgress;D.isGameClear=this.stageProgress.playerLeftJump<=0;if(C.isFinalStage()||!D.isGameClear){A.pushScene(new k.SceneResult());this.state=u.STATE_RESULT_1}else{z.fade.fadeOut(0.3);this.state+=1}}this.tl.exec();break;case u.STATE_OUT_3:if(z.fade.isEnd()){var C=z.record.jump_hell.playProgress;C.incrementStage();A.replaceScene(new k.SceneGame())}break;case u.STATE_RESULT_1:break}this.camera.tx=this.player.cx;this.camera.ty=this.player.cyz-112;this.camera.exec();this.camera.updateLayer(this.layerStage);this.spriteBg.updatePos(this.layerStage.x/4,this.layerStage.y/4)},addPanel:function(G){var D=this.popForm();if(D==null){this.spriteGround2.cx=this.player.cx;return false}var C=this.stageProgress;var E=this.stage.areas[C.areaIdx];var A=D.panels;var F=A.length;var M=0;var N=null;var P=1;var I=1;switch(this.randomIntMinMax(0,3)){case 0:P=1;I=1;break;case 1:P=-1;I=1;break;case 2:P=1;I=-1;break;case 3:P=-1;I=-1;break}var H=this.getPanelAddYFromGroupAddId(this.formAddCnt);var L={};for(var J=0,B=this.panels.length;J<B&&M<F;++J){var z=this.panels[J];if(!z.visible){var O=A[M];var K=O.color_id;var N=L[K];if(N===undefined){N=this.popPanelAttr();L[K]=N}z.visible=true;z.areaIdx=C.areaIdx;z.formAddId=this.formAddCnt;z.cx=O.x*P+G;z.cyz=O.y*I+H+o.PANEL_GROUP_H/2;z.setAttr(N,false);z.targetX=o.PANEL_GROUP_W/2;z.targetYZ=H;M+=1}}this.formAddCnt+=1;return true},getPanelAddYFromGroupAddId:function(z){return -(z+1)*o.PANEL_GROUP_H},randomIntMinMax:function(A,z){return b.instance.randomMap.game.getIntMinMax(A,z)},popPanelAttr:function(){var A=this.panelAttrList[this.panelAttrListIdxGet];var z=this.stagePanelAttrList[A];++this.panelAttrListIdxGet;if(this.panelAttrListLen<=this.panelAttrListIdxGet){this.panelAttrListIdxGet=0;f.shuffleList(this.panelAttrList,this.panelAttrListLen,this.randomIntMinMax)}return z},initArea:function(){var F=this.stageProgress;var E=this.stage.areas[F.areaIdx];var D=E.colors;this.initPanelAttrList(D);var z=[];var C=E.zones;for(var B=0,A=C.length;B<A;++B){z.push(this.stageZoneMap[C[B]])}f.shuffleList(z,z.length,this.randomIntMinMax);F.zoneList=z},initPanelAttrList:function(B){this.panelAttrListLen=0;this.panelAttrListIdxGet=0;for(var A=0,z=B.length;A<z;++A){this.panelAttrList[A]=B[A];++this.panelAttrListLen}f.shuffleList(this.panelAttrList,this.panelAttrListpanelAttrListLen,this.randomIntMinMax)},getForm:function(){var A=this.stageProgress;if(this.stage.areas.length<=A.areaIdx){return null}var B=A.zoneList[A.zoneIdx][A.formIdx];var z=this.stageFormMap[B];return z},popForm:function(){var z=this.getForm();var A=this.stageProgress;++A.formIdx;var B=A.zoneList[A.zoneIdx];if(B===undefined){throw new Error("fromKeyList "+undefined)}if(B.length<=A.formIdx){A.formIdx=0;++A.zoneIdx;if(A.zoneList.length<=A.zoneIdx){A.zoneIdx=0;++A.areaIdx;if(this.stage.areas.length<=A.areaIdx){}else{this.initArea()}}}x.debug.log(f.csv("popForm",A.areaIdx,A.zoneIdx,A.formIdx,"form",z));if(z!=null){++A.playerLeftJump}else{x.debug.log(f.csv("form empty",A.areaIdx,A.zoneIdx,A.formIdx,"form",z,"formKey",B[A.zoneIdx]))}return z},checkChainCnt:function(){if(0<this.chainTimeCnt){this.setChainCnt(Math.min(this.chainCnt+1,o.CHAIN_CNT_MAX))}else{this.setChainCnt(1)}},catchPanelJumpEvent:function(C,A,L){var D=b.instance;var O=D.record.jump_hell.playProgress;D.sound.play("se","snd/se_panel.mp3");var I=0;var N=f.frameToSec((this.chainTimeMax-this.chainTimeCnt)+(this.panelTimeMax-this.panelTimeCnt));var E=m.timeToJumpTimeRecord(N);var F=o.PANEL_TAP_RANK_MAP[L];x.debug.log(f.csv("jumpTime",E.id,E.time,N,"tap",F.id,F.judge_distance));I+=E.score;I+=F.score;this.chainTimeCnt=this.chainTimeMax;this.panelTimeCnt=this.panelTimeMax;this.chainGauge.setRate(this.chainTimeCnt/this.chainTimeMax+this.panelTimeCnt/this.panelTimeMax);var M=Math.floor(I*this.chainCnt);O.addScore(M);var K=O.calcTotalScore();this.setScore(K);this.labelScoreValue.text=K;var z=this.getScoreEffect();var J=this.layerStage.x+this.player.cx;var H=this.layerStage.y+this.player.cy-16;z.startScoreUpEffect(M,J,H);if(this.player.areaIdx!==A.areaIdx&&A.areaIdx<this.stage.areas.length){this.player.areaIdx=A.areaIdx;var G=A.areaIdx+1;this.areaChangeEffect.startAreaChangeEffect(G)}var B=this.stageProgress;--B.playerLeftJump;if(B.playerLeftJump<=0){this.scene.state=u.STATE_OUT_1;return true}else{return false}},setScore:function(z){this.labelScoreValue.setText(""+z)},setChainCnt:function(z){this.chainCnt=z;this.labelChain.visible=2<=z;this.labelChainValue.visible=2<=z;this.labelChainValue.setText("x"+z);if(this.chainCntMaxRecord<z){this.chainCntMaxRecord=z}},getPanelEffect:function(){var A=null;for(var B=0,z=this.panelEffects.length;B<z;B+=1){var C=this.panelEffects[B];if(!C.isUse){return C}if(A==null||A.frameCnt<C.frameCnt){A=C}}return A},getChainEffect:function(z){return m.getNeetEffect(this.chainEffects,z)},getScoreEffect:function(){return m.getNeetEffect(this.scoreEffects,0)},canOpenFormColor:function(B){var D=this.camera.cameraSprite;var A=this.scene.panels;for(var C=0,E=A.length;C<E;++C){var z=A[C];if(B===z.formAddId){if(!f.isHit2D(D.x,D.y,D.width,D.height,z.x,z.y,z.width,z.height)){return false}}}return true}});u.STATE_IN_1=1;u.STATE_IN_2=2;u.STATE_IN_3=3;u.STATE_IN_4=4;u.STATE_MAIN=5;u.STATE_OUT_1=6;u.STATE_OUT_2=7;u.STATE_OUT_3=8;u.STATE_RESULT_1=9;k.SceneGame=u;var a=t.create(j,{initialize:function(){j.call(this,32,32);this.x=0;this.yy=0;this.yz=0;this.footX=16;this.footY=32;this.startX=0;this.startY=0;this.targetPanelRelPos={x:0,yy:0,yz:0};this.panelTapRank=o.PANEL_TAP_RANK_A;this.curPanelRelPos={x:0,yy:0,yz:0};this.targetPanel=null;this.curPanel=null;this.state=a.STATE_WAIT_2;this.pose=0;this.anim=new y(this);this.anim.setAnimId("stand_u");this.isDead=false;this.tl=new p();this.tlChainEffect=new p();this.tmpPanelAttrList=new Array(8);this.targetTapDistance=0;var z=b.instance;this.image=z.assets("img/chara_01.png");this.touchEnabled=false;this.areaIdx=-1;this.frameCnt=0},setTargetPanel:function(B,z){if(this.state===a.STATE_WAIT_2){if(this.isSelectablePanel(B)){this.targetPanel=B;if(z){var D=Math.sqrt(z.x*z.x+z.yz*z.yz);this.targetTapDistance=D;var A=m.distanceToPanelTapRank(D);this.panelTapRank=A.id;var C=A.trim_distance;this.targetPanelRelPos.x=i.trim(z.x,-C,C);this.targetPanelRelPos.yy=0;this.targetPanelRelPos.yz=i.trim(z.yz,-C,C)}}}},isSelectablePanel:function(z){if(!z.visible){return false}if(this.curPanel===null||z.formAddId<=this.curPanel.formAddId+1&&this.curPanel!==z){return true}return false},exec:function(S){var P=b.instance;this.frame=this.anim.getCurFrame();this.anim.exec();var Q=this.anim.getAnimId();switch(this.state){case a.STATE_WAIT_1:if(this.scene.state==u.STATE_MAIN){Q="stand_u"}this.execPanelFit();if(this.curPanel!==null){if(this.scene.canOpenFormColor(this.curPanel.formAddId+1)){++this.state}}else{++this.state}break;case a.STATE_WAIT_2:if(this.scene.state==u.STATE_MAIN){Q="stand_u";if(this.targetPanel!=this.curPanel){this.scene.checkChainCnt();var L=this.scene.getChainEffect(1);L.startPanelTapEffect(this.targetPanel.cx+this.targetPanelRelPos.x,this.targetPanel.cyz+this.targetPanelRelPos.yz,this.panelTapRank);this.state=a.STATE_JUMP_1}}this.execPanelFit();this.execChainEffect(0.1);break;case a.STATE_JUMP_1:this.scene.addPanel(this.targetPanel.cx);var R=this.x+this.footX;var O=this.targetPanel.cx+this.targetPanelRelPos.x;var G=this.yz+this.footY;var E=this.targetPanel.cyz+this.targetPanelRelPos.yz;var K=O-R;var T=E-G;if(Math.abs(K)<Math.abs(T)/4){Q="jump_u"}else{if(K<0){Q="jump_lu"}else{if(0<K){Q="jump_ru"}}}var N=i.trim(this.scene.chainCnt,1,o.CHAIN_CNT_MAX)-1;var C=o.CHAIN_CNT_MAX-1;var I=(C-N)/C;var H=o.JUMP_TIME_FAST+I*(o.JUMP_TIME_SLOW-o.JUMP_TIME_FAST);this.tl.resetCnt(H);this.tlChainEffect.resetCnt(0);this.startX=this.x;this.startYZ=this.yz;this.yy=0;P.sound.play("se","snd/se_jump.mp3");this.state+=1;break;case a.STATE_JUMP_2:this.x=this.tl.getLerp(this.startX,this.targetPanel.cx+this.targetPanelRelPos.x-this.footX,1);this.yz=this.tl.getLerp(this.startYZ,this.targetPanel.cyz+this.targetPanelRelPos.yz-this.footY,1);this.yy=this.tl.getLerpForList(a.JUMP_YY_LIST,0);this.execChainEffect(0.05);if(this.tl.isEnd()){if(this.curPanel==null||this.curPanel.attr==this.targetPanel.attr){var F=this.curPanel;this.curPanel=this.targetPanel;this.curPanelRelPos.x=this.targetPanelRelPos.x;this.curPanelRelPos.yz=this.targetPanelRelPos.yz;var A=this.curPanel.formAddId;for(var M=0,z=this.scene.panels.length;M<z;M+=1){var J=this.scene.panels[M];if(this.curPanel!=J&&J.formAddId<=A&&J.visible){J.visible=false;this.scene.getPanelEffect().startPanelKillEffect(J)}}this.curPanel.setAttr(this.getNextPanelAttr(),true);this.scene.getPanelEffect().startPanelChangeEffect(this.curPanel);var D=this.scene.catchPanelJumpEvent(F,this.curPanel,this.panelTapRank);if(D){this.state=a.STATE_CLEAR_1}else{this.state=a.STATE_WAIT_1}}else{this.scene.setChainCnt(0);this.isDead=true;this.curPanel=this.targetPanel;this.state=a.STATE_DEAD_1}}this.tl.exec();break;case a.STATE_MISS_1:this.tl.resetCnt(o.JUMP_TIME);this.startX=this.x;this.startY=this.y;this.state+=1;break;case a.STATE_MISS_2:this.x=this.tl.getLerp(this.startX,this.targetPanel.cx-this.footX,1);this.y=this.tl.getLerp(this.startY,this.targetPanel.cyz-this.footY,1);if(this.tl.isEnd()){this.curPanel=this.targetPanel;this.state=a.STATE_WAIT_1}this.tl.exec();break;case a.STATE_DEAD_1:P.sound.play("bgm","snd/jgl_game_over.mp3");Q="dead";this.tl.resetCnt(1);this.startX=this.x;this.startY=this.y;this.curPanel.visible=false;this.scene.getPanelEffect().startPanelKillEffect(this.curPanel);this.curPanel=null;this.targetPanel=null;this.state+=1;break;case a.STATE_DEAD_2:this.y=this.tl.getLerp(this.startY,this.startY+32,1);this.scaleX=this.tl.getLerp(1,0.7,1);this.scaleY=this.tl.getLerp(1,0.7,1);if((this.frameCnt&1)==0){this.visible=true}else{this.visible=false}if(this.tl.isEnd()){this.visible=false;this.state+=1;this.scene.state=u.STATE_OUT_1}this.tl.exec();break;case a.STATE_DEAD_3:break;case a.STATE_CLEAR_1:P.sound.play("bgm","snd/jgl_game_clear.mp3");this.execPanelFit();Q="stand_d";this.state+=1;break;case a.STATE_CLEAR_2:this.execPanelFit();break}if(Q!=this.anim.getAnimId()){this.anim.setAnimId(Q)}var B=this.scene.shadow;B.x=this.x;B.yz=this.yz+16;if(this.curPanel){B.yy=this.curPanel.yy}B.visible=this.curPanel&&this.curPanel.intersect(B)||this.targetPanel&&this.targetPanel.intersect(B);this.frameCnt+=1},execPanelFit:function(){if(this.curPanel!==null){this.x=this.curPanel.cx-this.footX+this.curPanelRelPos.x;this.yz=this.curPanel.cyz-this.footY+this.curPanelRelPos.yz;this.yy=this.curPanel.yy}},execChainEffect:function(z){if(this.scene.chainCnt<2||this.scene.chainTimeCnt<=0){return}if(this.tlChainEffect.isEnd()){var A=this.scene.getChainEffect(0);A.startChainEffect(this.cx+f.randomIntMinMax(-8,8),this.cy+f.randomIntMinMax(-16,16),this.scene.chainCnt);this.tlChainEffect.resetCnt(z)}this.tlChainEffect.exec()},getNextPanelAttr:function(){var D=0;var B=this.curPanel.formAddId+1;for(var C=0,E=this.scene.panels.length;C<E&&D<this.tmpPanelAttrList.length;++C){var A=this.scene.panels[C];if(B===A.formAddId){this.tmpPanelAttrList[D]=A.attr;++D}}if(D<=0){return q.DEFAULT}var z=this.scene.randomIntMinMax(0,D-1);return this.tmpPanelAttrList[z]},});a.STATE_WAIT_1=1;a.STATE_WAIT_2=2;a.STATE_JUMP_1=3;a.STATE_JUMP_2=4;a.STATE_MISS_1=5;a.STATE_MISS_2=6;a.STATE_DEAD_1=7;a.STATE_DEAD_2=8;a.STATE_DEAD_3=9;a.STATE_CLEAR_1=10;a.STATE_CLEAR_2=11;a.JUMP_YY_LIST=[0,-24,-32,-24,0];k.SpritePlayer=a;var h=t.create(j,{initialize:function(){var z=b.instance;j.call(this,o.PANEL_SIZE,o.PANEL_SIZE);this.x=32;this.y=32;this.startX=this.x;this.startY=this.yz;this.targetX=this.x;this.targetYZ=this.yz;this.areaIdx=0;this.formAddId=0;this.attr=q.DEFAULT;this.image=z.assets("img/panel.png");this.tl=new p();this.colorRGB=new n(0,0,0);this.anim=new y(this);this.anim.setAnimId("panel");this.touchEnabled=false;this.isOpenColor=false},exec:function(E){if(!this.visible){return}var A=this.scene.player;var D=this.scene.camera;if(this===A.curPanel&&0<=A.yy){var z=this.targetX-this.x;var C=this.targetYZ-this.yz;var B=this.tl.getLerp(this.startY,this.targetYZ,1)-this.yz;this.yz+=B;this.yy=-0.5*this.tl.getLerpForList(a.JUMP_YY_LIST,0);this.tl.exec()}this.frame=this.anim.getCurFrame();this.anim.exec();if(!this.isOpenColor){if(this.scene.canOpenFormColor(this.formAddId)){x.debug.log(f.csv("openColor",this.formAddId));this.backgroundColor=this.attr.color.makeStr();this.isOpenColor=true}}},setAttr:function(z,A){this.attr=z;if(A){this.backgroundColor=this.attr.color.makeStr()}else{this.backgroundColor="rgb(64,64,64)"}this.isOpenColor=A;this.tl.resetCnt(o.PANEL_SLIDE_TIME);this.startX=this.x;this.startY=this.yz},onTouch:function(z){}});k.SpritePanel=h;var v=t.create(j,{initialize:function(){j.call(this);this.execEffect=null;this.tl=new p();this.anim=new y(this);this.state=0;this.startX=0;this.startY=0;this.touchEnabled=false;this.isUse=false;this.reset(null);this.unUse()},reset:function(z){this.backgroundColor="transparent";this.scaleX=1;this.scaleY=1;this.startX=0;this.startY=0;this.rotation=0;this.frameCnt=0;this.state=0;this.opacity=1;this.execEffect=z;this.isUse=z!==null},unUse:function(){this.isUse=false;this.visible=false},exec:function(z){if(!this.isUse){return}if(this.execEffect!=null){this.execEffect(this)}this.frameCnt+=1},startAreaChangeEffect:function(z){this.reset(this.execAreaChangeEffect);this.setText("AREA "+z);this.cx=0;this.cy=o.SC_H-this.height;this.visible=true;this.tl.resetCnt(0.25)},execAreaChangeEffect:function(z){switch(z.state){case 0:if(!z.tl.isEnd()){z.visible=(this.frameCnt&1)===0;z.x=z.tl.getLerp(0,160,1)}else{z.tl.resetCnt(2);z.state+=1}break;case 1:if(!z.tl.isEnd()){z.x=z.tl.getLerp(160,170,1)}else{z.tl.resetCnt(0.25);z.state+=1}break;case 2:if(!z.tl.isEnd()){z.visible=(this.frameCnt&1)===0;z.x=z.tl.getLerp(170,o.SC_W+z.width,1)}else{z.unUse();z.state+=1}break;case 3:break}z.tl.exec()},startScoreUpEffect:function(B,A,z){this.reset(this.execScoreUpEffect);this.setText("+"+B);this.cx=A;this.cy=z;this.visible=true;this.tl.resetCnt(0.75);this.startX=A;this.startY=z},execScoreUpEffect:function(z){if(!z.tl.isEnd()){z.y=z.tl.getLerp(this.startY,this.startY-48,1)}else{z.unUse()}z.tl.exec()},startPanelTapRankEffect:function(B,z,C,D){this.reset(this.execPanelTapRankEffect);var A=b.instance;this.setText(C.name+" x "+D.name);this.frame=0;this.cx=B;this.cy=z;this.visible=true;this.tl.resetCnt(0.75);this.state=1;this.startX=B;this.startY=z},execPanelTapRankEffect:function(z){if(!z.tl.isEnd()){z.y=z.tl.getLerp(this.startY,this.startY-48,1)}else{z.unUse()}z.tl.exec()},startChainEffect:function(C,A,F){this.reset(this.execChainEffect);var B=b.instance;this.width=16;this.height=16;this.cx=C;this.cy=A;this.visible=true;this.tl.resetCnt(0.5);this.startX=C;this.startY=A;this.endX=C+f.randomIntMinMax(-10,10);this.endY=A+f.randomIntMinMax(5,15);this.image=B.assets("img/effect.png");this.rotation=0;var z=0;if(F<4){z=0}else{if(F<8){z=1}else{if(F<12){z=2}else{if(F<14){z=3}else{if(F<15){z=4}else{if(F<16){z=5}else{z=6}}}}}}var E=o.CHAIN_ANIM_LIST[z];var D=E[f.randomIntMinMax(0,E.length-1)];this.anim.setAnimId(D);this.frame=this.anim.getCurFrame()},execChainEffect:function(z){this.frame=this.anim.getCurFrame();this.anim.exec();if(!z.tl.isEnd()){if(false){z.rotation=z.tl.getLerp(0,360,0)}z.cx=z.tl.getLerp(z.startX,z.endX,0);z.cy=z.tl.getLerp(z.startY,z.endY,0)}else{z.unUse()}z.tl.exec()},startPanelTapEffect:function(B,z){this.reset(this.execPanelTapEffect);var A=b.instance;this.width=32;this.height=32;this.cx=B;this.cy=z-16;this.visible=true;this.tl.resetCnt(0.5);this.startX=B;this.startY=z;this.image=A.assets("img/panel_tap_effect.png");this.rotation=0;var C="panel_tap_effect";this.anim.setAnimId(C);this.frame=this.anim.getCurFrame()},execPanelTapEffect:function(z){this.frame=this.anim.getCurFrame();this.anim.exec();if(!z.tl.isEnd()){}else{z.unUse()}z.tl.exec()},startPanelKillEffect:function(z){this.reset(this.execPanelKillEffect);this.image=null;this.width=o.PANEL_SIZE*0.5;this.height=o.PANEL_SIZE*0.5;this.cx=z.cx;this.cy=z.cy;this.backgroundColor=z.attr.color.makeStr();this.visible=true;this.tl.resetCnt(0.25)},execPanelKillEffect:function(A){if(!A.tl.isEnd()){var z=A.effectCnt/A.effectCntMax;A.visible=(this.frameCnt&1)===0}else{A.unUse()}A.tl.exec()},startPanelChangeEffect:function(z){this.reset(this.execPanelChangeEffect);this.image=null;this.width=o.PANEL_SIZE*1.5;this.height=o.PANEL_SIZE*1.5;this.cx=z.cx;this.cy=z.cy;this.backgroundColor=z.attr.color.makeStr();this.opacity=1;this.visible=true;this.effectCnt=0;this.effectCntMax=12;this.rotation=0;this.tl.resetCnt(0.25)},execPanelChangeEffect:function(A){if(!A.tl.isEnd()){var z=A.effectCnt/A.effectCntMax;A.visible=(this.frameCnt&1)===0;if(false){A.rotation=A.tl.getLerp(0,360,0)}}else{A.unUse()}A.tl.exec()}});k.SpriteEffect=v;var w=t.create(Group,{initialize:function(){var z=b.instance;Group.call(this);this.sprites=[];for(var B=0;B<4;++B){var A=null;A=new l();A.width=64;A.height=64;A.image=z.assets("img/bg_02.png");A.frame=0;this.addChild(A);this.sprites[B]=A}this.bgX=0;this.bgY=0;this.effectX=0;this.effectY=0;this.effectVx=0;this.effectVy=0;this.updatePos(0,0)},updatePos:function(z,D){var A=d.instance;this.bgX=z;this.bgY=D;z+=this.effectX;D+=this.effectY;if(0<=z){z=-Math.floor(o.SC_W-z)%o.SC_W+o.SC_W}if(0<=D){D=-Math.floor(o.SC_H-D)%o.SC_H+o.SC_H}z=Math.floor(z)%o.SC_W-o.SC_W;D=Math.floor(D)%o.SC_H-o.SC_H;for(var C=0;C<this.sprites.length;C+=1){var B=this.sprites[C];B.x=z+Math.floor(C%2)*o.SC_W;B.y=D+Math.floor(C/2)*o.SC_H;this.sprites[C]=B}},exec:function(z){this.effectX+=this.effectVx;this.effectY+=this.effectVy},});k.SpriteBg=w}());
"@file scene_result.js";(function(){var d=enchant.Game;var c=osakana4242.Logger;var g=osakana4242.jump_hell;var e=osakana4242.jump_hell.DF;var l=osakana4242.Vector2D;var h=osakana4242.NineleapUtil;var b=osakana4242.TimeLeap;var k=osakana4242.Util;var i=osakana4242.FpsCtrl;var f=osakana4242.Core;var a=osakana4242.Sprite;var j=Class.create(Scene,{initialize:function(){var n=d.instance;var m=f.instance;var p=m.record.jump_hell.playProgress;Scene.call(this);this.addEventListener(Event.ENTER_FRAME,this.exec);this.state=0;this.tl=new b();this.frameCnt=0;var o;o=new a();this.spriteResult=o;this.addChild(o);if(p.curStageProgress.isGameClear){o.image=m.assets("img/clear.png")}else{o.image=m.assets("img/game_over.png")}o.width=o.image.width;o.height=o.image.height;o.setCx(e.SC_CX);o.setCy(-50);o=new a();this.spriteText=o;this.addChild(o);o.visible=false;o.setCx(e.SC_CX);o.setCy(240);o=new a();this.labelChainCntRecord=o;this.addChild(o);o=new a();this.labelResultScore=o;this.addChild(o);this.buttons=[];this.buttonPush=null;o=new a();this.buttons.push(o);o.name="RETRY";o.image=m.assets("img/buttons.png");o.width=240;o.height=48;o.setCx(e.SC_CX);o.setCy(216);o.frame=0;o.visible=false;this.addChild(o);o=new a();this.buttons.push(o);o.name="SEND_RESULT";o.image=m.assets("img/buttons.png");o.width=240;o.height=48;o.setCx(e.SC_CX);o.setCy(280);o.frame=1;o.visible=false;this.addChild(o);this.addEventListener(Event.TOUCH_END,this.onTouchEnd);m.input.setScene(this);this.isTouchEnd=false;this.tutorialIdx=0},onTouchEnd:function(m){this.isTouchEnd=true},exec:function(){var t;var u=d.instance;var n=f.instance;var w=n.record.jump_hell.playProgress;n.exec();var s=n.input.getInput();var r=this.isTouchEnd;this.isTouchEnd=false;switch(this.state){case 0:var t;t=this.labelResultScore;t.setText("SCORE "+w.calcTotalScore());t.visible=true;t.setCx(e.SC_W*1.5);t.y=140;this.tl.resetCnt(0.25);this.state+=1;break;case 1:var t;t=this.spriteResult;t.setCy(this.tl.getLerp(-50,80,1));t=this.labelResultScore;t.setCx(this.tl.getLerp(e.SC_W*1.5,e.SC_W/2,1));t=this.labelChainCntRecord;t.setCx(this.tl.getLerp(-e.SC_W*1.5,e.SC_W/2,1));t=this.spriteText;t.visible=(u.frame%k.secToFrame(1))<=k.secToFrame(0.75);if(this.tl.isEnd()){for(var o=0;o<this.buttons.length;o+=1){t=this.buttons[o];t.visible=true}this.state+=1}this.tl.exec();break;case 2:t=this.spriteText;t.visible=(u.frame%k.secToFrame(1))<k.secToFrame(0.75);if(s.isEnd){for(var o=0;o<this.buttons.length;o+=1){t=this.buttons[o];if(k.isHit2D(t.x,t.y,t.width,t.height,s.pos.x,s.pos.y,1,1)){this.buttonPush=t;break}}}if(this.buttonPush!=null){n.sound.play("se","snd/se_ok.mp3");this.tl.resetCnt(0.5);this.state+=1}break;case 3:this.buttonPush.visible=(u.frame&1)==0;if(this.tl.isEnd()){for(var o=0;o<this.buttons.length;o+=1){t=this.buttons[o];t.visible=false}this.state+=1}this.tl.exec();break;case 4:switch(this.buttonPush.name){case"RETRY":w.resetProgress();if(html.urlRetry){location.href=html.urlRetry}else{u.popScene();u.replaceScene(new g.SceneGame())}break;case"SEND_RESULT":t=this.spriteText;t.visible=true;t.setText("...");t.setCx(e.SC_CX);t.y=240;var v={replayData:{version:e.VERSION,randomSeed:w.startRandomSeed,input:[0,0,0,0,0],},};var m=JSON.stringify(v);var q=w.calcTotalScore();var p="SCORE:"+q;this.sendScore(q,p,m);this.state+=1;break}this.buttonPush=null;break;case 5:t=this.spriteText;t.visible=(u.frame%k.secToFrame(1))<k.secToFrame(0.75);break}this.frameCnt+=1},sendScore:function(n,o,m){if(html.sendScore){html.sendScore(n,o,m)}else{h.sendScore(n,o)}},});g.SceneResult=j}());
"@file game.js";(function(){var d=enchant.Game;var n=enchant.Sound;var i=osakana4242.jump_hell;var k=osakana4242.jump_hell.DF;var f=osakana4242.Util;var h=osakana4242.NUtil;var j=osakana4242.SoundList;var a=osakana4242.Core;var s=osakana4242.Anim;var c=osakana4242.AnimData;var m=osakana4242.core.Input;var l=osakana4242.core.FastRandom;var q=osakana4242.Logger;var e={resPath:html.resPath||"",cacheStr:"?v="+k.VERSION,isSoundLoad:html.isSoundLoad,isDebug:true,};var t={curStageId:1,playType:1,};var o=Class.create(Scene,{initialize:function(){this.playType=html.playType;this.startStageId=html.startStageId;this.startRandomSeed=html.startRandomSeed;this.stageProgressMap={};this._curStageId=0;this.curStageId=parseInt(html.startStageId)},curStageId:{get:function(){return this._curStageId},set:function(u){this._curStageId=u;this.stageProgressMap[u]={score:0}}},curStageProgress:{get:function(){return this.stageProgressMap[this.curStageId]}},addScore:function(u){this.curStageProgress.score=h.trim(this.curStageProgress.score+u,0,k.SCORE_MAX)},calcTotalScore:function(){var v=0;for(var u in this.stageProgressMap){var w=this.stageProgressMap[u];v=h.trim(w.score+v,0,k.SCORE_MAX)}return v},getStageById:function(y){var x=osakana4242.jump_hell.STAGE_DATA.stages;for(var w=0,v=x.length;w<v;++w){var u=x[w];if(u.id===y){return u}}return null},isFinalStage:function(){if(this.playType===k.PLAY_TYPE_ALL_STAGE){var v=this.getStageById(this.curStageId);if(v.flg_last===1){return true}var u=osakana4242.jump_hell.STAGE_DATA;if(this.curStageId===u.stages.length){return true}return false}else{return true}},resetProgress:function(){this.stageProgressMap={};this.curStageId=this.startStageId},incrementStage:function(){if(this.isFinalStage()){}else{++this.curStageId}}});var b=new o();s.DATA_LIST={stand_u:new c(0.2,[0,1,2]),jump_u:new c(0.1,[8,9]),jump_lu:new c(0.1,[16,17]),jump_ru:new c(0.1,[24,25]),stand_d:new c(0.2,[32]),dead:new c(0.2,[40]),star_1:new c(0.05,[0,1,2,3]),star_2:new c(0.05,[8,9,10,11]),star_3:new c(0.05,[16,17,18,19]),star_4:new c(0.05,[24,25,26,27]),panel:new c(0.1,[0,1,2,3]),panel_tap_effect:new c(0.1,[0,1,2,3]),dummy:new c(0.1,[])};var r=new d(k.SC_W,k.SC_H);var p=new a(e,r);var g=html?html.isPc:false;if(g){r.fps=60}else{r.fps=k.BASE_FPS}p.randomMap.game=new l();p.randomMap.effect=new l();p.record=p.record||{};p.record.jump_hell={playProgress:b};p.preload(["img/chara_01.png","img/font.png","img/texts.png","img/buttons.png","img/panel.png","img/bg_02.png","img/bg_03.png","img/ground_01.png","img/ground_02.png","img/title.png","img/start.png","img/clear.png","img/chain_gauge_frame.png","img/effect.png","img/panel_tap_effect.png","img/game_over.png","img/tutorial_01.png","img/tutorial_02.png"]);if(e.isSoundLoad){p.preload(["snd/se_ok.mp3","snd/se_panel.mp3","snd/se_jump.mp3","snd/jgl_game_over.mp3","snd/jgl_game_clear.mp3","snd/bgm_main_intro.mp3","snd/bgm_main.mp3"])}r.addEventListener("progress",function(u){q.debug.log(f.csv("loaded",u.loaded))});r.onload=function(){var u=a.instance;u.sound.add("snd/se_ok.mp3",0,false);u.sound.add("snd/se_panel.mp3",0,false);u.sound.add("snd/se_jump.mp3",0,false);u.sound.add("snd/jgl_game_over.mp3",0,false);u.sound.add("snd/jgl_game_clear.mp3",0,false);u.sound.add("snd/bgm_main_intro.mp3",0,false);u.sound.add("snd/bgm_main.mp3",27.472,true);var v=new i.SceneLoad();r.replaceScene(v)};n.enabledInMobileSafari=false;q.debug.log("game.start");r.start()}());
